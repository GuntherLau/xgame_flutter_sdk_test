import{r as E,b as G,a1 as K,j as J,q as L,G as M}from"./index.sdk-0.0.1.js";(function(s,f){typeof module=="object"&&typeof module.exports=="object"?module.exports=s.document?f(s):function(v){if(!v.document)throw new Error("initNECaptchaWithFallback requires a window with a document");return f(v)}:typeof define=="function"&&define.amd?define("initNECaptchaWithFallback",[],function(){return f(s)}):s.initNECaptchaWithFallback=f(s)})(typeof window<"u"?window:void 0,function(s){var f=0,v="QjGAuvoHrcpuxlbw7cp4WnIbbjzG4rtSlpc7EDovNHQS._ujzPZpeCInSxIT4WunuDDh8dRZYF2GbBGWyHlC6q5uEi9x-TXT9j7J705vSsBXyTar7aqFYyUltKYJ7f4Y2TXm_1Mn6HFkb4M7URQ_rWtpxQ5D6hCgNJYC0HpRE7.2sttqYKLoi7yP1KHzK-PptdHHkVwb77cwS2EJW7Mj_PsOtnPBubTmTZLpnRECJR99dWTVC11xYG0sx8dJNLUxUFxEyzTfX4nSmQz_T5sXATRKHtVAz7nmV0De5unmflfAlUwMGKlCT1khBtewlgN5nHvyxeD8Z1_fPVzi9oznl-sbegj6lKfCWezmLcwft8.4yaVh6SlzXJq-FnSK.euq9OBd5jYc82ge2_hEca1fGU--SkPRzgwkzew4O4qjdS2utdPwFONnhKAIMJRPUmCV4lPHG1OeRDvyNV8sCnuFMw7leasxIhPoycl4pm5bNy70Z1laozEGJgItVNr3",x={"zh-CN":"前方拥堵，已自动跳过验证",en:"captcha error，Verified automatically"},C=1e3*60,b=502,o={};function k(t,r){var n=document.head||document.getElementsByTagName("head")[0],e=document.createElement("script");r=r||function(){},e.type="text/javascript",e.charset="utf8",e.async=!0,e.src=t,"onload"in e||(e.onreadystatechange=function(){this.readyState!=="complete"&&this.readyState!=="loaded"||(this.onreadystatechange=null,r(null,e))}),e.onload=function(){this.onerror=this.onload=null,r(null,e)},e.onerror=function(){this.onerror=this.onload=null,r(new Error("Failed to load "+this.src),e)},n.appendChild(e)}function A(t,r,n){if(t=t||"",r=r||"",n=n||"",t&&(t=t.replace(/:?\/{0,2}$/,"://")),r){var e=r.match(/^([-0-9a-zA-Z.:]*)(\/.*)?/);r=e[1],n=(e[2]||"")+"/"+n}return!r&&(t=""),t+r+n}function S(t,r){if(r!==void 0){var n=t.nodeType;(n===1||n===11||n===9)&&(typeof t.textContent=="string"?t.textContent=r:t.innerText=r)}}function w(t,r){if(r=r||document,r.querySelectorAll)return r.querySelectorAll(t);if(!/^\.[^.]+$/.test(t))return[];if(r.getElementsByClassName)return r.getElementsByClassName(t);for(var n=r.getElementsByTagName("*"),e,a=[],l=t.slice(1),d=0,c=n.length;d<c;d++)e=n[d],~(" "+e.className+" ").indexOf(" "+l+" ")&&a.push(e);return a}function h(t,r){if(!t)throw new Error("[NECaptcha] "+r)}function y(t){return Number.isInteger?Number.isInteger(t):typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function _(t){return Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object Array]"}function V(){if(Object.assign)return Object.assign.apply(null,arguments);for(var t={},r=1;r<arguments.length;r++){var n=arguments[r];if(n!=null)for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}function q(t){return t=!t&&t!==0?t:1,parseInt(new Date().valueOf()/t,10)}function B(t){var r=s.location.protocol.replace(":",""),n={protocol:r==="http"?"http":"https",lang:"zh-CN",errorFallbackCount:3},e=V({},n,t),a=e.errorFallbackCount;return h(a===void 0||y(a)&&a>=1,"errorFallbackCount must be an integer, and it's value greater than or equal one"),e}function U(t,r){if(s.initNECaptcha){setTimeout(function(){r(null)},0);return}function n(l){var d="load.min.js",c=[];if(_(l))for(var R=0,j=l.length;R<j;R++)c.push(A(t.protocol,l[R],d));else{var T=A(t.protocol,l,d);c=[T,T]}return c}var e=n(t.staticServer||["cstaticdun.126.net","cstaticdun1.126.net","cstatic.dun.163yun.com"]);function a(l){var d=e[l]+"?v="+q(C);k(d,function(c){return c||!s.initNECaptcha?(l=l+1,l===e.length?r(new Error("Failed to load script("+d+")."+(c?c.message:"unreliable script"))):a(l)):r(null)})}a(0)}function W(t,r,n){var e=null,a=B(t),l=a.defaultFallback!==!1,d=x[a.lang==="zh-CN"?a.lang:"en"],c=s.location.pathname+"_"+a.captchaId+"_NECAPTCHA_ERROR_COUNTS";try{f=parseInt(localStorage.getItem(c)||0,10)}catch(i){console.log(i)}var R=l?function(i){function m(g){if(g&&(m(g._captchaIns),!!g.$el)){var N=w(".yidun-fallback__tip",g.$el);N.length&&setTimeout(function(){for(var F=0,I=N.length;F<I;F++)S(N[F],d)},0)}}m(e),a.onVerify&&a.onVerify(null,{validate:i})}:a.onFallback||function(){},j=!l&&!a.onFallback,T=function(i){if(f++,f<a.errorFallbackCount){try{localStorage.setItem(c,f)}catch(m){console.log(m)}n(i)}else R(v),P(),j&&n(i)},P=function(){f=0;try{localStorage.setItem(c,0)}catch(i){console.log(i)}},z=function(i){if(u&&u.isError()){u.resetError();return}u&&u.resetTimer(),j?n(i):T(i)};a.onError=function(i){u&&u.isError()&&u.resetError(),T(i)},a.onDidRefresh=function(){u&&u.isError()&&u.resetError(),P()};var u=t.initTimeoutError?t.initTimeoutError(T):null,O=function(){s.initNECaptcha(a,function(i){u&&u.isError()||(u&&u.resetTimer(),e=i,r&&r(i))},z)},p="load-queue";o[p]||(o[p]={rejects:[],resolves:[],status:"error"}),o[p].status==="error"?(o[p].status="pending",U(a,function(i){if(i){var m=new Error;m.code=b,m.message=a.staticServer+"/load.min.js error";for(var g=o[p].rejects,N=0,F=g.length;N<F;N++)g.pop()(m);o[p].status="error"}else{o[p].status="done";for(var I=o[p].resolves,H=0,D=I.length;H<D;H++)I.pop()()}})):o[p].status==="done"&&O(),o[p].status==="pending"&&(o[p].rejects.push(function(m){z(m)}),o[p].resolves.push(O))}return W});const Y=E.forwardRef(({className:s},f)=>{const v=G(K),x=E.useRef(null),C=E.useRef(null),b=E.useRef(null),o=E.useRef(null),k=()=>{v&&window.initNECaptchaWithFallback({element:x.current,captchaId:v,width:"320px",mode:"popup",apiVersion:2,popupStyles:{position:"fixed",top:"20%",radius:8,capBarTextAlign:"center",capBarTextWeight:500},onVerify:function(h,y){if(h)return;const{validate:_}=y;b.current=_},onClose:function(){L.emit(M.waitFor3rdCaptcha,b.current)}},function(y){C.current=y},function(y){console.error(y)})},A=()=>{var h;return(h=C.current)==null?void 0:h.verify()},S=()=>{b.current="",C.current&&C.current.refresh()},w=h=>{o.current=h};return E.useImperativeHandle(f,()=>({verify:A,refresh:S,setState:w,state:o})),E.useEffect(()=>(k(),()=>S()),[v]),J.jsx("div",{ref:x})});Y.displayName="ThirdPartyCaptcha";export{Y as T};
