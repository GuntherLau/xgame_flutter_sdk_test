import{u as G,r as o,j as e,T as s,H as x,R as $,aF as H,b as z,h as J,b9 as D,q as Q,G as X,v as K,ba as Z,bb as I}from"./index.sdk-0.0.1.js";import{A as L}from"./button.js";import{N as F}from"./normal-layout.js";import{A as V,O as R}from"./auth.dto.js";import{a as B}from"./sucess-view.js";import{P as M,p as U,i as ee}from"./index5.js";import"./main-layout.js";import"./popover.js";import"./Modal.js";import"./lazy-load-component.js";const te={phone:"",otp:"",errors:{phone:"",otp:""}},ne=(u,t)=>{switch(t.type){case"change":return u.errors[t.field]="",{...u,[t.field]:t.value};default:return u}};function fe(){const{i18n:{language:u}}=G(),[t,S]=o.useState(!1),[b,f]=o.useState(!1),[r,n]=o.useReducer(ne,te),[N,A]=o.useState(!1),[g,w]=o.useState(0),[j,m]=o.useState(!1),P=o.useRef(null),q=i=>{const{name:p,value:h}=i.target;f(!1),n({type:"change",field:p,value:h})},C=i=>{console.log(i),i&&(f(!1),n({type:"change",field:"phone",value:i}))},_=()=>{r.errors={phone:"",otp:""},r.phone||(r.errors.phone=s.phone_is_required()),r.otp||(r.errors.otp=s.otp_is_required());const i=!Object.values(r.errors).some(p=>p!="");return A(i),i},v=async()=>{var p,h,y;if(!_()){f(!0);return}S(!0);const i=(((p=U(r.phone))==null?void 0:p.nationalNumber)||"").replace("+","");try{await D({newPhone:i,oldPhone:"",newOtp:r.otp,oldOtp:""}),m(!0),Q.emit(X.refreshUserInfo)}catch(O){const T=((y=(h=O==null?void 0:O.response)==null?void 0:h.data)==null?void 0:y.message)??"";x.showToast(T.replace(i,"").trim())}finally{S(!1)}},E=async()=>{var i,p;if(!(g>0)){if(!r.phone){r.errors.phone=s.phone_is_required(),f(!0);return}try{await K({authenType:V.PHONE,authenValue:r.phone,otpType:R.ADD});let h=60;w(h),P.current=setInterval(()=>{w(--h),h<=0&&clearInterval(P.current)},1e3)}catch(h){const y=((p=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:p.message)??"";x.showToast(y.replace(r.phone,"").trim())}}};return o.useEffect(()=>()=>{clearInterval(P.current)},[]),o.useEffect(()=>{_()},[r.phone,r.otp]),j?e.jsx(F,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx(B,{msg:s.successfully_change_new_phone(),onClick:()=>x.navigate($.home),title:H(r.phone)})})}):e.jsx(F,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"oldPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.phone_number()]}),e.jsx(M,{className:"mt-2 input-all input-all__border",value:r.phone,onChange:C,placeholder:s.enter_phone_hint(),local:u}),b&&r.errors.phone&&e.jsx("p",{className:"error",children:r.errors.phone})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.get_a_verification_code()]}),e.jsxs("div",{className:"w-full input-all input-all__border px-3 h-11 mt-1 flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:r.otp,onChange:q,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:E,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:g>0?`${s.resend()}(${g})`:s.get_a_verification_code()})]}),b&&r.errors.otp&&e.jsx("p",{className:"error",children:r.errors.otp})]}),e.jsx(L,{title:s.confirm(),onClick:v,className:"mt-9 uppercase",disable:t,useDisableStyle:!N})]})})}const se={newPhone:"",newOtp:"",oldOtp:"",verifyKey:"",errors:{newPhone:"",newOtp:"",oldOtp:""}},re=(u,t)=>{switch(t.type){case"change":return u.errors[t.field]="",{...u,[t.field]:t.value};default:return u}};function we(){const{i18n:{language:u}}=G(),{userInfo:t}=z(J),[S,b]=o.useState(!1),[f,r]=o.useState(!1),[n,N]=o.useReducer(re,se),[A,g]=o.useState(!1),[w,j]=o.useState(0),[m,P]=o.useState(1),[q,C]=o.useState(!1),_=o.useRef((t==null?void 0:t.verifyPhone)!=0),v=o.useRef(null),E=l=>{const{name:c,value:a}=l.target;r(!1),N({type:"change",field:c,value:a})},i=l=>{l&&(r(!1),N({type:"change",field:"newPhone",value:l}))},p=()=>{n.errors={newPhone:"",newOtp:"",oldOtp:""},m==1?n.oldOtp||(n.errors.oldOtp=s.otp_is_required()):(n.newPhone||(n.errors.newPhone=s.phone_is_required()),ee(n.newPhone)||(n.errors.newPhone=s.phone_number_invalid()),n.newPhone==(t==null?void 0:t.phone)&&(n.errors.newPhone=s.new_phone_must_differ_from_cur()),n.newOtp||(n.errors.newOtp=s.otp_is_required()));const l=!Object.values(n.errors).some(c=>c!="");return g(l),l},h=async()=>{var c,a,d;if(!p()){r(!0);return}b(!0);const l=(((c=U(n.newPhone))==null?void 0:c.nationalNumber)||"").replace("+","");try{await D({newPhone:l,oldPhone:(t==null?void 0:t.phone)??"",newOtp:n.newOtp,oldOtp:n.oldOtp}),C(!0)}catch(k){const Y=((d=(a=k==null?void 0:k.response)==null?void 0:a.data)==null?void 0:d.message)??"";x.showToast(Y.replace((t==null?void 0:t.phone)||"","").replace(l,"").trim())}finally{b(!1)}},y=async()=>{var l,c;if(!n.oldOtp){n.errors.oldOtp=s.otp_is_required(),r(!0);return}b(!0);try{await Z({authenType:V.PHONE,authenValue:n.newPhone,otp:n.newOtp,verifyKey:n.verifyKey}),C(!0)}catch(a){const d=((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.message)??"";x.showToast(d.replace((t==null?void 0:t.phone)||"","").replace(n.newPhone,"").trim())}finally{b(!1)}},O=async()=>{var l,c;if(!p()){r(!0);return}try{const{verifyKey:a}=await I({authenType:V.EMAIL,authenValue:t==null?void 0:t.email,otp:n.oldOtp});N({type:"change",field:"verifyKey",value:a}),g(!1),j(0),clearInterval(v.current),P(2)}catch(a){const d=((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.message)??"";x.showToast(d.replace((t==null?void 0:t.phone)??"","").trim())}},T=async()=>{var l,c;if(!(w>0)){if(n.errors={newPhone:"",newOtp:"",oldOtp:""},m==2){if(!n.newPhone){n.errors.newPhone=s.phone_is_required(),r(!0);return}if(n.newPhone==(t==null?void 0:t.phone)){n.errors.newPhone=s.new_phone_must_differ_from_cur(),r(!0);return}}try{let a=R.VERIFY;_.current||(m==1?a=R.CHANGE_OLD:a=R.CHANGE_NEW),await K({authenType:V.PHONE,authenValue:m==1?(t==null?void 0:t.phone)??"":n.newPhone,otpType:a});let d=60;j(d),v.current=setInterval(()=>{j(--d),d<=0&&clearInterval(v.current)},1e3)}catch(a){const d=((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.message)??"";x.showToast(d.replace(n.newPhone,"").replace((t==null?void 0:t.phone)??"","").trim())}}},W=()=>{if(_.current){y();return}if(m==1){O();return}h()};return o.useEffect(()=>()=>{clearInterval(v.current)},[]),o.useEffect(()=>{p()},[n.newPhone,n.newOtp,n.oldOtp]),q?e.jsx(F,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx(B,{msg:s.successfully_change_new_phone(),onClick:()=>x.navigate($.home),title:H(n.newPhone)})})}):e.jsx(F,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[m==1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-md flex flex-col items-center justify-center py-14 bg-[var(--box-bg)]",children:[e.jsx("div",{className:"text-3xl text-white font-semibold",children:H((t==null?void 0:t.phone)??"")}),e.jsx("div",{className:"text-[var(--text-content-color)] mt-2",children:s.original_mobile_phone_number()})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.sms_verification_code()]}),e.jsxs("div",{className:"w-full rounded-md px-3 h-11 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"oldOtp",name:"oldOtp",value:n.oldOtp,onChange:E,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:T,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:w>0?`${s.resend()}(${w})`:s.get_a_verification_code()})]}),f&&n.errors.oldOtp&&e.jsx("p",{className:"error",children:n.errors.oldOtp})]})]}),m==2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"newPhone",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.new_phone_number()]}),e.jsx(M,{className:"mt-2 !border-[#333239]",value:n.newPhone,onChange:i,placeholder:s.enter_phone(),local:u}),f&&n.errors.newPhone&&e.jsx("p",{className:"error",children:n.errors.newPhone})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.sms_verification_code()]}),e.jsxs("div",{className:"w-full rounded-md px-3 h-11 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"newOtp",name:"newOtp",value:n.newOtp,onChange:E,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:T,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:w>0?`${s.resend()}(${w})`:s.get_a_verification_code()})]}),f&&n.errors.newOtp&&e.jsx("p",{className:"error",children:n.errors.newOtp})]})]}),e.jsx(L,{title:m==1&&!_.current?s.next_step():s.confirm(),onClick:W,className:"mt-9 uppercase",disable:S,useDisableStyle:!A})]})})}export{fe as AddPhone,we as ChangePhone};
