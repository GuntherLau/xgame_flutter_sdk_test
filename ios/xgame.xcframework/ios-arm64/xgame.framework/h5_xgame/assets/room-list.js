import{r as n,j as a,l as j,bq as p,M as U,br as N,u as S,b as d,bs as R,bt as k,a7 as M,bu as x,K as f,bv as v,bw as u,bx as T,by as b}from"./index.sdk-0.0.1.js";function E({item:e,className:r="",onPickRoom:o}){const[t,c]=n.useState(()=>e.unreadCount);return n.useEffect(()=>{e.onUnreadChanged=c},[]),a.jsxs("div",{onClick:()=>o(e),className:`flex items-center bg-[var(--box-bg)] rounded-xl px-2 py-3 gap-2 ${r}`,children:[a.jsx(j,{src:e.headImage==""?"/assets/dummy/avatar2.png":e.headImage,alt:"",className:"w-11 h-11 circle",style:{borderRadius:"50%"}}),a.jsxs("div",{style:{maxWidth:"70%"},children:[a.jsx("div",{className:"text-[var(--text-color)]",children:e.name}),a.jsxs("div",{className:"text-xs text-[var(--text-content-color)] overflow-ellipsis overflow-hidden whitespace-nowrap",children:[e.type==p.customer?"":e.groupPersonNumber+"äºº",e.subTitle&&e.type!=p.customer&&" - ",e.subTitle]})]}),a.jsx("div",{className:"grow"}),t>0&&a.jsx("div",{className:"rounded-l-full rounded-r-full bg-[var(--active)] px-2 text-black text-sm leading-none pt-1 py-0.5",children:t<=99?t:"99+"}),a.jsx(U,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-4 h-4"})]})}const m=N.getInstance();function _({onPickRoom:e}){const{i18n:{language:r}}=S(),o=d(R),t=d(k),[c,C]=n.useState(new Date().getTime()),{isLogin:g}=d(M),w=async()=>{await v.getInstance().checkOrCreateUser(),await m.fetchRoomList(),C(new Date().getTime())},h=i=>{const s=JSON.parse(i);if(s.cmd==u.private||s.cmd==u.group||s.cmd==u.customer){const y=new T(s.data);if(s.data.type==b.text||s.data.type==b.image){const l=m.getRooms().find(I=>I.id==y.groupId);l&&l.setUnreadCount(l.unreadCount+1)}}};return n.useEffect(()=>(x.getInstance().addListener("onmessage",h),()=>{x.getInstance().removeListener("onmessage",h)}),[]),n.useEffect(()=>{!o.chatApiUrl||!o.chatSocketUrl||!t||(f.chatApiUrl||f.updateChat(o),w())},[o,t,r]),n.useEffect(()=>{!g&&t&&v.getInstance().checkOrCreateUser()},[g]),a.jsx("div",{className:"overflow-hidden overflow-y-auto hide-scrollbar grow pc:pb-4",children:m.getRooms().map((i,s)=>a.jsx(E,{item:i,className:"mt-3",onPickRoom:e},s))},c)}export{_ as L};
