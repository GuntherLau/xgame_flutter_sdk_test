import{i as ne,a as se,r as l,j as a,T as n,Y as oe,l as M,b as ie,h as ce,H as d,M as le,$ as I,q as pe,G as de}from"./index.sdk-0.0.1.js";import{N as ue}from"./normal-layout.js";import{A as ee}from"./button.js";import{u as xe}from"./controller.js";import{m as he,d as fe}from"./deposit.js";import{T as me}from"./captcha2.js";import{M as ye}from"./Modal.js";import"./main-layout.js";import"./popover.js";import"./lazy-load-component.js";function Me(){const{getPayAccountsOff:v,getPayAccountsOn:k}=xe(),{companyConf:e}=ne(),A=se(),w=new URLSearchParams(A.search),[f,i]=l.useState([]),[m,E]=l.useState(null),[b,s]=l.useState(!0),T=async u=>{var N;if(w.get("payType")){s(!u);const y=((N=w.get("payType"))==null?void 0:N.toString())||"",[j,C]=await Promise.all([v(y)||[],k(y)||[]]),P=Array.isArray(j)&&j.length>0?j.map(g=>({...g,paymentMethod:"offline"})):[],$=Array.isArray(C)&&C.length>0?C.map(g=>({...g,paymentMethod:"online"})):[];i([...P,...$])}s(!1)};l.useEffect(()=>{T(!1);const u=setInterval(()=>{T(!0)},5e3);return()=>clearInterval(u)},[]),l.useEffect(()=>{f.length>0&&E(f[0])},[f]);const h=()=>{var u;(u=window.open(e.olUrl,"_blank"))==null||u.focus()};return a.jsx(ue,{title:n.upi_qr_Deposit(),className:"max-w-[800px] mx-auto bg-[var(--page-mob-bg)]",children:b?a.jsx(oe,{className:"grow"}):f.length>0&&m&&m.id?a.jsx("div",{className:"overflow-hidden overflow-y-auto hide-scrollbar h-full pb-3",children:a.jsx(ge,{payList:f,firstItem:m})}):a.jsxs("div",{className:"flex w-full h-full flex-col justify-stretch items-center px-10 mt-10",children:[a.jsx(M,{src:"/assets/icon/ic-maintenance.svg",alt:"",className:"w-40 mr-1 aspect-square"}),a.jsx("div",{className:"mt-3 text-sm text-center",children:n.recharge_method_maintaince()}),a.jsx("div",{className:"mb-10 text-sm text-center",children:n.choose_another_channel()}),a.jsx(ee,{title:n.customer_service_recharge(),onClick:h,className:"cursor-pointer"}),a.jsx("div",{className:"mt-3 text-xs text-center text-[#979ca5]",children:n.note_recharge_maintaince_1()}),a.jsx("div",{className:"text-xs text-[#979ca5] text-center",children:n.note_recharge_maintaince_2()})]})})}function ge({payList:v,firstItem:k}){var R,L,V,q,F,U,z,G,H,J,B,Y,K,Q,W;const[e,A]=l.useState(k),[w,f]=l.useState(!0),[i,m]=l.useState(""),[E,b]=l.useState(!1),[s,T]=l.useState(null),[h,u]=l.useState(),{userInfo:N}=ie(ce);d.currentLang();const y=l.useRef(null);l.useEffect(()=>()=>{m("")},[]),l.useEffect(()=>{var t;try{if(e&&(e!=null&&e.paymentTutorial)&&((t=e==null?void 0:e.paymentTutorial)==null?void 0:t.length)>0){const o=JSON.parse(e.paymentTutorial),p=d.currentLang();let c;o.map(x=>{x.code===p&&!c&&(c=x)}),u(c||null)}else u(null)}catch{u(null)}},[e]),l.useEffect(()=>{d.setRechargeAmount(i)},[i]);const j=t=>{var _;if(Number(i)<=0)return;const o=N==null?void 0:N.fullName,p={payAccountId:e.id,amount:i,rechargePerson:o??"",validateCaptcha:t??""},c={payAccountId:e==null?void 0:e.id,payType:e==null?void 0:e.payType,amount:i,rechargePerson:o??"",validateCaptcha:t??"",tpPayChannelsId:(e==null?void 0:e.merchantId)??null,currency:(_=e.payTypeEntity)==null?void 0:_.currency},x=JSON.stringify(c),S=I(x);if(e.paymentMethod=="online"){const{...D}=p;C({payChannelId:p.payAccountId,...D})}e.paymentMethod=="offline"&&$(p,S)},C=async t=>{var o,p,c,x,S,_,D,X,Z;try{const r=await he(t);r&&(r!=null&&r.link)?(T(r),b(!0)):r&&(r!=null&&r.response)&&((p=(o=r==null?void 0:r.response)==null?void 0:o.data)!=null&&p.messsage||(x=(c=r==null?void 0:r.response)==null?void 0:c.data)!=null&&x.msg)?d.showInfoToast(((_=(S=r==null?void 0:r.response)==null?void 0:S.data)==null?void 0:_.messsage)||((X=(D=r==null?void 0:r.response)==null?void 0:D.data)==null?void 0:X.msg)):d.showError(n.failed())}catch{(Z=y.current)==null||Z.refresh(),d.showError(n.failed())}finally{}},P=()=>{let t={pathname:`/deposit/online-pay/${s==null?void 0:s.orderNo}`};s!=null&&s.link&&(t={...t,search:`?viewType=${e.viewType}&link=${I(s==null?void 0:s.link)}`}),e.paymentMethod=="online"&&s&&(b(!1),s&&s.orderNo&&d.navigate(t,{replace:!0}),(e==null?void 0:e.viewType)==0&&s&&s.link&&(typeof s.link=="string"||s.link instanceof String)&&setTimeout(()=>{window.open(s.link,"_blank")},100))},$=async(t,o)=>{var p;try{const c=await fe(t);c!=null&&c.orderNo&&d.navigate(`/deposit/crypto-wallet/${c.orderNo}?info=${o}`)}catch(c){(p=y.current)==null||p.refresh();const{response:{data:{message:x}}}=c;d.showInfoToast(x)}finally{}},g=t=>{isNaN(Number(t))||m(t)},O=t=>{m(""),A(t)},ae=async()=>new Promise(t=>{var o;(o=y.current)==null||o.verify(),pe.on(de.waitFor3rdCaptcha,p=>{t(p)})}),te=async()=>{var t;if(!e.rechargeConfig){d.showInfoToast(n.payment_method_closed());return}if(e!=null&&e.limitDepositStatus&&(Number(i)>((e==null?void 0:e.limitDepositMax)??1/0)||Number(i)<((e==null?void 0:e.limitDepositMin)??1))){d.showInfoToast(n.limit_deposit_amount({_min:e==null?void 0:e.limitDepositMin,_max:e==null?void 0:e.limitDepositMax}));return}if(((t=e.rechargeConfig)==null?void 0:t.validateCodeEnabled)==1){const o=await ae();if(!o)return;j(o);return}j("")},re=t=>{try{return a.jsx(a.Fragment,{children:t&&a.jsx("div",{dangerouslySetInnerHTML:{__html:t}})})}catch{return null}};return a.jsxs("div",{className:"p-3 bg-[var(--page-mob-bg)]",children:[a.jsx("div",{className:"grid grid-cols-3 gap-2 mt-1 overflow-x-auto hide-scrollbar",children:w&&v.length>6?v.slice(0,6).map((t,o)=>a.jsxs("div",{onClick:()=>O(t),className:`hover:cursor-pointer hover:border-[var(--active)] flex flex-col relative items-center justify-center min-h-[60px] rounded-md py-3 px-3 ${e.id==t.id?"border border-[var(--active)] text-[var(--active)]":"border border-[transparent] bg-[var(--box-bg)]"}`,children:[t.hot&&a.jsx("span",{className:"absolute top-0 left-0 py-0.5 px-1 bg-[#ff0051] flex items-center justify-center rounded-tl-md rounded-br-md",children:a.jsx(M,{src:"/assets/dummy/ic_hot.png",alt:"",className:"h-3 w-3"})}),a.jsx("span",{className:"text-nowrap text-base font-semibold whitespace-nowrap overflow-hidden text-ellipsis w-full",children:t.name}),a.jsx("span",{className:`text-nowrap text-[0.75rem] whitespace-nowrap  ${e.id==t.id?"text-[var(--active)]":"text-[gray]"}`,children:t.limitDepositStatus!==0?`${n.limit()}: ${t.limitDepositMin} - ${t.limitDepositMax}`:a.jsx("span",{className:"text-transparent",children:"-"})})]},t.id)):v.map((t,o)=>a.jsxs("div",{onClick:()=>{O(t)},className:`hover:cursor-pointer hover:border-[var(--active)] flex flex-col relative items-center justify-center min-h-[60px] rounded-md py-3 px-3 ${e.id==t.id?"border border-[var(--active)] text-[var(--active)]":"border border-[transparent] bg-[var(--box-bg)]"}`,children:[t.hot&&a.jsx("span",{className:"absolute top-0 left-0 py-0.5 px-1 bg-[#ff0051] flex items-center justify-center rounded-tl-md rounded-br-md",children:a.jsx(M,{src:"/assets/dummy/ic_hot.png",alt:"",className:"h-3 w-3"})}),a.jsx("span",{className:"text-nowrap text-base font-semibold whitespace-nowrap overflow-hidden text-ellipsis w-full",children:t.name}),a.jsx("span",{className:`text-nowrap text-[0.7rem] whitespace-nowrap  ${e.id==t.id?"text-[var(--active)]":"text-[gray]"}`,children:t.limitDepositStatus!==0?`${n.limit()}: ${t.limitDepositMin} - ${t.limitDepositMax}`:a.jsx("span",{className:"text-transparent",children:"-"})})]},t==null?void 0:t.id))}),w&&v.length>6&&a.jsx("div",{onClick:()=>{f(!1)},className:"hover:cursor-pointer w-full flex justify-center my-4",children:a.jsx("span",{className:"hover:text-[var(--active)] text-sm text-[gray] capitalize",children:`${n.load_more()} >`})}),a.jsxs("div",{className:"text-label mt-5 mb-2 flex justify-between",children:[a.jsx("span",{children:n.deposit_amount()}),!!((R=e==null?void 0:e.rechargeConfig)!=null&&R.rechargeDiscountValue)&&a.jsxs("span",{className:"text-[#ffb400] capitalize",children:[n.bonus()," ",(L=e==null?void 0:e.rechargeConfig)==null?void 0:L.rechargeDiscountValue," ",((V=e==null?void 0:e.rechargeConfig)==null?void 0:V.rechargeDiscountMode)==0?"%":(q=e.payTypeEntity)==null?void 0:q.currency]})]}),a.jsxs("div",{className:"flex items-center input-all input-all__border !text-[var(--active)] text-2xl font-bold h-[42px]",children:[a.jsx("div",{className:"min-w-fit px-2 text-center border-r border-r-[#333239]",children:(F=e.payTypeEntity)==null?void 0:F.currency}),a.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:n.enter_select_amount(),className:"grow px-3 py-1 input-all !text-[var(--active)] h-full"}),a.jsx(le,{onClick:()=>g(""),color:"#333239",name:"ic_round_close",className:"w-4 h-4 mr-2"})]}),(e==null?void 0:e.boardAmountItems)&&a.jsx("div",{className:"py-3 grid grid-cols-4 gap-2",children:(U=e==null?void 0:e.boardAmountItems)==null?void 0:U.split(",").map((t,o)=>a.jsx("div",{onClick:()=>g(t),className:`cursor-pointer rounded-lg text-center p-2 font-semibold ${Number(i)==t?"bg-[var(--active)] text-[black]":"bg-[var(--box-bg)] text-[#cdcdd2s]"}`,children:t},t))}),a.jsx("div",{className:"text-label text-xs h-6",children:i&&a.jsxs(a.Fragment,{children:[n.actual_amount_received(),":",a.jsxs("span",{className:"text-[var(--active)] text-base font-bold pl-2",children:[Number(i),a.jsx("span",{className:"text-xs",children:(z=e.payTypeEntity)==null?void 0:z.currency}),Number(i)==0||!((G=e==null?void 0:e.rechargeConfig)!=null&&G.rechargeDiscountValue)?"":a.jsxs("span",{children:[" ","+"," ",((H=e==null?void 0:e.rechargeConfig)==null?void 0:H.rechargeDiscountMode)==0?(Math.floor(Number(i))/100*Number((J=e==null?void 0:e.rechargeConfig)==null?void 0:J.rechargeDiscountValue)).toFixed(2):(B=e==null?void 0:e.rechargeConfig)==null?void 0:B.rechargeDiscountValue,a.jsx("span",{className:"text-xs",children:(Y=e.payTypeEntity)==null?void 0:Y.currency})]})]})]})}),a.jsx("div",{className:"mt-4 px-5",children:a.jsx(ee,{disable:Number(i)<=0,title:n.deposit(),onClick:()=>te(),className:"uppercase cursor-pointer"})}),a.jsx("div",{className:"mt-10 text-xs text-[var(--text-content-color)]",children:a.jsx("div",{className:"overflow-hidden overflow-y-auto hide-scrollbar h-full",children:h!=null&&h.value?re(h==null?void 0:h.value):null})}),a.jsx(ye,{open:E,onClose:()=>b(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",className:"flex items-center justify-center",children:a.jsxs("div",{className:"mob:rounded-xl pc:rounded-xl bg-[#2f2f31] text-white w-[300px] p-3 outline-none border-none",children:[a.jsxs("div",{className:"w-full flex justify-center items-end h-10",children:[a.jsx(M,{src:d.getRemoteImgPath((K=e==null?void 0:e.payTypeEntity)==null?void 0:K.icon),alt:"",className:"w-auto h-8 mr-1"}),a.jsx("div",{className:"text-lg font-bold pl-1",children:(Q=e==null?void 0:e.payTypeEntity)==null?void 0:Q.name})]}),a.jsx("div",{className:"mt-3 text-base text-center",children:n.question_pay()}),a.jsxs("div",{className:"flex justify-around mt-3",children:[a.jsx("button",{className:"rounded-md p-2 px-10 text-white border border-[var(--active)] text-center cursor-pointer",onClick:()=>{b(!1)},children:n.cancel()}),a.jsx("button",{onClick:()=>P(),className:"rounded-md p-2 px-10  text-black bg-[var(--active)] capitalize font-bold text-center cursor-pointer",rel:"noreferrer",children:n.confirm()})]})]})}),((W=e.rechargeConfig)==null?void 0:W.validateCodeEnabled)==1&&a.jsx(me,{ref:y})]})}export{Me as PixDepositView};
