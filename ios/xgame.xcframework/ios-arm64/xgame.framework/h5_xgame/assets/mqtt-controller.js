import{an as Ee,aP as Ht,aQ as Ie,af as oe,a0 as Bt,H as q,u as Qn,g as Yt,z as He,i as Yn,e as Jn,b as Ge,a7 as Dr,f as Zn,r as dt,aO as Xn,L as ti,T as Be,R as Kt,$ as Ne,aR as Ut,aS as Xe,aT as Pe,aU as tr,aV as _,aW as er,aX as ei,aY as Pt,aZ as ri}from"./index.sdk-0.0.1.js";import{i as rr,b as At}from"./browser.js";async function ni(){try{return(await Ee("/sys-upload/data/json/game_center.json",{params:{_t:new Date().getTime()}})).data}catch{return[]}}async function ii(){const r=await Ee("/app-api/api/v2/live/pair",{params:{_t:new Date().getTime()}});return r==null?void 0:r.data}async function lr(r){return await Ee("/app-api/api/v2/live/play",{params:r})}async function oi(){try{const{data:r}=await Ee("/sys-upload/data/json/game_provider.json",{params:{_t:new Date().getTime()}});return r.map(e=>({...e,currencies:e.currencies.filter(t=>t.active)}))}catch{return[]}}var Hr={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Ht,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},n={};return function(i,o,s){var u,c=function(l,p,g){g===void 0&&(g={});var d=new Date(l),v=function(A,m){m===void 0&&(m={});var b=m.timeZoneName||"short",C=A+"|"+b,I=n[C];return I||(I=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:A,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:b}),n[C]=I),I}(p,g);return v.formatToParts(d)},a=function(l,p){for(var g=c(l,p),d=[],v=0;v<g.length;v+=1){var A=g[v],m=A.type,b=A.value,C=t[m];C>=0&&(d[C]=parseInt(b,10))}var I=d[3],H=I===24?0:I,W=d[0]+"-"+d[1]+"-"+d[2]+" "+H+":"+d[4]+":"+d[5]+":000",x=+l;return(s.utc(W).valueOf()-(x-=x%1e3))/6e4},f=o.prototype;f.tz=function(l,p){l===void 0&&(l=u);var g=this.utcOffset(),d=this.toDate(),v=d.toLocaleString("en-US",{timeZone:l}),A=Math.round((d-new Date(v))/1e3/60),m=s(v,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(15*-Math.round(d.getTimezoneOffset()/15)-A,!0);if(p){var b=m.utcOffset();m=m.add(g-b,"minute")}return m.$x.$timezone=l,m},f.offsetName=function(l){var p=this.$x.$timezone||s.tz.guess(),g=c(this.valueOf(),p,{timeZoneName:l}).find(function(d){return d.type.toLowerCase()==="timezonename"});return g&&g.value};var h=f.startOf;f.startOf=function(l,p){if(!this.$x||!this.$x.$timezone)return h.call(this,l,p);var g=s(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return h.call(g,l,p).tz(this.$x.$timezone,!0)},s.tz=function(l,p,g){var d=g&&p,v=g||p||u,A=a(+s(),v);if(typeof l!="string")return s(l).tz(v);var m=function(H,W,x){var U=H-60*W*1e3,S=a(U,x);if(W===S)return[U,W];var w=a(U-=60*(S-W)*1e3,x);return S===w?[U,S]:[H-60*Math.min(S,w)*1e3,Math.max(S,w)]}(s.utc(l,d).valueOf(),A,v),b=m[0],C=m[1],I=s(b).utcOffset(C);return I.$x.$timezone=v,I},s.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},s.tz.setDefault=function(l){u=l}}})})(Hr);var si=Hr.exports;const ai=Ie(si);var Gr={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Ht,function(){var t="minute",n=/[+-]\d\d(?::?\d\d)?/g,i=/([+-]|\d\d)/g;return function(o,s,u){var c=s.prototype;u.utc=function(d){var v={date:d,utc:!0,args:arguments};return new s(v)},c.utc=function(d){var v=u(this.toDate(),{locale:this.$L,utc:!0});return d?v.add(this.utcOffset(),t):v},c.local=function(){return u(this.toDate(),{locale:this.$L,utc:!1})};var a=c.parse;c.parse=function(d){d.utc&&(this.$u=!0),this.$utils().u(d.$offset)||(this.$offset=d.$offset),a.call(this,d)};var f=c.init;c.init=function(){if(this.$u){var d=this.$d;this.$y=d.getUTCFullYear(),this.$M=d.getUTCMonth(),this.$D=d.getUTCDate(),this.$W=d.getUTCDay(),this.$H=d.getUTCHours(),this.$m=d.getUTCMinutes(),this.$s=d.getUTCSeconds(),this.$ms=d.getUTCMilliseconds()}else f.call(this)};var h=c.utcOffset;c.utcOffset=function(d,v){var A=this.$utils().u;if(A(d))return this.$u?0:A(this.$offset)?h.call(this):this.$offset;if(typeof d=="string"&&(d=function(I){I===void 0&&(I="");var H=I.match(n);if(!H)return null;var W=(""+H[0]).match(i)||["-",0,0],x=W[0],U=60*+W[1]+ +W[2];return U===0?0:x==="+"?U:-U}(d),d===null))return this;var m=Math.abs(d)<=16?60*d:d,b=this;if(v)return b.$offset=m,b.$u=d===0,b;if(d!==0){var C=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(b=this.local().add(m+C,t)).$offset=m,b.$x.$localOffset=C}else b=this.utc();return b};var l=c.format;c.format=function(d){var v=d||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,v)},c.valueOf=function(){var d=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*d},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var p=c.toDate;c.toDate=function(d){return d==="s"&&this.$offset?u(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():p.call(this)};var g=c.diff;c.diff=function(d,v,A){if(d&&this.$u===d.$u)return g.call(this,d,v,A);var m=this.local(),b=u(d).local();return g.call(m,b,v,A)}}})})(Gr);var ui=Gr.exports;const ci=Ie(ui),pe={isGameCenterCalled:!1,isGameProviderCalled:!1};oe.extend(ci);oe.extend(ai);const li=Bt({key:"gameCenterData",default:q.getGameCenterCache()}),fi=Bt({key:"gameProviderData",default:q.getGameProviderCache()}),hi=Bt({key:"gameLivePairData",default:q.getGameFuturePairCache()}),pi=Bt({key:"loadingGameCenter",default:!1}),di=Bt({key:"providersByGameType",default:{hash:[],crypto:[],future:[],live:[],electronic:[],lottery:[],hot:[],fish:[],card:[],sport:[]}}),yi=Bt({key:"favorites",default:q.getFavGame()});function gi(){Qn();const[r,e]=Yt(li),[t,n]=Yt(fi),[i,o]=Yt(hi),[s,u]=Yt(pi),c=He(di),[a,f]=Yt(yi),{serverConf:h}=Yn(),{web3Verify:l}=Jn(),{isLogin:p}=Ge(Dr),{isConnected:g,address:d}=Zn(),v=async()=>{var S;if(!(r.length>0&&pe.isGameCenterCalled)){u(!0);try{const w=await ni(),N={hash:[],crypto:[],future:[],live:[],electronic:[],lottery:[],hot:[],fish:[],card:[],sport:[]};for(const B of w)B.liveCode&&((S=N[B.category])==null?void 0:S.findIndex(R=>R.code==B.liveCode))==-1&&N[B.category].push({code:B.liveCode,gameProvider:B.gameProvider,enGameProvider:B.enGameProvider});c(N),e(w),pe.isGameCenterCalled=!0,q.setGameCenterCache(w)}finally{u(!1)}}},A=async()=>{if(t.length>0&&pe.isGameProviderCalled)return;const S=await oi();n(S),q.setGameProviderCache(S),pe.isGameProviderCalled=!0},m=(S,{type:w,provider:N,name:B,recent:R=!1,favorite:j=!1})=>{var P;const O=q.getRecentPlayGameIds(),ot=q.getFavGame(),tt=r.filter(E=>{var K;if(E.category!==S)return!1;let T=!0;return N&&E.liveCode!=N&&(T=!1),w=="hot"&&E.hot==0&&(T=!1),w=="new"&&E.sortNew==0&&(T=!1),R&&!O.includes(E.gameId.toString())&&(T=!1),j&&!ot.includes(E.gameId)&&(T=!1),B&&!E.gameName.toLowerCase().includes(B.toLowerCase().trim())&&!((K=E.englishName)!=null&&K.toLowerCase().includes(B.toLowerCase().trim()))&&(T=!1),T}),Qt=((P=ti.getInstance().getLang(q.currentLang()))==null?void 0:P[S])??[];for(let E=0;E<tt.length;E++){const T=Qt.indexOf(tt[E].gameId);if(T==-1||tt[T]==null)continue;const K=tt[E];tt[E]=tt[T],tt[T]=K}return w=="hot"&&tt.sort((E,T)=>T.hot-E.hot),w=="new"&&tt.sort((E,T)=>T.sortNew-E.sortNew),tt},b=({recent:S=!1})=>{const w=q.getRecentPlayGameIds();return t.filter(N=>{let B=!0;return S&&!w.includes(N.code)&&(B=!1),B})},C=S=>{var R,j;const w=(R=h.sys_config)==null?void 0:R.time_zone;if(!S.maintain||!w)return!1;const N=(j=S.maintain)==null?void 0:j.split("~"),B=oe.tz(new Date,w).unix();if(N[0]&&N[1]){const O=oe.tz(N[0],w).unix(),ot=oe.tz(N[1],w).unix();return B>=O&&B<=ot}return!1};return{games:r,providers:t,gameLivePair:i,setGameLivePair:o,loadingGameCenter:s,getGames:v,getProviders:A,getGameByCate:m,isMainTain:C,get3rdGameUrl:async S=>{var N,B,R,j;if(C(S)){q.showError(Be.game_under_maintain());return}if(!p){q.navigate(Kt.login);return}!p&&g&&await l(d);const w={gameType:S.gameCode||S.gameType,isMobile:window.innerWidth<=768,liveCode:S.liveCode};S.gameKind&&(w.gameKind=S.gameKind);try{return(await lr(w)).data}catch(O){if(((B=(N=O==null?void 0:O.response)==null?void 0:N.data)==null?void 0:B.code)=="KY/0"){q.showError(Be.user_are_in_game());return}q.showError((j=(R=O==null?void 0:O.response)==null?void 0:R.data)==null?void 0:j.message);return}},getProviderUrl:async S=>{var N,B,R,j;const w={gameType:"",isMobile:window.innerWidth<=768,liveCode:S.code};try{return(await lr(w)).data}catch(O){if(((B=(N=O==null?void 0:O.response)==null?void 0:N.data)==null?void 0:B.code)=="KY/0"){q.showError(Be.user_are_in_game());return}q.showError((j=(R=O==null?void 0:O.response)==null?void 0:R.data)==null?void 0:j.message);return}},getGameLivePair:async()=>{var S,w;try{const N=await ii();o(N),q.setGameFuturePairCache(N)}catch(N){q.showError((w=(S=N==null?void 0:N.response)==null?void 0:S.data)==null?void 0:w.message);return}},getFilterProvider:b,favs:a,setFav:S=>{q.setFavGame(S),f(q.getFavGame())},clearFav:()=>{q.clearFavGame(),f([])}}}function tu(){const{get3rdGameUrl:r,providers:e,games:t,favs:n,setFav:i,setGameLivePair:o,gameLivePair:s,getProviderUrl:u}=gi(),[c,a]=dt.useState(null),[f,h]=dt.useState(void 0),l=dt.useRef(""),p=dt.useRef(!1),[g,d]=dt.useState(),[v,A]=dt.useState(!1),m=Ge(Xn),{isLogin:b}=Ge(Dr),C=x=>{var B;let U=!1;const S=m==null?void 0:m.code;let w;if((x==null?void 0:x.enGameProvider)&&S){const R=t.find(j=>j.gameId===x.gameId);R&&(w=e.find(j=>j.code===R.liveCode),w&&((B=w==null?void 0:w.currencies)==null?void 0:B.length)>0&&w.currencies.find(O=>O.systemCurrency===S)&&(U=!0))}return{isSupportedCurrency:U,currentProvider:w}};return{closeModalCurrentSupport:()=>{A(!1)},handlePlay3rdGame:async x=>{var N;if(A(!1),c)return;if(!b){q.navigate(Kt.login);return}const{isSupportedCurrency:U,currentProvider:S}=C(x);if(!U){if(A(!0),S&&((N=S==null?void 0:S.currencies)==null?void 0:N.length)>0){let B=!0,R=S==null?void 0:S.currencies;S==null||S.currencies.map(j=>{(!j||!((j==null?void 0:j.sort)>=0))&&(B=!1)}),B&&(R=R.slice().sort((j,O)=>O.sort-j.sort)),d(R)}return}l.current=x.gameId.toString(),p.current=x.appDisplay==1,a(x.gameId);const w=await r(x);if(setTimeout(()=>a(null),1e3),w!=null&&w.playType){let B=w.url??"";B=Ne(B),q.setRecentPlayGame(x.gameId);const R=Ne(q.getPathName()+window.location.search);q.navigate(`${Kt.embedGame}?id=${x.gameId}&category=${x.category}&liveCode=${x.liveCode}&referer=${R}&iframe=${B}`);return}else{if(!w||!w.url)return;h(w.url)}},handleClickProvider:async x=>{var B;if(A(!1),x.code=="sp"){q.setRecentPlayGame(x.code),q.navigate(Kt.cryptoGame);return}if(c)return;if(!b){q.navigate(Kt.login);return}const U=()=>{var ot;let R=!1;const j=m==null?void 0:m.code;let O;return j&&(O=e.find(tt=>tt.code==x.code),O&&((ot=O==null?void 0:O.currencies)==null?void 0:ot.length)>0&&O.currencies.find(Qt=>Qt.systemCurrency==j)&&(R=!0)),{isSupportedCurrency:R,currentProvider:O}},{isSupportedCurrency:S,currentProvider:w}=U();if(!S){if(A(!0),w&&((B=w==null?void 0:w.currencies)==null?void 0:B.length)>0){let R=!0,j=w==null?void 0:w.currencies;w==null||w.currencies.map(O=>{(!O||!((O==null?void 0:O.sort)>=0))&&(R=!1)}),R&&(j=j.slice().sort((O,ot)=>ot.sort-O.sort)),d(j)}return}l.current=x.code,p.current=!1,a(x.code);const N=await u(x);if(setTimeout(()=>a(null),1e3),!(!N||!N.url)){if(x!=null&&x.playType){let R=N.url??"";R=Ne(R),q.setRecentPlayGame(x.code),q.navigate(`${Kt.embedGame}?id=${x.code}&iframe=${R}`);return}h(N.url)}},thirdGameUrl:f,currentGameRef:l,currentGameScreenLanscapeModeRef:p,supportCurrentGameListCurrency:g,isShowModalCurrentSupport:v,currentGame:c,favs:n,setFav:i,setThirdGameUrl:h,setGameLivePair:o,gameLivePair:s}}var ue={exports:{}};const mi=rr,vi=Ut.Readable,_i={objectMode:!0},bi={clean:!0};function Tt(r){if(!(this instanceof Tt))return new Tt(r);this.options=r||{},this.options=mi(bi,r),this._inflights=new Map}Tt.prototype.put=function(r,e){return this._inflights.set(r.messageId,r),e&&e(),this};Tt.prototype.createStream=function(){const r=new vi(_i),e=[];let t=!1,n=0;return this._inflights.forEach(function(i,o){e.push(i)}),r._read=function(){!t&&n<e.length?this.push(e[n++]):this.push(null)},r.destroy=function(){if(t)return;const i=this;t=!0,setTimeout(function(){i.emit("close")},0)},r};Tt.prototype.del=function(r,e){return r=this._inflights.get(r.messageId),r?(this._inflights.delete(r.messageId),e(null,r)):e&&e(new Error("missing packet")),this};Tt.prototype.get=function(r,e){return r=this._inflights.get(r.messageId),r?e(null,r):e&&e(new Error("missing packet")),this};Tt.prototype.close=function(r){this.options.clean&&(this._inflights=null),r&&r()};var Vr=Tt;function zt(r){if(!(this instanceof zt))return new zt(r);this.aliasToTopic={},this.max=r}zt.prototype.put=function(r,e){return e===0||e>this.max?!1:(this.aliasToTopic[e]=r,this.length=Object.keys(this.aliasToTopic).length,!0)};zt.prototype.getTopicByAlias=function(r){return this.aliasToTopic[r]};zt.prototype.clear=function(){this.aliasToTopic={}};var wi=zt,Re,fr;function Si(){return fr||(fr=1,Re=function(r){r.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Re}var Ei=$;$.Node=jt;$.create=$;function $(r){var e=this;if(e instanceof $||(e=new $),e.tail=null,e.head=null,e.length=0,r&&typeof r.forEach=="function")r.forEach(function(i){e.push(i)});else if(arguments.length>0)for(var t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);return e}$.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var e=r.next,t=r.prev;return e&&(e.prev=t),t&&(t.next=e),r===this.head&&(this.head=e),r===this.tail&&(this.tail=t),r.list.length--,r.next=null,r.prev=null,r.list=null,e};$.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var e=this.head;r.list=this,r.next=e,e&&(e.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};$.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var e=this.tail;r.list=this,r.prev=e,e&&(e.next=r),this.tail=r,this.head||(this.head=r),this.length++}};$.prototype.push=function(){for(var r=0,e=arguments.length;r<e;r++)Pi(this,arguments[r]);return this.length};$.prototype.unshift=function(){for(var r=0,e=arguments.length;r<e;r++)Ai(this,arguments[r]);return this.length};$.prototype.pop=function(){if(this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};$.prototype.shift=function(){if(this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};$.prototype.forEach=function(r,e){e=e||this;for(var t=this.head,n=0;t!==null;n++)r.call(e,t.value,n,this),t=t.next};$.prototype.forEachReverse=function(r,e){e=e||this;for(var t=this.tail,n=this.length-1;t!==null;n--)r.call(e,t.value,n,this),t=t.prev};$.prototype.get=function(r){for(var e=0,t=this.head;t!==null&&e<r;e++)t=t.next;if(e===r&&t!==null)return t.value};$.prototype.getReverse=function(r){for(var e=0,t=this.tail;t!==null&&e<r;e++)t=t.prev;if(e===r&&t!==null)return t.value};$.prototype.map=function(r,e){e=e||this;for(var t=new $,n=this.head;n!==null;)t.push(r.call(e,n.value,this)),n=n.next;return t};$.prototype.mapReverse=function(r,e){e=e||this;for(var t=new $,n=this.tail;n!==null;)t.push(r.call(e,n.value,this)),n=n.prev;return t};$.prototype.reduce=function(r,e){var t,n=this.head;if(arguments.length>1)t=e;else if(this.head)n=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;n!==null;i++)t=r(t,n.value,i),n=n.next;return t};$.prototype.reduceReverse=function(r,e){var t,n=this.tail;if(arguments.length>1)t=e;else if(this.tail)n=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;n!==null;i--)t=r(t,n.value,i),n=n.prev;return t};$.prototype.toArray=function(){for(var r=new Array(this.length),e=0,t=this.head;t!==null;e++)r[e]=t.value,t=t.next;return r};$.prototype.toArrayReverse=function(){for(var r=new Array(this.length),e=0,t=this.tail;t!==null;e++)r[e]=t.value,t=t.prev;return r};$.prototype.slice=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new $;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=0,i=this.head;i!==null&&n<r;n++)i=i.next;for(;i!==null&&n<e;n++,i=i.next)t.push(i.value);return t};$.prototype.sliceReverse=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new $;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=this.length,i=this.tail;i!==null&&n>e;n--)i=i.prev;for(;i!==null&&n>r;n--,i=i.prev)t.push(i.value);return t};$.prototype.splice=function(r,e,...t){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var n=0,i=this.head;i!==null&&n<r;n++)i=i.next;for(var o=[],n=0;i&&n<e;n++)o.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<t.length;n++)i=Ii(this,i,t[n]);return o};$.prototype.reverse=function(){for(var r=this.head,e=this.tail,t=r;t!==null;t=t.prev){var n=t.prev;t.prev=t.next,t.next=n}return this.head=e,this.tail=r,this};function Ii(r,e,t){var n=e===r.head?new jt(t,null,e,r):new jt(t,e,e.next,r);return n.next===null&&(r.tail=n),n.prev===null&&(r.head=n),r.length++,n}function Pi(r,e){r.tail=new jt(e,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Ai(r,e){r.head=new jt(e,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function jt(r,e,t,n){if(!(this instanceof jt))return new jt(r,e,t,n);this.list=n,this.value=r,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{Si()($)}catch{}const xi=Ei,Rt=Symbol("max"),It=Symbol("length"),qt=Symbol("lengthCalculator"),se=Symbol("allowStale"),Lt=Symbol("maxAge"),Et=Symbol("dispose"),hr=Symbol("noDisposeOnSet"),z=Symbol("lruList"),pt=Symbol("cache"),Wr=Symbol("updateAgeOnGet"),Le=()=>1;class Ti{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[Rt]=e.max||1/0;const t=e.length||Le;if(this[qt]=typeof t!="function"?Le:t,this[se]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[Lt]=e.maxAge||0,this[Et]=e.dispose,this[hr]=e.noDisposeOnSet||!1,this[Wr]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[Rt]=e||1/0,Jt(this)}get max(){return this[Rt]}set allowStale(e){this[se]=!!e}get allowStale(){return this[se]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[Lt]=e,Jt(this)}get maxAge(){return this[Lt]}set lengthCalculator(e){typeof e!="function"&&(e=Le),e!==this[qt]&&(this[qt]=e,this[It]=0,this[z].forEach(t=>{t.length=this[qt](t.value,t.key),this[It]+=t.length})),Jt(this)}get lengthCalculator(){return this[qt]}get length(){return this[It]}get itemCount(){return this[z].length}rforEach(e,t){t=t||this;for(let n=this[z].tail;n!==null;){const i=n.prev;pr(this,e,n,t),n=i}}forEach(e,t){t=t||this;for(let n=this[z].head;n!==null;){const i=n.next;pr(this,e,n,t),n=i}}keys(){return this[z].toArray().map(e=>e.key)}values(){return this[z].toArray().map(e=>e.value)}reset(){this[Et]&&this[z]&&this[z].length&&this[z].forEach(e=>this[Et](e.key,e.value)),this[pt]=new Map,this[z]=new xi,this[It]=0}dump(){return this[z].map(e=>ge(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[z]}set(e,t,n){if(n=n||this[Lt],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const i=n?Date.now():0,o=this[qt](t,e);if(this[pt].has(e)){if(o>this[Rt])return Gt(this,this[pt].get(e)),!1;const c=this[pt].get(e).value;return this[Et]&&(this[hr]||this[Et](e,c.value)),c.now=i,c.maxAge=n,c.value=t,this[It]+=o-c.length,c.length=o,this.get(e),Jt(this),!0}const s=new Oi(e,t,o,i,n);return s.length>this[Rt]?(this[Et]&&this[Et](e,t),!1):(this[It]+=s.length,this[z].unshift(s),this[pt].set(e,this[z].head),Jt(this),!0)}has(e){if(!this[pt].has(e))return!1;const t=this[pt].get(e).value;return!ge(this,t)}get(e){return je(this,e,!0)}peek(e){return je(this,e,!1)}pop(){const e=this[z].tail;return e?(Gt(this,e),e.value):null}del(e){Gt(this,this[pt].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const i=e[n],o=i.e||0;if(o===0)this.set(i.k,i.v);else{const s=o-t;s>0&&this.set(i.k,i.v,s)}}}prune(){this[pt].forEach((e,t)=>je(this,t,!1))}}const je=(r,e,t)=>{const n=r[pt].get(e);if(n){const i=n.value;if(ge(r,i)){if(Gt(r,n),!r[se])return}else t&&(r[Wr]&&(n.value.now=Date.now()),r[z].unshiftNode(n));return i.value}},ge=(r,e)=>{if(!e||!e.maxAge&&!r[Lt])return!1;const t=Date.now()-e.now;return e.maxAge?t>e.maxAge:r[Lt]&&t>r[Lt]},Jt=r=>{if(r[It]>r[Rt])for(let e=r[z].tail;r[It]>r[Rt]&&e!==null;){const t=e.prev;Gt(r,e),e=t}},Gt=(r,e)=>{if(e){const t=e.value;r[Et]&&r[Et](t.key,t.value),r[It]-=t.length,r[pt].delete(t.key),r[z].removeNode(e)}};class Oi{constructor(e,t,n,i,o){this.key=e,this.value=t,this.length=n,this.now=i,this.maxAge=o||0}}const pr=(r,e,t,n)=>{let i=t.value;ge(r,i)&&(Gt(r,t),r[se]||(i=void 0)),i&&e.call(n,i.value,i.key,r)};var ki=Ti,Fr={},Mi=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ae=function(){function r(e){e===void 0&&(e=0),this.iteratorType=e}return r.prototype.equals=function(e){return this.o===e.o},r}(),xe=function(){function r(){this.M=0}return Object.defineProperty(r.prototype,"length",{get:function(){return this.M},enumerable:!1,configurable:!0}),r.prototype.size=function(){return this.M},r.prototype.empty=function(){return this.M===0},r}(),nr=function(r){Mi(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(xe),Ci=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bi=function(r){Ci(e,r);function e(t){t===void 0&&(t=[]);var n=r.call(this)||this;n.nt=[];var i=n;return t.forEach(function(o){i.push(o)}),n}return e.prototype.clear=function(){this.M=0,this.nt=[]},e.prototype.push=function(t){return this.nt.push(t),this.M+=1,this.M},e.prototype.pop=function(){if(this.M!==0)return this.M-=1,this.nt.pop()},e.prototype.top=function(){return this.nt[this.M-1]},e}(xe),Ni=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ri=function(r){Ni(e,r);function e(t){t===void 0&&(t=[]);var n=r.call(this)||this;n.A=0,n.tt=[];var i=n;return t.forEach(function(o){i.push(o)}),n}return e.prototype.clear=function(){this.tt=[],this.M=this.A=0},e.prototype.push=function(t){var n=this.tt.length;if(this.A/n>.5&&this.A+this.M>=n&&n>4096){for(var i=this.M,o=0;o<i;++o)this.tt[o]=this.tt[this.A+o];this.A=0,this.tt[this.M]=t}else this.tt[this.A+this.M]=t;return++this.M},e.prototype.pop=function(){if(this.M!==0){var t=this.tt[this.A++];return this.M-=1,t}},e.prototype.front=function(){if(this.M!==0)return this.tt[this.A]},e}(xe),Li=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),dr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},yr=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},ji=function(r){Li(e,r);function e(t,n,i){t===void 0&&(t=[]),n===void 0&&(n=function(a,f){return a>f?-1:a<f?1:0}),i===void 0&&(i=!0);var o=r.call(this)||this;if(o.$=n,Array.isArray(t))o.ii=i?yr([],dr(t),!1):t;else{o.ii=[];var s=o;t.forEach(function(a){s.ii.push(a)})}o.M=o.ii.length;for(var u=o.M>>1,c=o.M-1>>1;c>=0;--c)o.ri(c,u);return o}return e.prototype.ti=function(t){for(var n=this.ii[t];t>0;){var i=t-1>>1,o=this.ii[i];if(this.$(o,n)<=0)break;this.ii[t]=o,t=i}this.ii[t]=n},e.prototype.ri=function(t,n){for(var i=this.ii[t];t<n;){var o=t<<1|1,s=o+1,u=this.ii[o];if(s<this.M&&this.$(u,this.ii[s])>0&&(o=s,u=this.ii[s]),this.$(u,i)>=0)break;this.ii[t]=u,t=o}this.ii[t]=i},e.prototype.clear=function(){this.M=0,this.ii.length=0},e.prototype.push=function(t){this.ii.push(t),this.ti(this.M),this.M+=1},e.prototype.pop=function(){if(this.M!==0){var t=this.ii[0],n=this.ii.pop();return this.M-=1,this.M&&(this.ii[0]=n,this.ri(0,this.M>>1)),t}},e.prototype.top=function(){return this.ii[0]},e.prototype.find=function(t){return this.ii.indexOf(t)>=0},e.prototype.remove=function(t){var n=this.ii.indexOf(t);return n<0?!1:(n===0?this.pop():n===this.M-1?(this.ii.pop(),this.M-=1):(this.ii.splice(n,1,this.ii.pop()),this.M-=1,this.ti(n),this.ri(n,this.M>>1)),!0)},e.prototype.updateItem=function(t){var n=this.ii.indexOf(t);return n<0?!1:(this.ti(n),this.ri(n,this.M>>1),!0)},e.prototype.toArray=function(){return yr([],dr(this.ii),!1)},e}(xe),$i=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ir=function(r){$i(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(nr);function G(){throw new RangeError("Iterator access denied!")}var Ui=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),zr=function(r){Ui(e,r);function e(t,n){var i=r.call(this,n)||this;return i.o=t,i.iteratorType===0?(i.pre=function(){return this.o===0&&G(),this.o-=1,this},i.next=function(){return this.o===this.container.size()&&G(),this.o+=1,this}):(i.pre=function(){return this.o===this.container.size()-1&&G(),this.o+=1,this},i.next=function(){return this.o===-1&&G(),this.o-=1,this}),i}return Object.defineProperty(e.prototype,"pointer",{get:function(){return this.container.getElementByPos(this.o)},set:function(t){this.container.setElementByPos(this.o,t)},enumerable:!1,configurable:!0}),e}(Ae),Qr=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),qi=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},gr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},mr=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Ki=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zt=function(r){Qr(e,r);function e(t,n,i){var o=r.call(this,t,i)||this;return o.container=n,o}return e.prototype.copy=function(){return new e(this.o,this.container,this.iteratorType)},e}(zr),Di=function(r){Qr(e,r);function e(t,n){t===void 0&&(t=[]),n===void 0&&(n=!0);var i=r.call(this)||this;if(Array.isArray(t))i.J=n?mr([],gr(t),!1):t,i.M=t.length;else{i.J=[];var o=i;t.forEach(function(s){o.pushBack(s)})}return i}return e.prototype.clear=function(){this.M=0,this.J.length=0},e.prototype.begin=function(){return new Zt(0,this)},e.prototype.end=function(){return new Zt(this.M,this)},e.prototype.rBegin=function(){return new Zt(this.M-1,this,1)},e.prototype.rEnd=function(){return new Zt(-1,this,1)},e.prototype.front=function(){return this.J[0]},e.prototype.back=function(){return this.J[this.M-1]},e.prototype.getElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;return this.J[t]},e.prototype.eraseElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;return this.J.splice(t,1),this.M-=1,this.M},e.prototype.eraseElementByValue=function(t){for(var n=0,i=0;i<this.M;++i)this.J[i]!==t&&(this.J[n++]=this.J[i]);return this.M=this.J.length=n,this.M},e.prototype.eraseElementByIterator=function(t){var n=t.o;return t=t.next(),this.eraseElementByPos(n),t},e.prototype.pushBack=function(t){return this.J.push(t),this.M+=1,this.M},e.prototype.popBack=function(){if(this.M!==0)return this.M-=1,this.J.pop()},e.prototype.setElementByPos=function(t,n){if(t<0||t>this.M-1)throw new RangeError;this.J[t]=n},e.prototype.insert=function(t,n,i){var o;if(i===void 0&&(i=1),t<0||t>this.M)throw new RangeError;return(o=this.J).splice.apply(o,mr([t,0],gr(new Array(i).fill(n)),!1)),this.M+=i,this.M},e.prototype.find=function(t){for(var n=0;n<this.M;++n)if(this.J[n]===t)return new Zt(n,this);return this.end()},e.prototype.reverse=function(){this.J.reverse()},e.prototype.unique=function(){for(var t=1,n=1;n<this.M;++n)this.J[n]!==this.J[n-1]&&(this.J[t++]=this.J[n]);return this.M=this.J.length=t,this.M},e.prototype.sort=function(t){this.J.sort(t)},e.prototype.forEach=function(t){for(var n=0;n<this.M;++n)t(this.J[n],n,this)},e.prototype[Symbol.iterator]=function(){return(function(){return qi(this,function(t){switch(t.label){case 0:return[5,Ki(this.J)];case 1:return t.sent(),[2]}})}).bind(this)()},e}(ir),Yr=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Hi=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Xt=function(r){Yr(e,r);function e(t,n,i,o){var s=r.call(this,o)||this;return s.o=t,s.h=n,s.container=i,s.iteratorType===0?(s.pre=function(){return this.o.L===this.h&&G(),this.o=this.o.L,this},s.next=function(){return this.o===this.h&&G(),this.o=this.o.m,this}):(s.pre=function(){return this.o.m===this.h&&G(),this.o=this.o.m,this},s.next=function(){return this.o===this.h&&G(),this.o=this.o.L,this}),s}return Object.defineProperty(e.prototype,"pointer",{get:function(){return this.o===this.h&&G(),this.o.p},set:function(t){this.o===this.h&&G(),this.o.p=t},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.o,this.h,this.container,this.iteratorType)},e}(Ae),Gi=function(r){Yr(e,r);function e(t){t===void 0&&(t=[]);var n=r.call(this)||this;n.h={},n.H=n.l=n.h.L=n.h.m=n.h;var i=n;return t.forEach(function(o){i.pushBack(o)}),n}return e.prototype.G=function(t){var n=t.L,i=t.m;n.m=i,i.L=n,t===this.H&&(this.H=i),t===this.l&&(this.l=n),this.M-=1},e.prototype.F=function(t,n){var i=n.m,o={p:t,L:n,m:i};n.m=o,i.L=o,n===this.h&&(this.H=o),i===this.h&&(this.l=o),this.M+=1},e.prototype.clear=function(){this.M=0,this.H=this.l=this.h.L=this.h.m=this.h},e.prototype.begin=function(){return new Xt(this.H,this.h,this)},e.prototype.end=function(){return new Xt(this.h,this.h,this)},e.prototype.rBegin=function(){return new Xt(this.l,this.h,this,1)},e.prototype.rEnd=function(){return new Xt(this.h,this.h,this,1)},e.prototype.front=function(){return this.H.p},e.prototype.back=function(){return this.l.p},e.prototype.getElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;for(var n=this.H;t--;)n=n.m;return n.p},e.prototype.eraseElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;for(var n=this.H;t--;)n=n.m;return this.G(n),this.M},e.prototype.eraseElementByValue=function(t){for(var n=this.H;n!==this.h;)n.p===t&&this.G(n),n=n.m;return this.M},e.prototype.eraseElementByIterator=function(t){var n=t.o;return n===this.h&&G(),t=t.next(),this.G(n),t},e.prototype.pushBack=function(t){return this.F(t,this.l),this.M},e.prototype.popBack=function(){if(this.M!==0){var t=this.l.p;return this.G(this.l),t}},e.prototype.pushFront=function(t){return this.F(t,this.h),this.M},e.prototype.popFront=function(){if(this.M!==0){var t=this.H.p;return this.G(this.H),t}},e.prototype.setElementByPos=function(t,n){if(t<0||t>this.M-1)throw new RangeError;for(var i=this.H;t--;)i=i.m;i.p=n},e.prototype.insert=function(t,n,i){if(i===void 0&&(i=1),t<0||t>this.M)throw new RangeError;if(i<=0)return this.M;if(t===0)for(;i--;)this.pushFront(n);else if(t===this.M)for(;i--;)this.pushBack(n);else{for(var o=this.H,s=1;s<t;++s)o=o.m;var u=o.m;for(this.M+=i;i--;)o.m={p:n,L:o},o.m.L=o,o=o.m;o.m=u,u.L=o}return this.M},e.prototype.find=function(t){for(var n=this.H;n!==this.h;){if(n.p===t)return new Xt(n,this.h,this);n=n.m}return this.end()},e.prototype.reverse=function(){if(!(this.M<=1))for(var t=this.H,n=this.l,i=0;i<<1<this.M;){var o=t.p;t.p=n.p,n.p=o,t=t.m,n=n.L,i+=1}},e.prototype.unique=function(){if(this.M<=1)return this.M;for(var t=this.H;t!==this.h;){for(var n=t;n.m!==this.h&&n.p===n.m.p;)n=n.m,this.M-=1;t.m=n.m,t.m.L=t,t=t.m}return this.M},e.prototype.sort=function(t){if(!(this.M<=1)){var n=[];this.forEach(function(o){n.push(o)}),n.sort(t);var i=this.H;n.forEach(function(o){i.p=o,i=i.m})}},e.prototype.merge=function(t){var n=this;if(this.M===0)t.forEach(function(o){n.pushBack(o)});else{var i=this.H;t.forEach(function(o){for(;i!==n.h&&i.p<=o;)i=i.m;n.F(o,i.L)})}return this.M},e.prototype.forEach=function(t){for(var n=this.H,i=0;n!==this.h;)t(n.p,i++,this),n=n.m},e.prototype[Symbol.iterator]=function(){return(function(){var t;return Hi(this,function(n){switch(n.label){case 0:if(this.M===0)return[2];t=this.H,n.label=1;case 1:return t===this.h?[3,3]:[4,t.p];case 2:return n.sent(),t=t.m,[3,1];case 3:return[2]}})}).bind(this)()},e}(ir),Jr=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Vi=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Wi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Fi=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},te=function(r){Jr(e,r);function e(t,n,i){var o=r.call(this,t,i)||this;return o.container=n,o}return e.prototype.copy=function(){return new e(this.o,this.container,this.iteratorType)},e}(zr),zi=function(r){Jr(e,r);function e(t,n){t===void 0&&(t=[]),n===void 0&&(n=4096);var i=r.call(this)||this;i.A=0,i.S=0,i.R=0,i.k=0,i.C=0,i.j=[];var o=function(){if(typeof t.length=="number")return t.length;if(typeof t.size=="number")return t.size;if(typeof t.size=="function")return t.size();throw new TypeError("Cannot get the length or size of the container")}();i.B=n,i.C=Math.max(Math.ceil(o/i.B),1);for(var s=0;s<i.C;++s)i.j.push(new Array(i.B));var u=Math.ceil(o/i.B);i.A=i.R=(i.C>>1)-(u>>1),i.S=i.k=i.B-o%i.B>>1;var c=i;return t.forEach(function(a){c.pushBack(a)}),i}return e.prototype.O=function(){for(var t=[],n=Math.max(this.C>>1,1),i=0;i<n;++i)t[i]=new Array(this.B);for(var i=this.A;i<this.C;++i)t[t.length]=this.j[i];for(var i=0;i<this.R;++i)t[t.length]=this.j[i];t[t.length]=Fi([],Wi(this.j[this.R]),!1),this.A=n,this.R=t.length-1;for(var i=0;i<n;++i)t[t.length]=new Array(this.B);this.j=t,this.C=t.length},e.prototype.T=function(t){var n=this.S+t+1,i=n%this.B,o=i-1,s=this.A+(n-i)/this.B;return i===0&&(s-=1),s%=this.C,o<0&&(o+=this.B),{curNodeBucketIndex:s,curNodePointerIndex:o}},e.prototype.clear=function(){this.j=[new Array(this.B)],this.C=1,this.A=this.R=this.M=0,this.S=this.k=this.B>>1},e.prototype.begin=function(){return new te(0,this)},e.prototype.end=function(){return new te(this.M,this)},e.prototype.rBegin=function(){return new te(this.M-1,this,1)},e.prototype.rEnd=function(){return new te(-1,this,1)},e.prototype.front=function(){if(this.M!==0)return this.j[this.A][this.S]},e.prototype.back=function(){if(this.M!==0)return this.j[this.R][this.k]},e.prototype.pushBack=function(t){return this.M&&(this.k<this.B-1?this.k+=1:this.R<this.C-1?(this.R+=1,this.k=0):(this.R=0,this.k=0),this.R===this.A&&this.k===this.S&&this.O()),this.M+=1,this.j[this.R][this.k]=t,this.M},e.prototype.popBack=function(){if(this.M!==0){var t=this.j[this.R][this.k];return this.M!==1&&(this.k>0?this.k-=1:this.R>0?(this.R-=1,this.k=this.B-1):(this.R=this.C-1,this.k=this.B-1)),this.M-=1,t}},e.prototype.pushFront=function(t){return this.M&&(this.S>0?this.S-=1:this.A>0?(this.A-=1,this.S=this.B-1):(this.A=this.C-1,this.S=this.B-1),this.A===this.R&&this.S===this.k&&this.O()),this.M+=1,this.j[this.A][this.S]=t,this.M},e.prototype.popFront=function(){if(this.M!==0){var t=this.j[this.A][this.S];return this.M!==1&&(this.S<this.B-1?this.S+=1:this.A<this.C-1?(this.A+=1,this.S=0):(this.A=0,this.S=0)),this.M-=1,t}},e.prototype.getElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;var n=this.T(t),i=n.curNodeBucketIndex,o=n.curNodePointerIndex;return this.j[i][o]},e.prototype.setElementByPos=function(t,n){if(t<0||t>this.M-1)throw new RangeError;var i=this.T(t),o=i.curNodeBucketIndex,s=i.curNodePointerIndex;this.j[o][s]=n},e.prototype.insert=function(t,n,i){if(i===void 0&&(i=1),t<0||t>this.M)throw new RangeError;if(t===0)for(;i--;)this.pushFront(n);else if(t===this.M)for(;i--;)this.pushBack(n);else{for(var o=[],s=t;s<this.M;++s)o.push(this.getElementByPos(s));this.cut(t-1);for(var s=0;s<i;++s)this.pushBack(n);for(var s=0;s<o.length;++s)this.pushBack(o[s])}return this.M},e.prototype.cut=function(t){if(t<0)return this.clear(),0;var n=this.T(t),i=n.curNodeBucketIndex,o=n.curNodePointerIndex;return this.R=i,this.k=o,this.M=t+1,this.M},e.prototype.eraseElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;if(t===0)this.popFront();else if(t===this.M-1)this.popBack();else{for(var n=[],i=t+1;i<this.M;++i)n.push(this.getElementByPos(i));this.cut(t),this.popBack();var o=this;n.forEach(function(s){o.pushBack(s)})}return this.M},e.prototype.eraseElementByValue=function(t){if(this.M===0)return 0;for(var n=[],i=0;i<this.M;++i){var o=this.getElementByPos(i);o!==t&&n.push(o)}for(var s=n.length,i=0;i<s;++i)this.setElementByPos(i,n[i]);return this.cut(s-1)},e.prototype.eraseElementByIterator=function(t){var n=t.o;return this.eraseElementByPos(n),t=t.next(),t},e.prototype.find=function(t){for(var n=0;n<this.M;++n)if(this.getElementByPos(n)===t)return new te(n,this);return this.end()},e.prototype.reverse=function(){for(var t=0,n=this.M-1;t<n;){var i=this.getElementByPos(t);this.setElementByPos(t,this.getElementByPos(n)),this.setElementByPos(n,i),t+=1,n-=1}},e.prototype.unique=function(){if(this.M<=1)return this.M;for(var t=1,n=this.getElementByPos(0),i=1;i<this.M;++i){var o=this.getElementByPos(i);o!==n&&(n=o,this.setElementByPos(t++,o))}for(;this.M>t;)this.popBack();return this.M},e.prototype.sort=function(t){for(var n=[],i=0;i<this.M;++i)n.push(this.getElementByPos(i));n.sort(t);for(var i=0;i<this.M;++i)this.setElementByPos(i,n[i])},e.prototype.shrinkToFit=function(){if(this.M!==0){var t=[];this.forEach(function(i){t.push(i)}),this.C=Math.max(Math.ceil(this.M/this.B),1),this.M=this.A=this.R=this.S=this.k=0,this.j=[];for(var n=0;n<this.C;++n)this.j.push(new Array(this.B));for(var n=0;n<t.length;++n)this.pushBack(t[n])}},e.prototype.forEach=function(t){for(var n=0;n<this.M;++n)t(this.getElementByPos(n),n,this)},e.prototype[Symbol.iterator]=function(){return(function(){var t;return Vi(this,function(n){switch(n.label){case 0:t=0,n.label=1;case 1:return t<this.M?[4,this.getElementByPos(t)]:[3,4];case 2:n.sent(),n.label=3;case 3:return++t,[3,1];case 4:return[2]}})}).bind(this)()},e}(ir),Qi=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zr=function(){function r(e,t){this.ee=1,this.u=void 0,this.p=void 0,this.K=void 0,this.N=void 0,this.rr=void 0,this.u=e,this.p=t}return r.prototype.L=function(){var e=this;if(e.ee===1&&e.rr.rr===e)e=e.N;else if(e.K)for(e=e.K;e.N;)e=e.N;else{for(var t=e.rr;t.K===e;)e=t,t=e.rr;e=t}return e},r.prototype.m=function(){var e=this;if(e.N){for(e=e.N;e.K;)e=e.K;return e}else{for(var t=e.rr;t.N===e;)e=t,t=e.rr;return e.N!==t?t:e}},r.prototype.ne=function(){var e=this.rr,t=this.N,n=t.K;return e.rr===this?e.rr=t:e.K===this?e.K=t:e.N=t,t.rr=e,t.K=this,this.rr=t,this.N=n,n&&(n.rr=this),t},r.prototype.te=function(){var e=this.rr,t=this.K,n=t.N;return e.rr===this?e.rr=t:e.K===this?e.K=t:e.N=t,t.rr=e,t.N=this,this.rr=t,this.K=n,n&&(n.rr=this),t},r}(),Yi=function(r){Qi(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.tr=1,t}return e.prototype.ne=function(){var t=r.prototype.ne.call(this);return this.ie(),t.ie(),t},e.prototype.te=function(){var t=r.prototype.te.call(this);return this.ie(),t.ie(),t},e.prototype.ie=function(){this.tr=1,this.K&&(this.tr+=this.K.tr),this.N&&(this.tr+=this.N.tr)},e}(Zr),Ji=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},_r=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Xr=function(r){Ji(e,r);function e(t,n){t===void 0&&(t=function(o,s){return o<s?-1:o>s?1:0}),n===void 0&&(n=!1);var i=r.call(this)||this;return i.W=void 0,i.$=t,n?(i.re=Yi,i.v=function(o,s,u){var c=this.se(o,s,u);if(c){for(var a=c.rr;a!==this.h;)a.tr+=1,a=a.rr;var f=this.fe(c);if(f){var h=f,l=h.parentNode,p=h.grandParent,g=h.curNode;l.ie(),p.ie(),g.ie()}}return this.M},i.G=function(o){for(var s=this.he(o);s!==this.h;)s.tr-=1,s=s.rr}):(i.re=Zr,i.v=function(o,s,u){var c=this.se(o,s,u);return c&&this.fe(c),this.M},i.G=i.he),i.h=new i.re,i}return e.prototype.U=function(t,n){for(var i=this.h;t;){var o=this.$(t.u,n);if(o<0)t=t.N;else if(o>0)i=t,t=t.K;else return t}return i},e.prototype.X=function(t,n){for(var i=this.h;t;){var o=this.$(t.u,n);o<=0?t=t.N:(i=t,t=t.K)}return i},e.prototype.Y=function(t,n){for(var i=this.h;t;){var o=this.$(t.u,n);if(o<0)i=t,t=t.N;else if(o>0)t=t.K;else return t}return i},e.prototype.Z=function(t,n){for(var i=this.h;t;){var o=this.$(t.u,n);o<0?(i=t,t=t.N):t=t.K}return i},e.prototype.ue=function(t){for(;;){var n=t.rr;if(n===this.h)return;if(t.ee===1){t.ee=0;return}if(t===n.K){var i=n.N;if(i.ee===1)i.ee=0,n.ee=1,n===this.W?this.W=n.ne():n.ne();else if(i.N&&i.N.ee===1){i.ee=n.ee,n.ee=0,i.N.ee=0,n===this.W?this.W=n.ne():n.ne();return}else i.K&&i.K.ee===1?(i.ee=1,i.K.ee=0,i.te()):(i.ee=1,t=n)}else{var i=n.K;if(i.ee===1)i.ee=0,n.ee=1,n===this.W?this.W=n.te():n.te();else if(i.K&&i.K.ee===1){i.ee=n.ee,n.ee=0,i.K.ee=0,n===this.W?this.W=n.te():n.te();return}else i.N&&i.N.ee===1?(i.ee=1,i.N.ee=0,i.ne()):(i.ee=1,t=n)}}},e.prototype.he=function(t){var n,i;if(this.M===1)return this.clear(),this.h;for(var o=t;o.K||o.N;){if(o.N)for(o=o.N;o.K;)o=o.K;else o=o.K;n=vr([o.u,t.u],2),t.u=n[0],o.u=n[1],i=vr([o.p,t.p],2),t.p=i[0],o.p=i[1],t=o}this.h.K===o?this.h.K=o.rr:this.h.N===o&&(this.h.N=o.rr),this.ue(o);var s=o.rr;return o===s.K?s.K=void 0:s.N=void 0,this.M-=1,this.W.ee=0,s},e.prototype.ae=function(t,n){if(t===void 0)return!1;var i=this.ae(t.K,n);return i||n(t)?!0:this.ae(t.N,n)},e.prototype.fe=function(t){for(;;){var n=t.rr;if(n.ee===0)return;var i=n.rr;if(n===i.K){var o=i.N;if(o&&o.ee===1){if(o.ee=n.ee=0,i===this.W)return;i.ee=1,t=i;continue}else if(t===n.N){if(t.ee=0,t.K&&(t.K.rr=n),t.N&&(t.N.rr=i),n.N=t.K,i.K=t.N,t.K=n,t.N=i,i===this.W)this.W=t,this.h.rr=t;else{var s=i.rr;s.K===i?s.K=t:s.N=t}return t.rr=i.rr,n.rr=t,i.rr=t,i.ee=1,{parentNode:n,grandParent:i,curNode:t}}else n.ee=0,i===this.W?this.W=i.te():i.te(),i.ee=1}else{var o=i.K;if(o&&o.ee===1){if(o.ee=n.ee=0,i===this.W)return;i.ee=1,t=i;continue}else if(t===n.K){if(t.ee=0,t.K&&(t.K.rr=i),t.N&&(t.N.rr=n),i.N=t.K,n.K=t.N,t.K=i,t.N=n,i===this.W)this.W=t,this.h.rr=t;else{var s=i.rr;s.K===i?s.K=t:s.N=t}return t.rr=i.rr,n.rr=t,i.rr=t,i.ee=1,{parentNode:n,grandParent:i,curNode:t}}else n.ee=0,i===this.W?this.W=i.ne():i.ne(),i.ee=1}return}},e.prototype.se=function(t,n,i){if(this.W===void 0){this.M+=1,this.W=new this.re(t,n),this.W.ee=0,this.W.rr=this.h,this.h.rr=this.W,this.h.K=this.W,this.h.N=this.W;return}var o,s=this.h.K,u=this.$(s.u,t);if(u===0){s.p=n;return}else if(u>0)s.K=new this.re(t,n),s.K.rr=s,o=s.K,this.h.K=o;else{var c=this.h.N,a=this.$(c.u,t);if(a===0){c.p=n;return}else if(a<0)c.N=new this.re(t,n),c.N.rr=c,o=c.N,this.h.N=o;else{if(i!==void 0){var f=i.o;if(f!==this.h){var h=this.$(f.u,t);if(h===0){f.p=n;return}else if(h>0){var l=f.L(),p=this.$(l.u,t);if(p===0){l.p=n;return}else p<0&&(o=new this.re(t,n),l.N===void 0?(l.N=o,o.rr=l):(f.K=o,o.rr=f))}}}if(o===void 0)for(o=this.W;;){var g=this.$(o.u,t);if(g>0){if(o.K===void 0){o.K=new this.re(t,n),o.K.rr=o,o=o.K;break}o=o.K}else if(g<0){if(o.N===void 0){o.N=new this.re(t,n),o.N.rr=o,o=o.N;break}o=o.N}else{o.p=n;return}}}}return this.M+=1,o},e.prototype.g=function(t,n){for(;t;){var i=this.$(t.u,n);if(i<0)t=t.N;else if(i>0)t=t.K;else return t}return t||this.h},e.prototype.clear=function(){this.M=0,this.W=void 0,this.h.rr=void 0,this.h.K=this.h.N=void 0},e.prototype.updateKeyByIterator=function(t,n){var i=t.o;if(i===this.h&&G(),this.M===1)return i.u=n,!0;if(i===this.h.K)return this.$(i.m().u,n)>0?(i.u=n,!0):!1;if(i===this.h.N)return this.$(i.L().u,n)<0?(i.u=n,!0):!1;var o=i.L().u;if(this.$(o,n)>=0)return!1;var s=i.m().u;return this.$(s,n)<=0?!1:(i.u=n,!0)},e.prototype.eraseElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;var n=0,i=this;return this.ae(this.W,function(o){return t===n?(i.G(o),!0):(n+=1,!1)}),this.M},e.prototype.eraseElementByKey=function(t){if(this.M===0)return!1;var n=this.g(this.W,t);return n===this.h?!1:(this.G(n),!0)},e.prototype.eraseElementByIterator=function(t){var n=t.o;n===this.h&&G();var i=n.N===void 0,o=t.iteratorType===0;return o?i&&t.next():(!i||n.K===void 0)&&t.next(),this.G(n),t},e.prototype.forEach=function(t){var n,i,o=0;try{for(var s=_r(this),u=s.next();!u.done;u=s.next()){var c=u.value;t(c,o++,this)}}catch(a){n={error:a}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},e.prototype.getElementByPos=function(t){var n,i;if(t<0||t>this.M-1)throw new RangeError;var o,s=0;try{for(var u=_r(this),c=u.next();!c.done;c=u.next()){var a=c.value;if(s===t){o=a;break}s+=1}}catch(f){n={error:f}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return o},e.prototype.getHeight=function(){if(this.M===0)return 0;var t=function(n){return n?Math.max(t(n.K),t(n.N))+1:0};return t(this.W)},e}(nr),Zi=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),tn=function(r){Zi(e,r);function e(t,n,i){var o=r.call(this,i)||this;return o.o=t,o.h=n,o.iteratorType===0?(o.pre=function(){return this.o===this.h.K&&G(),this.o=this.o.L(),this},o.next=function(){return this.o===this.h&&G(),this.o=this.o.m(),this}):(o.pre=function(){return this.o===this.h.N&&G(),this.o=this.o.m(),this},o.next=function(){return this.o===this.h&&G(),this.o=this.o.L(),this}),o}return Object.defineProperty(e.prototype,"index",{get:function(){var t=this.o,n=this.h.rr;if(t===this.h)return n?n.tr-1:0;var i=0;for(t.K&&(i+=t.K.tr);t!==n;){var o=t.rr;t===o.N&&(i+=1,o.K&&(i+=o.K.tr)),t=o}return i},enumerable:!1,configurable:!0}),e}(Ae),en=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Xi=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},br=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wt=function(r){en(e,r);function e(t,n,i,o){var s=r.call(this,t,n,o)||this;return s.container=i,s}return Object.defineProperty(e.prototype,"pointer",{get:function(){return this.o===this.h&&G(),this.o.u},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.o,this.h,this.container,this.iteratorType)},e}(tn),to=function(r){en(e,r);function e(t,n,i){t===void 0&&(t=[]);var o=r.call(this,n,i)||this,s=o;return t.forEach(function(u){s.insert(u)}),o}return e.prototype.P=function(t){return Xi(this,function(n){switch(n.label){case 0:return t===void 0?[2]:[5,br(this.P(t.K))];case 1:return n.sent(),[4,t.u];case 2:return n.sent(),[5,br(this.P(t.N))];case 3:return n.sent(),[2]}})},e.prototype.begin=function(){return new wt(this.h.K||this.h,this.h,this)},e.prototype.end=function(){return new wt(this.h,this.h,this)},e.prototype.rBegin=function(){return new wt(this.h.N||this.h,this.h,this,1)},e.prototype.rEnd=function(){return new wt(this.h,this.h,this,1)},e.prototype.front=function(){return this.h.K?this.h.K.u:void 0},e.prototype.back=function(){return this.h.N?this.h.N.u:void 0},e.prototype.insert=function(t,n){return this.v(t,void 0,n)},e.prototype.find=function(t){var n=this.g(this.W,t);return new wt(n,this.h,this)},e.prototype.lowerBound=function(t){var n=this.U(this.W,t);return new wt(n,this.h,this)},e.prototype.upperBound=function(t){var n=this.X(this.W,t);return new wt(n,this.h,this)},e.prototype.reverseLowerBound=function(t){var n=this.Y(this.W,t);return new wt(n,this.h,this)},e.prototype.reverseUpperBound=function(t){var n=this.Z(this.W,t);return new wt(n,this.h,this)},e.prototype.union=function(t){var n=this;return t.forEach(function(i){n.insert(i)}),this.M},e.prototype[Symbol.iterator]=function(){return this.P(this.W)},e}(Xr),rn=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),eo=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},wr=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},St=function(r){rn(e,r);function e(t,n,i,o){var s=r.call(this,t,n,o)||this;return s.container=i,s}return Object.defineProperty(e.prototype,"pointer",{get:function(){this.o===this.h&&G();var t=this;return new Proxy([],{get:function(n,i){if(i==="0")return t.o.u;if(i==="1")return t.o.p},set:function(n,i,o){if(i!=="1")throw new TypeError("props must be 1");return t.o.p=o,!0}})},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.o,this.h,this.container,this.iteratorType)},e}(tn),ro=function(r){rn(e,r);function e(t,n,i){t===void 0&&(t=[]);var o=r.call(this,n,i)||this,s=o;return t.forEach(function(u){s.setElement(u[0],u[1])}),o}return e.prototype.P=function(t){return eo(this,function(n){switch(n.label){case 0:return t===void 0?[2]:[5,wr(this.P(t.K))];case 1:return n.sent(),[4,[t.u,t.p]];case 2:return n.sent(),[5,wr(this.P(t.N))];case 3:return n.sent(),[2]}})},e.prototype.begin=function(){return new St(this.h.K||this.h,this.h,this)},e.prototype.end=function(){return new St(this.h,this.h,this)},e.prototype.rBegin=function(){return new St(this.h.N||this.h,this.h,this,1)},e.prototype.rEnd=function(){return new St(this.h,this.h,this,1)},e.prototype.front=function(){if(this.M!==0){var t=this.h.K;return[t.u,t.p]}},e.prototype.back=function(){if(this.M!==0){var t=this.h.N;return[t.u,t.p]}},e.prototype.lowerBound=function(t){var n=this.U(this.W,t);return new St(n,this.h,this)},e.prototype.upperBound=function(t){var n=this.X(this.W,t);return new St(n,this.h,this)},e.prototype.reverseLowerBound=function(t){var n=this.Y(this.W,t);return new St(n,this.h,this)},e.prototype.reverseUpperBound=function(t){var n=this.Z(this.W,t);return new St(n,this.h,this)},e.prototype.setElement=function(t,n,i){return this.v(t,n,i)},e.prototype.find=function(t){var n=this.g(this.W,t);return new St(n,this.h,this)},e.prototype.getElementByKey=function(t){var n=this.g(this.W,t);return n.p},e.prototype.union=function(t){var n=this;return t.forEach(function(i){n.setElement(i[0],i[1])}),this.M},e.prototype[Symbol.iterator]=function(){return this.P(this.W)},e}(Xr);function de(r){var e=typeof r;return e==="object"&&r!==null||e==="function"}var nn=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),on=function(r){nn(e,r);function e(t,n,i){var o=r.call(this,i)||this;return o.o=t,o.h=n,o.iteratorType===0?(o.pre=function(){return this.o.L===this.h&&G(),this.o=this.o.L,this},o.next=function(){return this.o===this.h&&G(),this.o=this.o.m,this}):(o.pre=function(){return this.o.m===this.h&&G(),this.o=this.o.m,this},o.next=function(){return this.o===this.h&&G(),this.o=this.o.L,this}),o}return e}(Ae),sn=function(r){nn(e,r);function e(){var t=r.call(this)||this;return t._=[],t.I={},t.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(t.I,null),t.h={},t.h.L=t.h.m=t.H=t.l=t.h,t}return e.prototype.G=function(t){var n=t.L,i=t.m;n.m=i,i.L=n,t===this.H&&(this.H=i),t===this.l&&(this.l=n),this.M-=1},e.prototype.v=function(t,n,i){i===void 0&&(i=de(t));var o;if(i){var s=t[this.HASH_TAG];if(s!==void 0)return this._[s].p=n,this.M;Object.defineProperty(t,this.HASH_TAG,{value:this._.length,configurable:!0}),o={u:t,p:n,L:this.l,m:this.h},this._.push(o)}else{var u=this.I[t];if(u)return u.p=n,this.M;o={u:t,p:n,L:this.l,m:this.h},this.I[t]=o}return this.M===0?(this.H=o,this.h.m=o):this.l.m=o,this.l=o,this.h.L=o,++this.M},e.prototype.g=function(t,n){if(n===void 0&&(n=de(t)),n){var i=t[this.HASH_TAG];return i===void 0?this.h:this._[i]}else return this.I[t]||this.h},e.prototype.clear=function(){var t=this.HASH_TAG;this._.forEach(function(n){delete n.u[t]}),this._=[],this.I={},Object.setPrototypeOf(this.I,null),this.M=0,this.H=this.l=this.h.L=this.h.m=this.h},e.prototype.eraseElementByKey=function(t,n){var i;if(n===void 0&&(n=de(t)),n){var o=t[this.HASH_TAG];if(o===void 0)return!1;delete t[this.HASH_TAG],i=this._[o],delete this._[o]}else{if(i=this.I[t],i===void 0)return!1;delete this.I[t]}return this.G(i),!0},e.prototype.eraseElementByIterator=function(t){var n=t.o;return n===this.h&&G(),this.G(n),t.next()},e.prototype.eraseElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;for(var n=this.H;t--;)n=n.m;return this.G(n),this.M},e}(nr),an=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),no=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ee=function(r){an(e,r);function e(t,n,i,o){var s=r.call(this,t,n,o)||this;return s.container=i,s}return Object.defineProperty(e.prototype,"pointer",{get:function(){return this.o===this.h&&G(),this.o.u},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.o,this.h,this.container,this.iteratorType)},e}(on),io=function(r){an(e,r);function e(t){t===void 0&&(t=[]);var n=r.call(this)||this,i=n;return t.forEach(function(o){i.insert(o)}),n}return e.prototype.begin=function(){return new ee(this.H,this.h,this)},e.prototype.end=function(){return new ee(this.h,this.h,this)},e.prototype.rBegin=function(){return new ee(this.l,this.h,this,1)},e.prototype.rEnd=function(){return new ee(this.h,this.h,this,1)},e.prototype.front=function(){return this.H.u},e.prototype.back=function(){return this.l.u},e.prototype.insert=function(t,n){return this.v(t,void 0,n)},e.prototype.getElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;for(var n=this.H;t--;)n=n.m;return n.u},e.prototype.find=function(t,n){var i=this.g(t,n);return new ee(i,this.h,this)},e.prototype.forEach=function(t){for(var n=0,i=this.H;i!==this.h;)t(i.u,n++,this),i=i.m},e.prototype[Symbol.iterator]=function(){return(function(){var t;return no(this,function(n){switch(n.label){case 0:t=this.H,n.label=1;case 1:return t===this.h?[3,3]:[4,t.u];case 2:return n.sent(),t=t.m,[3,1];case 3:return[2]}})}).bind(this)()},e}(sn),un=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),oo=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},re=function(r){un(e,r);function e(t,n,i,o){var s=r.call(this,t,n,o)||this;return s.container=i,s}return Object.defineProperty(e.prototype,"pointer",{get:function(){this.o===this.h&&G();var t=this;return new Proxy([],{get:function(n,i){if(i==="0")return t.o.u;if(i==="1")return t.o.p},set:function(n,i,o){if(i!=="1")throw new TypeError("props must be 1");return t.o.p=o,!0}})},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.o,this.h,this.container,this.iteratorType)},e}(on),so=function(r){un(e,r);function e(t){t===void 0&&(t=[]);var n=r.call(this)||this,i=n;return t.forEach(function(o){i.setElement(o[0],o[1])}),n}return e.prototype.begin=function(){return new re(this.H,this.h,this)},e.prototype.end=function(){return new re(this.h,this.h,this)},e.prototype.rBegin=function(){return new re(this.l,this.h,this,1)},e.prototype.rEnd=function(){return new re(this.h,this.h,this,1)},e.prototype.front=function(){if(this.M!==0)return[this.H.u,this.H.p]},e.prototype.back=function(){if(this.M!==0)return[this.l.u,this.l.p]},e.prototype.setElement=function(t,n,i){return this.v(t,n,i)},e.prototype.getElementByKey=function(t,n){if(n===void 0&&(n=de(t)),n){var i=t[this.HASH_TAG];return i!==void 0?this._[i].p:void 0}var o=this.I[t];return o?o.p:void 0},e.prototype.getElementByPos=function(t){if(t<0||t>this.M-1)throw new RangeError;for(var n=this.H;t--;)n=n.m;return[n.u,n.p]},e.prototype.find=function(t,n){var i=this.g(t,n);return new re(i,this.h,this)},e.prototype.forEach=function(t){for(var n=0,i=this.H;i!==this.h;)t([i.u,i.p],n++,this),i=i.m},e.prototype[Symbol.iterator]=function(){return(function(){var t;return oo(this,function(n){switch(n.label){case 0:t=this.H,n.label=1;case 1:return t===this.h?[3,3]:[4,[t.u,t.p]];case 2:return n.sent(),t=t.m,[3,1];case 3:return[2]}})}).bind(this)()},e}(sn);const ao=Object.freeze(Object.defineProperty({__proto__:null,Deque:zi,HashMap:so,HashSet:io,LinkList:Gi,OrderedMap:ro,OrderedSet:to,PriorityQueue:ji,Queue:Ri,Stack:Bi,Vector:Di},Symbol.toStringTag,{value:"Module"})),uo=Xe(ao),co=uo.OrderedSet,vt=At("number-allocator:trace"),lo=At("number-allocator:error");function rt(r,e){this.low=r,this.high=e}rt.prototype.equals=function(r){return this.low===r.low&&this.high===r.high};rt.prototype.compare=function(r){return this.low<r.low&&this.high<r.low?-1:r.low<this.low&&r.high<this.low?1:0};function _t(r,e){if(!(this instanceof _t))return new _t(r,e);this.min=r,this.max=e,this.ss=new co([],(t,n)=>t.compare(n)),vt("Create"),this.clear()}_t.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low};_t.prototype.alloc=function(){if(this.ss.size()===0)return vt("alloc():empty"),null;const r=this.ss.begin(),e=r.pointer.low,t=r.pointer.high,n=e;return n+1<=t?this.ss.updateKeyByIterator(r,new rt(e+1,t)):this.ss.eraseElementByPos(0),vt("alloc():"+n),n};_t.prototype.use=function(r){const e=new rt(r,r),t=this.ss.lowerBound(e);if(!t.equals(this.ss.end())){const n=t.pointer.low,i=t.pointer.high;return t.pointer.equals(e)?(this.ss.eraseElementByIterator(t),vt("use():"+r),!0):n>r?!1:n===r?(this.ss.updateKeyByIterator(t,new rt(n+1,i)),vt("use():"+r),!0):i===r?(this.ss.updateKeyByIterator(t,new rt(n,i-1)),vt("use():"+r),!0):(this.ss.updateKeyByIterator(t,new rt(r+1,i)),this.ss.insert(new rt(n,r-1)),vt("use():"+r),!0)}return vt("use():failed"),!1};_t.prototype.free=function(r){if(r<this.min||r>this.max){lo("free():"+r+" is out of range");return}const e=new rt(r,r),t=this.ss.upperBound(e);if(t.equals(this.ss.end())){if(t.equals(this.ss.begin())){this.ss.insert(e);return}t.pre();const n=t.pointer.high;t.pointer.high+1===r?this.ss.updateKeyByIterator(t,new rt(n,r)):this.ss.insert(e)}else if(t.equals(this.ss.begin()))if(r+1===t.pointer.low){const n=t.pointer.high;this.ss.updateKeyByIterator(t,new rt(r,n))}else this.ss.insert(e);else{const n=t.pointer.low,i=t.pointer.high;t.pre();const o=t.pointer.low;t.pointer.high+1===r?r+1===n?(this.ss.eraseElementByIterator(t),this.ss.updateKeyByIterator(t,new rt(o,i))):this.ss.updateKeyByIterator(t,new rt(o,r)):r+1===n?(this.ss.eraseElementByIterator(t.next()),this.ss.insert(new rt(r,i))):this.ss.insert(e)}vt("free():"+r)};_t.prototype.clear=function(){vt("clear()"),this.ss.clear(),this.ss.insert(new rt(this.min,this.max))};_t.prototype.intervalCount=function(){return this.ss.size()};_t.prototype.dump=function(){console.log("length:"+this.ss.size());for(const r of this.ss)console.log(r)};var fo=_t;const ho=fo;Fr.NumberAllocator=ho;const po=ki,yo=Fr.NumberAllocator;function Ot(r){if(!(this instanceof Ot))return new Ot(r);r>0&&(this.aliasToTopic=new po({max:r}),this.topicToAlias={},this.numberAllocator=new yo(1,r),this.max=r,this.length=0)}Ot.prototype.put=function(r,e){if(e===0||e>this.max)return!1;const t=this.aliasToTopic.get(e);return t&&delete this.topicToAlias[t],this.aliasToTopic.set(e,r),this.topicToAlias[r]=e,this.numberAllocator.use(e),this.length=this.aliasToTopic.length,!0};Ot.prototype.getTopicByAlias=function(r){return this.aliasToTopic.get(r)};Ot.prototype.getAliasByTopic=function(r){const e=this.topicToAlias[r];return typeof e<"u"&&this.aliasToTopic.get(e),e};Ot.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0};Ot.prototype.getLruAlias=function(){const r=this.numberAllocator.firstVacant();return r||this.aliasToTopic.keys()[this.aliasToTopic.length-1]};var go=Ot,Te={},Oe={exports:{}};const{Buffer:yt}=Pe,cn=Symbol.for("BufferList");function V(r){if(!(this instanceof V))return new V(r);V._init.call(this,r)}V._init=function(e){Object.defineProperty(this,cn,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};V.prototype._new=function(e){return new V(e)};V.prototype._offset=function(e){if(e===0)return[0,0];let t=0;for(let n=0;n<this._bufs.length;n++){const i=t+this._bufs[n].length;if(e<i||n===this._bufs.length-1)return[n,e-t];t=i}};V.prototype._reverseOffset=function(r){const e=r[0];let t=r[1];for(let n=0;n<e;n++)t+=this._bufs[n].length;return t};V.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]};V.prototype.slice=function(e,t){return typeof e=="number"&&e<0&&(e+=this.length),typeof t=="number"&&t<0&&(t+=this.length),this.copy(null,0,e,t)};V.prototype.copy=function(e,t,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||yt.alloc(0);const o=!!e,s=this._offset(n),u=i-n;let c=u,a=o&&t||0,f=s[1];if(n===0&&i===this.length){if(!o)return this._bufs.length===1?this._bufs[0]:yt.concat(this._bufs,this.length);for(let h=0;h<this._bufs.length;h++)this._bufs[h].copy(e,a),a+=this._bufs[h].length;return e}if(c<=this._bufs[s[0]].length-f)return o?this._bufs[s[0]].copy(e,t,f,f+c):this._bufs[s[0]].slice(f,f+c);o||(e=yt.allocUnsafe(u));for(let h=s[0];h<this._bufs.length;h++){const l=this._bufs[h].length-f;if(c>l)this._bufs[h].copy(e,a,f),a+=l;else{this._bufs[h].copy(e,a,f,f+c),a+=l;break}c-=l,f&&(f=0)}return e.length>a?e.slice(0,a):e};V.prototype.shallowSlice=function(e,t){if(e=e||0,t=typeof t!="number"?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const n=this._offset(e),i=this._offset(t),o=this._bufs.slice(n[0],i[0]+1);return i[1]===0?o.pop():o[o.length-1]=o[o.length-1].slice(0,i[1]),n[1]!==0&&(o[0]=o[0].slice(n[1])),this._new(o)};V.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)};V.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};V.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e};V.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(yt.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(yt.from(e));return this};V.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};V.prototype.indexOf=function(r,e,t){if(t===void 0&&typeof e=="string"&&(t=e,e=void 0),typeof r=="function"||Array.isArray(r))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof r=="number"?r=yt.from([r]):typeof r=="string"?r=yt.from(r,t):this._isBufferList(r)?r=r.slice():Array.isArray(r.buffer)?r=yt.from(r.buffer,r.byteOffset,r.byteLength):yt.isBuffer(r)||(r=yt.from(r)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),r.length===0)return e>this.length?this.length:e;const n=this._offset(e);let i=n[0],o=n[1];for(;i<this._bufs.length;i++){const s=this._bufs[i];for(;o<s.length;)if(s.length-o>=r.length){const c=s.indexOf(r,o);if(c!==-1)return this._reverseOffset([i,c]);o=s.length-r.length+1}else{const c=this._reverseOffset([i,o]);if(this._match(c,r))return c;o++}o=0}return-1};V.prototype._match=function(r,e){if(this.length-r<e.length)return!1;for(let t=0;t<e.length;t++)if(this.get(r+t)!==e[t])return!1;return!0};(function(){const r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const e in r)(function(t){r[t]===null?V.prototype[t]=function(n,i){return this.slice(n,n+i)[t](0,i)}:V.prototype[t]=function(n=0){return this.slice(n,n+r[t])[t](0)}})(e)})();V.prototype._isBufferList=function(e){return e instanceof V||V.isBufferList(e)};V.isBufferList=function(e){return e!=null&&e[cn]};var mo=V;const or=Ut.Duplex,vo=tr,ce=mo;function X(r){if(!(this instanceof X))return new X(r);if(typeof r=="function"){this._callback=r;const e=(function(n){this._callback&&(this._callback(n),this._callback=null)}).bind(this);this.on("pipe",function(n){n.on("error",e)}),this.on("unpipe",function(n){n.removeListener("error",e)}),r=null}ce._init.call(this,r),or.call(this)}vo(X,or);Object.assign(X.prototype,ce.prototype);X.prototype._new=function(e){return new X(e)};X.prototype._write=function(e,t,n){this._appendBuffer(e),typeof n=="function"&&n()};X.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)};X.prototype.end=function(e){or.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)};X.prototype._destroy=function(e,t){this._bufs.length=0,this.length=0,t(e)};X.prototype._isBufferList=function(e){return e instanceof X||e instanceof ce||X.isBufferList(e)};X.isBufferList=ce.isBufferList;Oe.exports=X;Oe.exports.BufferListStream=X;Oe.exports.BufferList=ce;var _o=Oe.exports;let bo=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};var wo=bo,ln={exports:{}};(function(r){const e=r.exports;e.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},e.codes={};for(const n in e.types){const i=e.types[n];e.codes[i]=n}e.CMD_SHIFT=4,e.CMD_MASK=240,e.DUP_MASK=8,e.QOS_MASK=3,e.QOS_SHIFT=1,e.RETAIN_MASK=1,e.VARBYTEINT_MASK=127,e.VARBYTEINT_FIN_MASK=128,e.VARBYTEINT_MAX=268435455,e.SESSIONPRESENT_MASK=1,e.SESSIONPRESENT_HEADER=_.from([e.SESSIONPRESENT_MASK]),e.CONNACK_HEADER=_.from([e.codes.connack<<e.CMD_SHIFT]),e.USERNAME_MASK=128,e.PASSWORD_MASK=64,e.WILL_RETAIN_MASK=32,e.WILL_QOS_MASK=24,e.WILL_QOS_SHIFT=3,e.WILL_FLAG_MASK=4,e.CLEAN_SESSION_MASK=2,e.CONNECT_HEADER=_.from([e.codes.connect<<e.CMD_SHIFT]),e.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},e.propertiesCodes={};for(const n in e.properties){const i=e.properties[n];e.propertiesCodes[i]=n}e.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function t(n){return[0,1,2].map(i=>[0,1].map(o=>[0,1].map(s=>{const u=_.alloc(1);return u.writeUInt8(e.codes[n]<<e.CMD_SHIFT|(o?e.DUP_MASK:0)|i<<e.QOS_SHIFT|s,0,!0),u})))}e.PUBLISH_HEADER=t("publish"),e.SUBSCRIBE_HEADER=t("subscribe"),e.SUBSCRIBE_OPTIONS_QOS_MASK=3,e.SUBSCRIBE_OPTIONS_NL_MASK=1,e.SUBSCRIBE_OPTIONS_NL_SHIFT=2,e.SUBSCRIBE_OPTIONS_RAP_MASK=1,e.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,e.SUBSCRIBE_OPTIONS_RH_MASK=3,e.SUBSCRIBE_OPTIONS_RH_SHIFT=4,e.SUBSCRIBE_OPTIONS_RH=[0,16,32],e.SUBSCRIBE_OPTIONS_NL=4,e.SUBSCRIBE_OPTIONS_RAP=8,e.SUBSCRIBE_OPTIONS_QOS=[0,1,2],e.UNSUBSCRIBE_HEADER=t("unsubscribe"),e.ACKS={unsuback:t("unsuback"),puback:t("puback"),pubcomp:t("pubcomp"),pubrel:t("pubrel"),pubrec:t("pubrec")},e.SUBACK_HEADER=_.from([e.codes.suback<<e.CMD_SHIFT]),e.VERSION3=_.from([3]),e.VERSION4=_.from([4]),e.VERSION5=_.from([5]),e.VERSION131=_.from([131]),e.VERSION132=_.from([132]),e.QOS=[0,1,2].map(n=>_.from([n])),e.EMPTY={pingreq:_.from([e.codes.pingreq<<4,0]),pingresp:_.from([e.codes.pingresp<<4,0]),disconnect:_.from([e.codes.disconnect<<4,0])}})(ln);var fn=ln.exports;const So=_o,Eo=er,Sr=wo,D=fn,k=At("mqtt-packet:parser");class me extends Eo{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof me?(this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new me().parser(e)}_resetState(){k("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new Sr,this.error=null,this._list=So(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),k("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,k("parse: state complete. _stateCounter is now: %d",this._stateCounter),k("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return k("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){const e=this._list.readUInt8(0);return this.packet.cmd=D.types[e>>D.CMD_SHIFT],this.packet.retain=(e&D.RETAIN_MASK)!==0,this.packet.qos=e>>D.QOS_SHIFT&D.QOS_MASK,this.packet.dup=(e&D.DUP_MASK)!==0,k("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){const e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),k("_parseLength %d",e.value),!!e}_parsePayload(){k("_parsePayload: payload %O",this._list);let e=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return k("_parsePayload complete result: %s",e),e}_parseConnect(){k("_parseConnect");let e,t,n,i;const o={},s=this.packet,u=this._parseString();if(u===null)return this._emitError(new Error("Cannot parse protocolId"));if(u!=="MQTT"&&u!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(s.protocolId=u,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.protocolVersion=this._list.readUInt8(this._pos),s.protocolVersion>=128&&(s.bridgeMode=!0,s.protocolVersion=s.protocolVersion-128),s.protocolVersion!==3&&s.protocolVersion!==4&&s.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.username=this._list.readUInt8(this._pos)&D.USERNAME_MASK,o.password=this._list.readUInt8(this._pos)&D.PASSWORD_MASK,o.will=this._list.readUInt8(this._pos)&D.WILL_FLAG_MASK,o.will&&(s.will={},s.will.retain=(this._list.readUInt8(this._pos)&D.WILL_RETAIN_MASK)!==0,s.will.qos=(this._list.readUInt8(this._pos)&D.WILL_QOS_MASK)>>D.WILL_QOS_SHIFT),s.clean=(this._list.readUInt8(this._pos)&D.CLEAN_SESSION_MASK)!==0,this._pos++,s.keepalive=this._parseNum(),s.keepalive===-1)return this._emitError(new Error("Packet too short"));if(s.protocolVersion===5){const a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(s.properties=a)}const c=this._parseString();if(c===null)return this._emitError(new Error("Packet too short"));if(s.clientId=c,k("_parseConnect: packet.clientId: %s",s.clientId),o.will){if(s.protocolVersion===5){const a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(s.will.properties=a)}if(e=this._parseString(),e===null)return this._emitError(new Error("Cannot parse will topic"));if(s.will.topic=e,k("_parseConnect: packet.will.topic: %s",s.will.topic),t=this._parseBuffer(),t===null)return this._emitError(new Error("Cannot parse will payload"));s.will.payload=t,k("_parseConnect: packet.will.paylaod: %s",s.will.payload)}if(o.username){if(i=this._parseString(),i===null)return this._emitError(new Error("Cannot parse username"));s.username=i,k("_parseConnect: packet.username: %s",s.username)}if(o.password){if(n=this._parseBuffer(),n===null)return this._emitError(new Error("Cannot parse password"));s.password=n}return this.settings=s,k("_parseConnect: complete"),s}_parseConnack(){k("_parseConnack");const e=this.packet;if(this._list.length<1)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&D.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(e.returnCode===-1||e.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}k("_parseConnack: complete")}_parsePublish(){k("_parsePublish");const e=this.packet;if(e.topic=this._parseString(),e.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length),k("_parsePublish: payload from buffer list: %o",e.payload)}}_parseSubscribe(){k("_parseSubscribe");const e=this.packet;let t,n,i,o,s,u,c;if(e.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(e.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const a=this._parseProperties();Object.getOwnPropertyNames(a).length&&(e.properties=a)}for(;this._pos<e.length;){if(t=this._parseString(),t===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=e.length)return this._emitError(new Error("Malformed Subscribe Payload"));n=this._parseByte(),i=n&D.SUBSCRIBE_OPTIONS_QOS_MASK,u=(n>>D.SUBSCRIBE_OPTIONS_NL_SHIFT&D.SUBSCRIBE_OPTIONS_NL_MASK)!==0,s=(n>>D.SUBSCRIBE_OPTIONS_RAP_SHIFT&D.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,o=n>>D.SUBSCRIBE_OPTIONS_RH_SHIFT&D.SUBSCRIBE_OPTIONS_RH_MASK,c={topic:t,qos:i},this.settings.protocolVersion===5?(c.nl=u,c.rap=s,c.rh=o):this.settings.bridgeMode&&(c.rh=0,c.rap=!0,c.nl=!0),k("_parseSubscribe: push subscription `%s` to subscription",c),e.subscriptions.push(c)}}}_parseSuback(){k("_parseSuback");const e=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){k("_parseUnsubscribe");const e=this.packet;if(e.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){const t=this._parseString();if(t===null)return this._emitError(new Error("Cannot parse topic"));k("_parseUnsubscribe: push topic `%s` to unsubscriptions",t),e.unsubscriptions.push(t)}}}_parseUnsuback(){k("_parseUnsuback");const e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){const t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){k("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);const e=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(e.length>2?(e.reasonCode=this._parseByte(),k("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)):e.reasonCode=0,e.length>3)){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0}_parseDisconnect(){const e=this.packet;if(k("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?e.reasonCode=this._parseByte():e.reasonCode=0;const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return k("_parseDisconnect result: true"),!0}_parseAuth(){k("_parseAuth");const e=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();const t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),k("_parseAuth: result: true"),!0}_parseMessageId(){const e=this.packet;return e.messageId=this._parseNum(),e.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(k("_parseMessageId: packet.messageId %d",e.messageId),!0)}_parseString(e){const t=this._parseNum(),n=t+this._pos;if(t===-1||n>this._list.length||n>this.packet.length)return null;const i=this._list.toString("utf8",this._pos,n);return this._pos+=t,k("_parseString: result: %s",i),i}_parseStringPair(){return k("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){const e=this._parseNum(),t=e+this._pos;if(e===-1||t>this._list.length||t>this.packet.length)return null;const n=this._list.slice(this._pos,t);return this._pos+=e,k("_parseBuffer: result: %o",n),n}_parseNum(){if(this._list.length-this._pos<2)return-1;const e=this._list.readUInt16BE(this._pos);return this._pos+=2,k("_parseNum: result: %s",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;const e=this._list.readUInt32BE(this._pos);return this._pos+=4,k("_parse4ByteNum: result: %s",e),e}_parseVarByteNum(e){k("_parseVarByteNum");const t=4;let n=0,i=1,o=0,s=!1,u;const c=this._pos?this._pos:0;for(;n<t&&c+n<this._list.length;){if(u=this._list.readUInt8(c+n++),o+=i*(u&D.VARBYTEINT_MASK),i*=128,!(u&D.VARBYTEINT_FIN_MASK)){s=!0;break}if(this._list.length<=n)break}return!s&&n===t&&this._list.length>=n&&this._emitError(new Error("Invalid variable byte integer")),c&&(this._pos+=n),s=s?e?{bytes:n,value:o}:o:!1,k("_parseVarByteNum: result: %o",s),s}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),k("_parseByte: result: %o",e),e}_parseByType(e){switch(k("_parseByType: type: %s",e),e){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){k("_parseProperties");const e=this._parseVarByteNum(),n=this._pos+e,i={};for(;this._pos<n;){const o=this._parseByte();if(!o)return this._emitError(new Error("Cannot parse property code type")),!1;const s=D.propertiesCodes[o];if(!s)return this._emitError(new Error("Unknown property")),!1;if(s==="userProperties"){i[s]||(i[s]=Object.create(null));const u=this._parseByType(D.propertiesTypes[s]);if(i[s][u.name])if(Array.isArray(i[s][u.name]))i[s][u.name].push(u.value);else{const c=i[s][u.name];i[s][u.name]=[c],i[s][u.name].push(u.value)}else i[s][u.name]=u.value;continue}i[s]?Array.isArray(i[s])?i[s].push(this._parseByType(D.propertiesTypes[s])):(i[s]=[i[s]],i[s].push(this._parseByType(D.propertiesTypes[s]))):i[s]=this._parseByType(D.propertiesTypes[s])}return i}_newPacket(){return k("_newPacket"),this.packet&&(this._list.consume(this.packet.length),k("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),k("_newPacket: new packet"),this.packet=new Sr,this._pos=0,!0}_emitError(e){k("_emitError"),this.error=e,this.emit("error",e)}}var Io=me;const Po=65536,hn={},Ao=_.isBuffer(_.from([1,2]).subarray(0,1));function pn(r){const e=_.allocUnsafe(2);return e.writeUInt8(r>>8,0),e.writeUInt8(r&255,1),e}function xo(){for(let r=0;r<Po;r++)hn[r]=pn(r)}function To(r){let t=0,n=0;const i=_.allocUnsafe(4);do t=r%128|0,r=r/128|0,r>0&&(t=t|128),i.writeUInt8(t,n++);while(r>0&&n<4);return r>0&&(n=0),Ao?i.subarray(0,n):i.slice(0,n)}function Oo(r){const e=_.allocUnsafe(4);return e.writeUInt32BE(r,0),e}var ko={cache:hn,generateCache:xo,generateNumber:pn,genBufVariableByteInt:To,generate4ByteBuffer:Oo};const M=fn,Mo=_.allocUnsafe(0),Co=_.from([0]),le=ko,Bo=ei().nextTick,ct=At("mqtt-packet:writeToStream"),ve=le.cache,No=le.generateNumber,Ro=le.generateCache,Ve=le.genBufVariableByteInt,Lo=le.generate4ByteBuffer;let nt=We,_e=!0;function dn(r,e,t){switch(ct("generate called"),e.cork&&(e.cork(),Bo(jo,e)),_e&&(_e=!1,Ro()),ct("generate: packet.cmd: %s",r.cmd),r.cmd){case"connect":return $o(r,e);case"connack":return Uo(r,e,t);case"publish":return qo(r,e,t);case"puback":case"pubrec":case"pubrel":case"pubcomp":return Ko(r,e,t);case"subscribe":return Do(r,e,t);case"suback":return Ho(r,e,t);case"unsubscribe":return Go(r,e,t);case"unsuback":return Vo(r,e,t);case"pingreq":case"pingresp":return Wo(r,e);case"disconnect":return Fo(r,e,t);case"auth":return zo(r,e,t);default:return e.emit("error",new Error("Unknown command")),!1}}Object.defineProperty(dn,"cacheNumbers",{get(){return nt===We},set(r){r?((!ve||Object.keys(ve).length===0)&&(_e=!0),nt=We):(_e=!1,nt=Qo)}});function jo(r){r.uncork()}function $o(r,e,t){const n=r||{},i=n.protocolId||"MQTT";let o=n.protocolVersion||4;const s=n.will;let u=n.clean;const c=n.keepalive||0,a=n.clientId||"",f=n.username,h=n.password,l=n.properties;u===void 0&&(u=!0);let p=0;if(!i||typeof i!="string"&&!_.isBuffer(i))return e.emit("error",new Error("Invalid protocolId")),!1;if(p+=i.length+2,o!==3&&o!==4&&o!==5)return e.emit("error",new Error("Invalid protocol version")),!1;if(p+=1,(typeof a=="string"||_.isBuffer(a))&&(a||o>=4)&&(a||u))p+=_.byteLength(a)+2;else{if(o<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(u*1===0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof c!="number"||c<0||c>65535||c%1!==0)return e.emit("error",new Error("Invalid keepalive")),!1;if(p+=2,p+=1,o===5){var g=kt(e,l);if(!g)return!1;p+=g.length}if(s){if(typeof s!="object")return e.emit("error",new Error("Invalid will")),!1;if(!s.topic||typeof s.topic!="string")return e.emit("error",new Error("Invalid will topic")),!1;if(p+=_.byteLength(s.topic)+2,p+=2,s.payload)if(s.payload.length>=0)typeof s.payload=="string"?p+=_.byteLength(s.payload):p+=s.payload.length;else return e.emit("error",new Error("Invalid will payload")),!1;var d={};if(o===5){if(d=kt(e,s.properties),!d)return!1;p+=d.length}}let v=!1;if(f!=null)if(xr(f))v=!0,p+=_.byteLength(f)+2;else return e.emit("error",new Error("Invalid username")),!1;if(h!=null){if(!v)return e.emit("error",new Error("Username is required to use password")),!1;if(xr(h))p+=yn(h)+2;else return e.emit("error",new Error("Invalid password")),!1}e.write(M.CONNECT_HEADER),lt(e,p),Dt(e,i),n.bridgeMode&&(o+=128),e.write(o===131?M.VERSION131:o===132?M.VERSION132:o===4?M.VERSION4:o===5?M.VERSION5:M.VERSION3);let A=0;return A|=f!=null?M.USERNAME_MASK:0,A|=h!=null?M.PASSWORD_MASK:0,A|=s&&s.retain?M.WILL_RETAIN_MASK:0,A|=s&&s.qos?s.qos<<M.WILL_QOS_SHIFT:0,A|=s?M.WILL_FLAG_MASK:0,A|=u?M.CLEAN_SESSION_MASK:0,e.write(_.from([A])),nt(e,c),o===5&&g.write(),Dt(e,a),s&&(o===5&&d.write(),$t(e,s.topic),Dt(e,s.payload)),f!=null&&Dt(e,f),h!=null&&Dt(e,h),!0}function Uo(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=n===5?i.reasonCode:i.returnCode,s=i.properties;let u=2;if(typeof o!="number")return e.emit("error",new Error("Invalid return code")),!1;let c=null;if(n===5){if(c=kt(e,s),!c)return!1;u+=c.length}return e.write(M.CONNACK_HEADER),lt(e,u),e.write(i.sessionPresent?M.SESSIONPRESENT_HEADER:Co),e.write(_.from([o])),c!=null&&c.write(),!0}function qo(r,e,t){ct("publish: packet: %o",r);const n=t?t.protocolVersion:4,i=r||{},o=i.qos||0,s=i.retain?M.RETAIN_MASK:0,u=i.topic,c=i.payload||Mo,a=i.messageId,f=i.properties;let h=0;if(typeof u=="string")h+=_.byteLength(u)+2;else if(_.isBuffer(u))h+=u.length+2;else return e.emit("error",new Error("Invalid topic")),!1;if(_.isBuffer(c)?h+=c.length:h+=_.byteLength(c),o&&typeof a!="number")return e.emit("error",new Error("Invalid messageId")),!1;o&&(h+=2);let l=null;if(n===5){if(l=kt(e,f),!l)return!1;h+=l.length}return e.write(M.PUBLISH_HEADER[o][i.dup?1:0][s?1:0]),lt(e,h),nt(e,yn(u)),e.write(u),o>0&&nt(e,a),l!=null&&l.write(),ct("publish: payload: %o",c),e.write(c)}function Ko(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.cmd||"puback",s=i.messageId,u=i.dup&&o==="pubrel"?M.DUP_MASK:0;let c=0;const a=i.reasonCode,f=i.properties;let h=n===5?3:2;if(o==="pubrel"&&(c=1),typeof s!="number")return e.emit("error",new Error("Invalid messageId")),!1;let l=null;if(n===5&&typeof f=="object"){if(l=fe(e,f,t,h),!l)return!1;h+=l.length}return e.write(M.ACKS[o][c][u][0]),lt(e,h),nt(e,s),n===5&&e.write(_.from([a])),l!==null&&l.write(),!0}function Do(r,e,t){ct("subscribe: packet: ");const n=t?t.protocolVersion:4,i=r||{},o=i.dup?M.DUP_MASK:0,s=i.messageId,u=i.subscriptions,c=i.properties;let a=0;if(typeof s!="number")return e.emit("error",new Error("Invalid messageId")),!1;a+=2;let f=null;if(n===5){if(f=kt(e,c),!f)return!1;a+=f.length}if(typeof u=="object"&&u.length)for(let l=0;l<u.length;l+=1){const p=u[l].topic,g=u[l].qos;if(typeof p!="string")return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof g!="number")return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(n===5){if(typeof(u[l].nl||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(u[l].rap||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;const A=u[l].rh||0;if(typeof A!="number"||A>2)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}a+=_.byteLength(p)+2+1}else return e.emit("error",new Error("Invalid subscriptions")),!1;ct("subscribe: writing to stream: %o",M.SUBSCRIBE_HEADER),e.write(M.SUBSCRIBE_HEADER[1][o?1:0][0]),lt(e,a),nt(e,s),f!==null&&f.write();let h=!0;for(const l of u){const p=l.topic,g=l.qos,d=+l.nl,v=+l.rap,A=l.rh;let m;$t(e,p),m=M.SUBSCRIBE_OPTIONS_QOS[g],n===5&&(m|=d?M.SUBSCRIBE_OPTIONS_NL:0,m|=v?M.SUBSCRIBE_OPTIONS_RAP:0,m|=A?M.SUBSCRIBE_OPTIONS_RH[A]:0),h=e.write(_.from([m]))}return h}function Ho(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.messageId,s=i.granted,u=i.properties;let c=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(c+=2,typeof s=="object"&&s.length)for(let f=0;f<s.length;f+=1){if(typeof s[f]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;c+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let a=null;if(n===5){if(a=fe(e,u,t,c),!a)return!1;c+=a.length}return e.write(M.SUBACK_HEADER),lt(e,c),nt(e,o),a!==null&&a.write(),e.write(_.from(s))}function Go(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.messageId,s=i.dup?M.DUP_MASK:0,u=i.unsubscriptions,c=i.properties;let a=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(a+=2,typeof u=="object"&&u.length)for(let l=0;l<u.length;l+=1){if(typeof u[l]!="string")return e.emit("error",new Error("Invalid unsubscriptions")),!1;a+=_.byteLength(u[l])+2}else return e.emit("error",new Error("Invalid unsubscriptions")),!1;let f=null;if(n===5){if(f=kt(e,c),!f)return!1;a+=f.length}e.write(M.UNSUBSCRIBE_HEADER[1][s?1:0][0]),lt(e,a),nt(e,o),f!==null&&f.write();let h=!0;for(let l=0;l<u.length;l++)h=$t(e,u[l]);return h}function Vo(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.messageId,s=i.dup?M.DUP_MASK:0,u=i.granted,c=i.properties,a=i.cmd,f=0;let h=2;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(n===5)if(typeof u=="object"&&u.length)for(let p=0;p<u.length;p+=1){if(typeof u[p]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;h+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let l=null;if(n===5){if(l=fe(e,c,t,h),!l)return!1;h+=l.length}return e.write(M.ACKS[a][f][s][0]),lt(e,h),nt(e,o),l!==null&&l.write(),n===5&&e.write(_.from(u)),!0}function Wo(r,e,t){return e.write(M.EMPTY[r.cmd])}function Fo(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.reasonCode,s=i.properties;let u=n===5?1:0,c=null;if(n===5){if(c=fe(e,s,t,u),!c)return!1;u+=c.length}return e.write(_.from([M.codes.disconnect<<4])),lt(e,u),n===5&&e.write(_.from([o])),c!==null&&c.write(),!0}function zo(r,e,t){const n=t?t.protocolVersion:4,i=r||{},o=i.reasonCode,s=i.properties;let u=n===5?1:0;n!==5&&e.emit("error",new Error("Invalid mqtt version for auth packet"));const c=fe(e,s,t,u);return c?(u+=c.length,e.write(_.from([M.codes.auth<<4])),lt(e,u),e.write(_.from([o])),c!==null&&c.write(),!0):!1}const Er={};function lt(r,e){if(e>M.VARBYTEINT_MAX)return r.emit("error",new Error(`Invalid variable byte integer: ${e}`)),!1;let t=Er[e];return t||(t=Ve(e),e<16384&&(Er[e]=t)),ct("writeVarByteInt: writing to stream: %o",t),r.write(t)}function $t(r,e){const t=_.byteLength(e);return nt(r,t),ct("writeString: %s",e),r.write(e,"utf8")}function Ir(r,e,t){$t(r,e),$t(r,t)}function We(r,e){return ct("writeNumberCached: number: %d",e),ct("writeNumberCached: %o",ve[e]),r.write(ve[e])}function Qo(r,e){const t=No(e);return ct("writeNumberGenerated: %o",t),r.write(t)}function Yo(r,e){const t=Lo(e);return ct("write4ByteNumber: %o",t),r.write(t)}function Dt(r,e){typeof e=="string"?$t(r,e):e?(nt(r,e.length),r.write(e)):nt(r,0)}function kt(r,e){if(typeof e!="object"||e.length!=null)return{length:1,write(){Ar(r,{},0)}};let t=0;function n(o,s){const u=M.propertiesTypes[o];let c=0;switch(u){case"byte":{if(typeof s!="boolean")return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=2;break}case"int8":{if(typeof s!="number"||s<0||s>255)return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=2;break}case"binary":{if(s&&s===null)return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=1+_.byteLength(s)+2;break}case"int16":{if(typeof s!="number"||s<0||s>65535)return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=3;break}case"int32":{if(typeof s!="number"||s<0||s>4294967295)return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=5;break}case"var":{if(typeof s!="number"||s<0||s>268435455)return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=1+_.byteLength(Ve(s));break}case"string":{if(typeof s!="string")return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=3+_.byteLength(s.toString());break}case"pair":{if(typeof s!="object")return r.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;c+=Object.getOwnPropertyNames(s).reduce((a,f)=>{const h=s[f];return Array.isArray(h)?a+=h.reduce((l,p)=>(l+=3+_.byteLength(f.toString())+2+_.byteLength(p.toString()),l),0):a+=3+_.byteLength(f.toString())+2+_.byteLength(s[f].toString()),a},0);break}default:return r.emit("error",new Error(`Invalid property ${o}: ${s}`)),!1}return c}if(e)for(const o in e){let s=0,u=0;const c=e[o];if(Array.isArray(c))for(let a=0;a<c.length;a++){if(u=n(o,c[a]),!u)return!1;s+=u}else{if(u=n(o,c),!u)return!1;s=u}if(!s)return!1;t+=s}return{length:_.byteLength(Ve(t))+t,write(){Ar(r,e,t)}}}function fe(r,e,t,n){const i=["reasonString","userProperties"],o=t&&t.properties&&t.properties.maximumPacketSize?t.properties.maximumPacketSize:0;let s=kt(r,e);if(o)for(;n+s.length>o;){const u=i.shift();if(u&&e[u])delete e[u],s=kt(r,e);else return!1}return s}function Pr(r,e,t){switch(M.propertiesTypes[e]){case"byte":{r.write(_.from([M.properties[e]])),r.write(_.from([+t]));break}case"int8":{r.write(_.from([M.properties[e]])),r.write(_.from([t]));break}case"binary":{r.write(_.from([M.properties[e]])),Dt(r,t);break}case"int16":{r.write(_.from([M.properties[e]])),nt(r,t);break}case"int32":{r.write(_.from([M.properties[e]])),Yo(r,t);break}case"var":{r.write(_.from([M.properties[e]])),lt(r,t);break}case"string":{r.write(_.from([M.properties[e]])),$t(r,t);break}case"pair":{Object.getOwnPropertyNames(t).forEach(i=>{const o=t[i];Array.isArray(o)?o.forEach(s=>{r.write(_.from([M.properties[e]])),Ir(r,i.toString(),s.toString())}):(r.write(_.from([M.properties[e]])),Ir(r,i.toString(),o.toString()))});break}default:return r.emit("error",new Error(`Invalid property ${e} value: ${t}`)),!1}}function Ar(r,e,t){lt(r,t);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==null){const i=e[n];if(Array.isArray(i))for(let o=0;o<i.length;o++)Pr(r,n,i[o]);else Pr(r,n,i)}}function yn(r){return r?r instanceof _?r.length:_.byteLength(r):0}function xr(r){return typeof r=="string"||r instanceof _}var gn=dn;const Jo=gn,Zo=er;function Xo(r,e){const t=new ts;return Jo(r,t,e),t.concat()}class ts extends Zo{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e=0;const t=new Array(this._array.length),n=this._array;let i=0,o;for(o=0;o<n.length&&n[o]!==void 0;o++)typeof n[o]!="string"?t[o]=n[o].length:t[o]=_.byteLength(n[o]),e+=t[o];const s=_.allocUnsafe(e);for(o=0;o<n.length&&n[o]!==void 0;o++)typeof n[o]!="string"?(n[o].copy(s,i),i+=t[o]):(s.write(n[o],i),i+=t[o]);return s}}var es=Xo;Te.parser=Io.parser;Te.generate=es;Te.writeToStream=gn;function Mt(){if(!(this instanceof Mt))return new Mt;this.nextId=Math.max(1,Math.floor(Math.random()*65535))}Mt.prototype.allocate=function(){const r=this.nextId++;return this.nextId===65536&&(this.nextId=1),r};Mt.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1};Mt.prototype.register=function(r){return!0};Mt.prototype.deallocate=function(r){};Mt.prototype.clear=function(){};var rs=Mt;function ns(r,e,t){var n=this;this._callback=r,this._args=t,this._interval=setInterval(r,e,this._args),this.reschedule=function(i){i||(i=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,i,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}function is(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new ns(arguments[0],arguments[1],r)}var os=is,ss=as;function Vt(r){return r instanceof _?_.from(r):new r.constructor(r.buffer.slice(),r.byteOffset,r.length)}function as(r){if(r=r||{},r.circles)return us(r);const e=new Map;if(e.set(Date,s=>new Date(s)),e.set(Map,(s,u)=>new Map(n(Array.from(s),u))),e.set(Set,(s,u)=>new Set(n(Array.from(s),u))),r.constructorHandlers)for(const s of r.constructorHandlers)e.set(s[0],s[1]);let t=null;return r.proto?o:i;function n(s,u){const c=Object.keys(s),a=new Array(c.length);for(let f=0;f<c.length;f++){const h=c[f],l=s[h];typeof l!="object"||l===null?a[h]=l:l.constructor!==Object&&(t=e.get(l.constructor))?a[h]=t(l,u):ArrayBuffer.isView(l)?a[h]=Vt(l):a[h]=u(l)}return a}function i(s){if(typeof s!="object"||s===null)return s;if(Array.isArray(s))return n(s,i);if(s.constructor!==Object&&(t=e.get(s.constructor)))return t(s,i);const u={};for(const c in s){if(Object.hasOwnProperty.call(s,c)===!1)continue;const a=s[c];typeof a!="object"||a===null?u[c]=a:a.constructor!==Object&&(t=e.get(a.constructor))?u[c]=t(a,i):ArrayBuffer.isView(a)?u[c]=Vt(a):u[c]=i(a)}return u}function o(s){if(typeof s!="object"||s===null)return s;if(Array.isArray(s))return n(s,o);if(s.constructor!==Object&&(t=e.get(s.constructor)))return t(s,o);const u={};for(const c in s){const a=s[c];typeof a!="object"||a===null?u[c]=a:a.constructor!==Object&&(t=e.get(a.constructor))?u[c]=t(a,o):ArrayBuffer.isView(a)?u[c]=Vt(a):u[c]=o(a)}return u}}function us(r){const e=[],t=[],n=new Map;if(n.set(Date,c=>new Date(c)),n.set(Map,(c,a)=>new Map(o(Array.from(c),a))),n.set(Set,(c,a)=>new Set(o(Array.from(c),a))),r.constructorHandlers)for(const c of r.constructorHandlers)n.set(c[0],c[1]);let i=null;return r.proto?u:s;function o(c,a){const f=Object.keys(c),h=new Array(f.length);for(let l=0;l<f.length;l++){const p=f[l],g=c[p];if(typeof g!="object"||g===null)h[p]=g;else if(g.constructor!==Object&&(i=n.get(g.constructor)))h[p]=i(g,a);else if(ArrayBuffer.isView(g))h[p]=Vt(g);else{const d=e.indexOf(g);d!==-1?h[p]=t[d]:h[p]=a(g)}}return h}function s(c){if(typeof c!="object"||c===null)return c;if(Array.isArray(c))return o(c,s);if(c.constructor!==Object&&(i=n.get(c.constructor)))return i(c,s);const a={};e.push(c),t.push(a);for(const f in c){if(Object.hasOwnProperty.call(c,f)===!1)continue;const h=c[f];if(typeof h!="object"||h===null)a[f]=h;else if(h.constructor!==Object&&(i=n.get(h.constructor)))a[f]=i(h,s);else if(ArrayBuffer.isView(h))a[f]=Vt(h);else{const l=e.indexOf(h);l!==-1?a[f]=t[l]:a[f]=s(h)}}return e.pop(),t.pop(),a}function u(c){if(typeof c!="object"||c===null)return c;if(Array.isArray(c))return o(c,u);if(c.constructor!==Object&&(i=n.get(c.constructor)))return i(c,u);const a={};e.push(c),t.push(a);for(const f in c){const h=c[f];if(typeof h!="object"||h===null)a[f]=h;else if(h.constructor!==Object&&(i=n.get(h.constructor)))a[f]=i(h,u);else if(ArrayBuffer.isView(h))a[f]=Vt(h);else{const l=e.indexOf(h);l!==-1?a[f]=t[l]:a[f]=u(h)}}return e.pop(),t.pop(),a}}var cs=ss();function ls(r){const e=r.split("/");for(let t=0;t<e.length;t++)if(e[t]!=="+"){if(e[t]==="#")return t===e.length-1;if(e[t].indexOf("+")!==-1||e[t].indexOf("#")!==-1)return!1}return!0}function fs(r){if(r.length===0)return"empty_topic_list";for(let e=0;e<r.length;e++)if(!ls(r[e]))return r[e];return null}var hs={validateTopics:fs};const mn=er.EventEmitter,be=Vr,ps=wi,ds=go,vn=Te,ys=rs,gs=Ut.Writable,ms=tr,vs=os,_n=cs,bn=hs,ke=rr,y=At("mqttjs:client"),sr=Pt?Pt.nextTick:function(r){setTimeout(r,0)},ar=Ht.setImmediate||function(r){sr(r)},Tr={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0},_s=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],we={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function bs(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}function ws(r,e){if(r.options.protocolVersion===5&&e.cmd==="publish"){let t;e.properties&&(t=e.properties.topicAlias);const n=e.topic.toString();if(r.topicAliasSend)if(t){if(n.length!==0&&(y("applyTopicAlias :: register topic: %s - alias: %d",n,t),!r.topicAliasSend.put(n,t)))return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",n,t),new Error("Sending Topic Alias out of range")}else n.length!==0&&(r.options.autoAssignTopicAlias?(t=r.topicAliasSend.getAliasByTopic(n),t?(e.topic="",e.properties={...e.properties,topicAlias:t},y("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",n,t)):(t=r.topicAliasSend.getLruAlias(),r.topicAliasSend.put(n,t),e.properties={...e.properties,topicAlias:t},y("applyTopicAlias :: auto assign topic: %s - alias: %d",n,t))):r.options.autoUseTopicAlias&&(t=r.topicAliasSend.getAliasByTopic(n),t&&(e.topic="",e.properties={...e.properties,topicAlias:t},y("applyTopicAlias :: auto use topic: %s - alias: %d",n,t))));else if(t)return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",n,t),new Error("Sending Topic Alias out of range")}}function wn(r,e){let t;e.properties&&(t=e.properties.topicAlias);let n=e.topic.toString();if(n.length===0){if(typeof t>"u")return new Error("Unregistered Topic Alias");if(n=r.topicAliasSend.getTopicByAlias(t),typeof n>"u")return new Error("Unregistered Topic Alias");e.topic=n}t&&delete e.properties.topicAlias}function Wt(r,e,t){y("sendPacket :: packet: %O",e),y("sendPacket :: emitting `packetsend`"),r.emit("packetsend",e),y("sendPacket :: writing to stream");const n=vn.writeToStream(e,r.stream,r.options);y("sendPacket :: writeToStream result %s",n),!n&&t&&t!==Y?(y("sendPacket :: handle events on `drain` once through callback."),r.stream.once("drain",t)):t&&(y("sendPacket :: invoking cb"),t())}function Ss(r){r&&(y("flush: queue exists? %b",!!r),Object.keys(r).forEach(function(e){typeof r[e].cb=="function"&&(r[e].cb(new Error("Connection closed")),delete r[e])}))}function Es(r){r&&(y("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(r).forEach(function(e){r[e].volatile&&typeof r[e].cb=="function"&&(r[e].cb(new Error("Connection closed")),delete r[e])}))}function Or(r,e,t,n){y("storeAndSend :: store packet with cmd %s to outgoingStore",e.cmd);let i=e,o;if(i.cmd==="publish"&&(i=_n(e),o=wn(r,i),o))return t&&t(o);r.outgoingStore.put(i,function(u){if(u)return t&&t(u);n(),Wt(r,e,t)})}function Y(r){y("nop ::",r)}function L(r,e){let t;const n=this;if(!(this instanceof L))return new L(r,e);this.options=e||{};for(t in Tr)typeof this.options[t]>"u"?this.options[t]=Tr[t]:this.options[t]=e[t];y("MqttClient :: options.protocol",e.protocol),y("MqttClient :: options.protocolVersion",e.protocolVersion),y("MqttClient :: options.username",e.username),y("MqttClient :: options.keepalive",e.keepalive),y("MqttClient :: options.reconnectPeriod",e.reconnectPeriod),y("MqttClient :: options.rejectUnauthorized",e.rejectUnauthorized),y("MqttClient :: options.topicAliasMaximum",e.topicAliasMaximum),this.options.clientId=typeof e.clientId=="string"?e.clientId:bs(),y("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=e.protocolVersion===5&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=r,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new ys:this.options.messageIdProvider,this.outgoingStore=e.outgoingStore||new be,this.incomingStore=e.incomingStore||new be,this.queueQoSZero=e.queueQoSZero===void 0?!0:e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,e.topicAliasMaximum>0&&(e.topicAliasMaximum>65535?y("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new ps(e.topicAliasMaximum)),this.on("connect",function(){const i=this.queue;function o(){const s=i.shift();y("deliver :: entry %o",s);let u=null;if(!s){n._resubscribe();return}u=s.packet,y("deliver :: call _sendPacket for %o",u);let c=!0;u.messageId&&u.messageId!==0&&(n.messageIdProvider.register(u.messageId)||(c=!1)),c?n._sendPacket(u,function(a){s.cb&&s.cb(a),o()}):(y("messageId: %d has already used. The message is skipped and removed.",u.messageId),o())}y("connect :: sending queued packets"),o()}),this.on("close",function(){y("close :: connected set to `false`"),this.connected=!1,y("close :: clearing connackTimer"),clearTimeout(this.connackTimer),y("close :: clearing ping timer"),n.pingTimer!==null&&(n.pingTimer.clear(),n.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),y("close :: calling _setupReconnect"),this._setupReconnect()}),mn.call(this),y("MqttClient :: setting up stream"),this._setupStream()}ms(L,mn);L.prototype._setupStream=function(){const r=this,e=new gs,t=vn.parser(this.options);let n=null;const i=[];y("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),y("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),t.on("packet",function(a){y("parser :: on packet push to packets array."),i.push(a)});function o(){if(i.length)sr(s);else{const a=n;n=null,a()}}function s(){y("work :: getting next packet in queue");const a=i.shift();if(a)y("work :: packet pulled from queue"),r._handlePacket(a,o);else{y("work :: no packets in queue");const f=n;n=null,y("work :: done flag is %s",!!f),f&&f()}}e._write=function(a,f,h){n=h,y("writable stream :: parsing buffer"),t.parse(a),s()};function u(a){y("streamErrorHandler :: error",a.message),_s.includes(a.code)?(y("streamErrorHandler :: emitting error"),r.emit("error",a)):Y(a)}y("_setupStream :: pipe stream to writable stream"),this.stream.pipe(e),this.stream.on("error",u),this.stream.on("close",function(){y("(%s)stream :: on close",r.options.clientId),Es(r.outgoing),y("stream: emit close to MqttClient"),r.emit("close")}),y("_setupStream: sending packet `connect`");const c=Object.create(this.options);if(c.cmd="connect",this.topicAliasRecv&&(c.properties||(c.properties={}),this.topicAliasRecv&&(c.properties.topicAliasMaximum=this.topicAliasRecv.max)),Wt(this,c),t.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return r.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){const a=ke({cmd:"auth",reasonCode:0},this.options.authPacket);Wt(this,a)}}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){y("!!connectTimeout hit!! Calling _cleanUp with force `true`"),r._cleanUp(!0)},this.options.connectTimeout)};L.prototype._handlePacket=function(r,e){const t=this.options;if(t.protocolVersion===5&&t.properties&&t.properties.maximumPacketSize&&t.properties.maximumPacketSize<r.length)return this.emit("error",new Error("exceeding packets size "+r.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(y("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",r),r.cmd){case"publish":this._handlePublish(r,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(r),e();break;case"pubrel":this._handlePubrel(r,e);break;case"connack":this._handleConnack(r),e();break;case"auth":this._handleAuth(r),e();break;case"pingresp":this._handlePingresp(r),e();break;case"disconnect":this._handleDisconnect(r),e();break}};L.prototype._checkDisconnecting=function(r){return this.disconnecting&&(r&&r!==Y?r(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting};L.prototype.publish=function(r,e,t,n){y("publish :: message `%s` to topic `%s`",e,r);const i=this.options;if(typeof t=="function"&&(n=t,t=null),t=ke({qos:0,retain:!1,dup:!1},t),this._checkDisconnecting(n))return this;const s=this,u=function(){let c=0;if((t.qos===1||t.qos===2)&&(c=s._nextId(),c===null))return y("No messageId left"),!1;const a={cmd:"publish",topic:r,payload:e,qos:t.qos,retain:t.retain,messageId:c,dup:t.dup};switch(i.protocolVersion===5&&(a.properties=t.properties),y("publish :: qos",t.qos),t.qos){case 1:case 2:s.outgoing[a.messageId]={volatile:!1,cb:n||Y},y("MqttClient:publish: packet cmd: %s",a.cmd),s._sendPacket(a,void 0,t.cbStorePut);break;default:y("MqttClient:publish: packet cmd: %s",a.cmd),s._sendPacket(a,n,t.cbStorePut);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!u())&&this._storeProcessingQueue.push({invoke:u,cbStorePut:t.cbStorePut,callback:n}),this};L.prototype.subscribe=function(){const r=this,e=new Array(arguments.length);for(let h=0;h<arguments.length;h++)e[h]=arguments[h];const t=[];let n=e.shift();const i=n.resubscribe;let o=e.pop()||Y,s=e.pop();const u=this.options.protocolVersion;delete n.resubscribe,typeof n=="string"&&(n=[n]),typeof o!="function"&&(s=o,o=Y);const c=bn.validateTopics(n);if(c!==null)return ar(o,new Error("Invalid topic "+c)),this;if(this._checkDisconnecting(o))return y("subscribe: discconecting true"),this;const a={qos:0};if(u===5&&(a.nl=!1,a.rap=!1,a.rh=0),s=ke(a,s),Array.isArray(n)?n.forEach(function(h){if(y("subscribe: array topic %s",h),!Object.prototype.hasOwnProperty.call(r._resubscribeTopics,h)||r._resubscribeTopics[h].qos<s.qos||i){const l={topic:h,qos:s.qos};u===5&&(l.nl=s.nl,l.rap=s.rap,l.rh=s.rh,l.properties=s.properties),y("subscribe: pushing topic `%s` and qos `%s` to subs list",l.topic,l.qos),t.push(l)}}):Object.keys(n).forEach(function(h){if(y("subscribe: object topic %s",h),!Object.prototype.hasOwnProperty.call(r._resubscribeTopics,h)||r._resubscribeTopics[h].qos<n[h].qos||i){const l={topic:h,qos:n[h].qos};u===5&&(l.nl=n[h].nl,l.rap=n[h].rap,l.rh=n[h].rh,l.properties=s.properties),y("subscribe: pushing `%s` to subs list",l),t.push(l)}}),!t.length)return o(null,[]),this;const f=function(){const h=r._nextId();if(h===null)return y("No messageId left"),!1;const l={cmd:"subscribe",subscriptions:t,qos:1,retain:!1,dup:!1,messageId:h};if(s.properties&&(l.properties=s.properties),r.options.resubscribe){y("subscribe :: resubscribe true");const p=[];t.forEach(function(g){if(r.options.reconnectPeriod>0){const d={qos:g.qos};u===5&&(d.nl=g.nl||!1,d.rap=g.rap||!1,d.rh=g.rh||0,d.properties=g.properties),r._resubscribeTopics[g.topic]=d,p.push(g.topic)}}),r.messageIdToTopic[l.messageId]=p}return r.outgoing[l.messageId]={volatile:!0,cb:function(p,g){if(!p){const d=g.granted;for(let v=0;v<d.length;v+=1)t[v].qos=d[v]}o(p,t)}},y("subscribe :: call _sendPacket"),r._sendPacket(l),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!f())&&this._storeProcessingQueue.push({invoke:f,callback:o}),this};L.prototype.unsubscribe=function(){const r=this,e=new Array(arguments.length);for(let u=0;u<arguments.length;u++)e[u]=arguments[u];let t=e.shift(),n=e.pop()||Y,i=e.pop();typeof t=="string"&&(t=[t]),typeof n!="function"&&(i=n,n=Y);const o=bn.validateTopics(t);if(o!==null)return ar(n,new Error("Invalid topic "+o)),this;if(r._checkDisconnecting(n))return this;const s=function(){const u=r._nextId();if(u===null)return y("No messageId left"),!1;const c={cmd:"unsubscribe",qos:1,messageId:u};return typeof t=="string"?c.unsubscriptions=[t]:Array.isArray(t)&&(c.unsubscriptions=t),r.options.resubscribe&&c.unsubscriptions.forEach(function(a){delete r._resubscribeTopics[a]}),typeof i=="object"&&i.properties&&(c.properties=i.properties),r.outgoing[c.messageId]={volatile:!0,cb:n},y("unsubscribe: call _sendPacket"),r._sendPacket(c),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!s())&&this._storeProcessingQueue.push({invoke:s,callback:n}),this};L.prototype.end=function(r,e,t){const n=this;y("end :: (%s)",this.options.clientId),(r==null||typeof r!="boolean")&&(t=e||Y,e=r,r=!1,typeof e!="object"&&(t=e,e=null,typeof t!="function"&&(t=Y))),typeof e!="object"&&(t=e,e=null),y("end :: cb? %s",!!t),t=t||Y;function i(){y("end :: closeStores: closing incoming and outgoing stores"),n.disconnected=!0,n.incomingStore.close(function(s){n.outgoingStore.close(function(u){if(y("end :: closeStores: emitting end"),n.emit("end"),t){const c=s||u;y("end :: closeStores: invoking callback with args"),t(c)}})}),n._deferredReconnect&&n._deferredReconnect()}function o(){y("end :: (%s) :: finish :: calling _cleanUp with force %s",n.options.clientId,r),n._cleanUp(r,()=>{y("end :: finish :: calling process.nextTick on closeStores"),sr(i.bind(n))},e)}return this.disconnecting?(t(),this):(this._clearReconnect(),this.disconnecting=!0,!r&&Object.keys(this.outgoing).length>0?(y("end :: (%s) :: calling finish in 10ms once outgoing is empty",n.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,o,10))):(y("end :: (%s) :: immediately calling finish",n.options.clientId),o()),this)};L.prototype.removeOutgoingMessage=function(r){const e=this.outgoing[r]?this.outgoing[r].cb:null;return delete this.outgoing[r],this.outgoingStore.del({messageId:r},function(){e(new Error("Message removed"))}),this};L.prototype.reconnect=function(r){y("client reconnect");const e=this,t=function(){r?(e.options.incomingStore=r.incomingStore,e.options.outgoingStore=r.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new be,e.outgoingStore=e.options.outgoingStore||new be,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=t:t(),this};L.prototype._reconnect=function(){y("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),y("client already connected. disconnecting first.")):(y("_reconnect: calling _setupStream"),this._setupStream())};L.prototype._setupReconnect=function(){const r=this;!r.disconnecting&&!r.reconnectTimer&&r.options.reconnectPeriod>0?(this.reconnecting||(y("_setupReconnect :: emit `offline` state"),this.emit("offline"),y("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),y("_setupReconnect :: setting reconnectTimer for %d ms",r.options.reconnectPeriod),r.reconnectTimer=setInterval(function(){y("reconnectTimer :: reconnect triggered!"),r._reconnect()},r.options.reconnectPeriod)):y("_setupReconnect :: doing nothing...")};L.prototype._clearReconnect=function(){y("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)};L.prototype._cleanUp=function(r,e){const t=arguments[2];if(e&&(y("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",e)),y("_cleanUp :: forced? %s",r),r)this.options.reconnectPeriod===0&&this.options.clean&&Ss(this.outgoing),y("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{const n=ke({cmd:"disconnect"},t);y("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(n,ar.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(y("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(y("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(y("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",e),e())};L.prototype._sendPacket=function(r,e,t){y("_sendPacket :: (%s) ::  start",this.options.clientId),t=t||Y,e=e||Y;const n=ws(this,r);if(n){e(n);return}if(!this.connected){if(r.cmd==="auth"){this._shiftPingInterval(),Wt(this,r,e);return}y("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(r,e,t);return}switch(this._shiftPingInterval(),r.cmd){case"publish":break;case"pubrel":Or(this,r,e,t);return;default:Wt(this,r,e);return}switch(r.qos){case 2:case 1:Or(this,r,e,t);break;case 0:default:Wt(this,r,e);break}y("_sendPacket :: (%s) ::  end",this.options.clientId)};L.prototype._storePacket=function(r,e,t){y("_storePacket :: packet: %o",r),y("_storePacket :: cb? %s",!!e),t=t||Y;let n=r;if(n.cmd==="publish"){n=_n(r);const i=wn(this,n);if(i)return e&&e(i)}(n.qos||0)===0&&this.queueQoSZero||n.cmd!=="publish"?this.queue.push({packet:n,cb:e}):n.qos>0?(e=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,function(i){if(i)return e&&e(i);t()})):e&&e(new Error("No connection to broker"))};L.prototype._setupPingTimer=function(){y("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);const r=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=vs(function(){r._checkPing()},this.options.keepalive*1e3))};L.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(this.options.keepalive*1e3)};L.prototype._checkPing=function(){y("_checkPing :: checking ping..."),this.pingResp?(y("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(y("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))};L.prototype._handlePingresp=function(){this.pingResp=!0};L.prototype._handleConnack=function(r){y("_handleConnack");const e=this.options,n=e.protocolVersion===5?r.reasonCode:r.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,r.properties){if(r.properties.topicAliasMaximum){if(r.properties.topicAliasMaximum>65535){this.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}r.properties.topicAliasMaximum>0&&(this.topicAliasSend=new ds(r.properties.topicAliasMaximum))}r.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=r.properties.serverKeepAlive,this._shiftPingInterval()),r.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=r.properties.maximumPacketSize)}if(n===0)this.reconnecting=!1,this._onConnect(r);else if(n>0){const i=new Error("Connection refused: "+we[n]);i.code=n,this.emit("error",i)}};L.prototype._handleAuth=function(r){const t=this.options.protocolVersion,n=t===5?r.reasonCode:r.returnCode;if(t!==5){const o=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+t);o.code=n,this.emit("error",o);return}const i=this;this.handleAuth(r,function(o,s){if(o){i.emit("error",o);return}if(n===24)i.reconnecting=!1,i._sendPacket(s);else{const u=new Error("Connection refused: "+we[n]);o.code=n,i.emit("error",u)}})};L.prototype.handleAuth=function(r,e){e()};L.prototype._handlePublish=function(r,e){y("_handlePublish: packet %o",r),e=typeof e<"u"?e:Y;let t=r.topic.toString();const n=r.payload,i=r.qos,o=r.messageId,s=this,u=this.options,c=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){let a;if(r.properties&&(a=r.properties.topicAlias),typeof a<"u")if(t.length===0)if(a>0&&a<=65535){const f=this.topicAliasRecv.getTopicByAlias(a);if(f)t=f,y("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",t,a);else{y("_handlePublish :: unregistered topic alias. alias: %d",a),this.emit("error",new Error("Received unregistered Topic Alias"));return}}else{y("_handlePublish :: topic alias out of range. alias: %d",a),this.emit("error",new Error("Received Topic Alias is out of range"));return}else if(this.topicAliasRecv.put(t,a))y("_handlePublish :: registered topic: %s - alias: %d",t,a);else{y("_handlePublish :: topic alias out of range. alias: %d",a),this.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(y("_handlePublish: qos %d",i),i){case 2:{u.customHandleAcks(t,n,r,function(a,f){if(a instanceof Error||(f=a,a=null),a)return s.emit("error",a);if(c.indexOf(f)===-1)return s.emit("error",new Error("Wrong reason code for pubrec"));f?s._sendPacket({cmd:"pubrec",messageId:o,reasonCode:f},e):s.incomingStore.put(r,function(){s._sendPacket({cmd:"pubrec",messageId:o},e)})});break}case 1:{u.customHandleAcks(t,n,r,function(a,f){if(a instanceof Error||(f=a,a=null),a)return s.emit("error",a);if(c.indexOf(f)===-1)return s.emit("error",new Error("Wrong reason code for puback"));f||s.emit("message",t,n,r),s.handleMessage(r,function(h){if(h)return e&&e(h);s._sendPacket({cmd:"puback",messageId:o,reasonCode:f},e)})});break}case 0:this.emit("message",t,n,r),this.handleMessage(r,e);break;default:y("_handlePublish: unknown QoS. Doing nothing.");break}};L.prototype.handleMessage=function(r,e){e()};L.prototype._handleAck=function(r){const e=r.messageId,t=r.cmd;let n=null;const i=this.outgoing[e]?this.outgoing[e].cb:null,o=this;let s;if(!i){y("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(y("_handleAck :: packet type",t),t){case"pubcomp":case"puback":{const u=r.reasonCode;u&&u>0&&u!==16&&(s=new Error("Publish error: "+we[u]),s.code=u,i(s,r)),delete this.outgoing[e],this.outgoingStore.del(r,i),this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue();break}case"pubrec":{n={cmd:"pubrel",qos:2,messageId:e};const u=r.reasonCode;u&&u>0&&u!==16?(s=new Error("Publish error: "+we[u]),s.code=u,i(s,r)):this._sendPacket(n);break}case"suback":{delete this.outgoing[e],this.messageIdProvider.deallocate(e);for(let u=0;u<r.granted.length;u++)if(r.granted[u]&128){const c=this.messageIdToTopic[e];c&&c.forEach(function(a){delete o._resubscribeTopics[a]})}this._invokeStoreProcessingQueue(),i(null,r);break}case"unsuback":{delete this.outgoing[e],this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue(),i(null);break}default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")};L.prototype._handlePubrel=function(r,e){y("handling pubrel packet"),e=typeof e<"u"?e:Y;const t=r.messageId,n=this,i={cmd:"pubcomp",messageId:t};n.incomingStore.get(r,function(o,s){o?n._sendPacket(i,e):(n.emit("message",s.topic,s.payload,s),n.handleMessage(s,function(u){if(u)return e(u);n.incomingStore.del(s,Y),n._sendPacket(i,e)}))})};L.prototype._handleDisconnect=function(r){this.emit("disconnect",r)};L.prototype._nextId=function(){return this.messageIdProvider.allocate()};L.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()};L.prototype._resubscribe=function(){y("_resubscribe");const r=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&r.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){y("_resubscribe: protocolVersion 5");for(let e=0;e<r.length;e++){const t={};t[r[e]]=this._resubscribeTopics[r[e]],t.resubscribe=!0,this.subscribe(t,{properties:t[r[e]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1};L.prototype._onConnect=function(r){if(this.disconnected){this.emit("connect",r);return}const e=this;this.connackPacket=r,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0;function t(){let n=e.outgoingStore.createStream();function i(){e._storeProcessing=!1,e._packetIdsDuringStoreProcessing={}}e.once("close",o),n.on("error",function(u){i(),e._flushStoreProcessingQueue(),e.removeListener("close",o),e.emit("error",u)});function o(){n.destroy(),n=null,e._flushStoreProcessingQueue(),i()}function s(){if(!n)return;e._storeProcessing=!0;const u=n.read(1);let c;if(!u){n.once("readable",s);return}if(e._packetIdsDuringStoreProcessing[u.messageId]){s();return}!e.disconnecting&&!e.reconnectTimer?(c=e.outgoing[u.messageId]?e.outgoing[u.messageId].cb:null,e.outgoing[u.messageId]={volatile:!1,cb:function(a,f){c&&c(a,f),s()}},e._packetIdsDuringStoreProcessing[u.messageId]=!0,e.messageIdProvider.register(u.messageId)?e._sendPacket(u):y("messageId: %d has already used.",u.messageId)):n.destroy&&n.destroy()}n.on("end",function(){let u=!0;for(const c in e._packetIdsDuringStoreProcessing)if(!e._packetIdsDuringStoreProcessing[c]){u=!1;break}u?(i(),e.removeListener("close",o),e._invokeAllStoreProcessingQueue(),e.emit("connect",r)):t()}),s()}t()};L.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){const r=this._storeProcessingQueue[0];if(r&&r.invoke())return this._storeProcessingQueue.shift(),!0}return!1};L.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););};L.prototype._flushStoreProcessingQueue=function(){for(const r of this._storeProcessingQueue)r.cbStorePut&&r.cbStorePut(new Error("Connection closed")),r.callback&&r.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)};var Is=L,Se={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Se.exports;(function(r,e){(function(t){var n=e&&!e.nodeType&&e,i=r&&!r.nodeType&&r,o=typeof Ht=="object"&&Ht;(o.global===o||o.window===o||o.self===o)&&(t=o);var s,u=2147483647,c=36,a=1,f=26,h=38,l=700,p=72,g=128,d="-",v=/^xn--/,A=/[^\x20-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=c-a,I=Math.floor,H=String.fromCharCode,W;function x(P){throw new RangeError(b[P])}function U(P,E){for(var T=P.length,K=[];T--;)K[T]=E(P[T]);return K}function S(P,E){var T=P.split("@"),K="";T.length>1&&(K=T[0]+"@",P=T[1]),P=P.replace(m,".");var F=P.split("."),et=U(F,E).join(".");return K+et}function w(P){for(var E=[],T=0,K=P.length,F,et;T<K;)F=P.charCodeAt(T++),F>=55296&&F<=56319&&T<K?(et=P.charCodeAt(T++),(et&64512)==56320?E.push(((F&1023)<<10)+(et&1023)+65536):(E.push(F),T--)):E.push(F);return E}function N(P){return U(P,function(E){var T="";return E>65535&&(E-=65536,T+=H(E>>>10&1023|55296),E=56320|E&1023),T+=H(E),T}).join("")}function B(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:c}function R(P,E){return P+22+75*(P<26)-((E!=0)<<5)}function j(P,E,T){var K=0;for(P=T?I(P/l):P>>1,P+=I(P/E);P>C*f>>1;K+=c)P=I(P/C);return I(K+(C+1)*P/(P+h))}function O(P){var E=[],T=P.length,K,F=0,et=g,Q=p,st,ft,gt,bt,Z,at,ht,xt,Nt;for(st=P.lastIndexOf(d),st<0&&(st=0),ft=0;ft<st;++ft)P.charCodeAt(ft)>=128&&x("not-basic"),E.push(P.charCodeAt(ft));for(gt=st>0?st+1:0;gt<T;){for(bt=F,Z=1,at=c;gt>=T&&x("invalid-input"),ht=B(P.charCodeAt(gt++)),(ht>=c||ht>I((u-F)/Z))&&x("overflow"),F+=ht*Z,xt=at<=Q?a:at>=Q+f?f:at-Q,!(ht<xt);at+=c)Nt=c-xt,Z>I(u/Nt)&&x("overflow"),Z*=Nt;K=E.length+1,Q=j(F-bt,K,bt==0),I(F/K)>u-et&&x("overflow"),et+=I(F/K),F%=K,E.splice(F++,0,et)}return N(E)}function ot(P){var E,T,K,F,et,Q,st,ft,gt,bt,Z,at=[],ht,xt,Nt,Ce;for(P=w(P),ht=P.length,E=g,T=0,et=p,Q=0;Q<ht;++Q)Z=P[Q],Z<128&&at.push(H(Z));for(K=F=at.length,F&&at.push(d);K<ht;){for(st=u,Q=0;Q<ht;++Q)Z=P[Q],Z>=E&&Z<st&&(st=Z);for(xt=K+1,st-E>I((u-T)/xt)&&x("overflow"),T+=(st-E)*xt,E=st,Q=0;Q<ht;++Q)if(Z=P[Q],Z<E&&++T>u&&x("overflow"),Z==E){for(ft=T,gt=c;bt=gt<=et?a:gt>=et+f?f:gt-et,!(ft<bt);gt+=c)Ce=ft-bt,Nt=c-bt,at.push(H(R(bt+Ce%Nt,0))),ft=I(Ce/Nt);at.push(H(R(ft,0))),et=j(T,xt,K==F),T=0,++K}++T,++E}return at.join("")}function tt(P){return S(P,function(E){return v.test(E)?O(E.slice(4).toLowerCase()):E})}function Qt(P){return S(P,function(E){return A.test(E)?"xn--"+ot(E):E})}if(s={version:"1.4.1",ucs2:{decode:w,encode:N},decode:O,encode:ot,toASCII:Qt,toUnicode:tt},n&&i)if(r.exports==n)i.exports=s;else for(W in s)s.hasOwnProperty(W)&&(n[W]=s[W]);else t.punycode=s})(Ht)})(Se,Se.exports);var Ps=Se.exports;const As=Ie(Ps);function xs(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Ts=function(r,e,t,n){e=e||"&",t=t||"=";var i={};if(typeof r!="string"||r.length===0)return i;var o=/\+/g;r=r.split(e);var s=1e3;n&&typeof n.maxKeys=="number"&&(s=n.maxKeys);var u=r.length;s>0&&u>s&&(u=s);for(var c=0;c<u;++c){var a=r[c].replace(o,"%20"),f=a.indexOf(t),h,l,p,g;f>=0?(h=a.substr(0,f),l=a.substr(f+1)):(h=a,l=""),p=decodeURIComponent(h),g=decodeURIComponent(l),xs(i,p)?Os(i[p])?i[p].push(g):i[p]=[i[p],g]:i[p]=g}return i},Os=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"},ne=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}},ks=function(r,e,t,n){return e=e||"&",t=t||"=",r===null&&(r=void 0),typeof r=="object"?kr(Cs(r),function(i){var o=encodeURIComponent(ne(i))+t;return Ms(r[i])?kr(r[i],function(s){return o+encodeURIComponent(ne(s))}).join(e):o+encodeURIComponent(ne(r[i]))}).join(e):n?encodeURIComponent(ne(n))+t+encodeURIComponent(ne(r)):""},Ms=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function kr(r,e){if(r.map)return r.map(e);for(var t=[],n=0;n<r.length;n++)t.push(e(r[n],n));return t}var Cs=Object.keys||function(r){var e=[];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.push(t);return e},Sn,En,Bs=En=Ts,Ns=Sn=ks;function Rs(r){return encodeURIComponent(r)}function Ls(r){return decodeURIComponent(r)}var js={decode:Bs,encode:Ns,parse:En,stringify:Sn,escape:Rs,unescape:Ls},$s={isString:function(r){return typeof r=="string"},isObject:function(r){return typeof r=="object"&&r!==null},isNull:function(r){return r===null},isNullOrUndefined:function(r){return r==null}},Us=As,mt=$s,qs=he,Ks=Xs,In=ta,Ds=Zs,Hs=ut;function ut(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Gs=/^([a-z0-9.+-]+:)/i,Vs=/:[0-9]*$/,Ws=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Fs=["<",">",'"',"`"," ","\r",`
`,"	"],zs=["{","}","|","\\","^","`"].concat(Fs),Fe=["'"].concat(zs),Mr=["%","/","?",";","#"].concat(Fe),Cr=["/","?","#"],Qs=255,Br=/^[+a-z0-9A-Z_-]{0,63}$/,Ys=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Js={javascript:!0,"javascript:":!0},ze={javascript:!0,"javascript:":!0},Ft={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Qe=js;function he(r,e,t){if(r&&mt.isObject(r)&&r instanceof ut)return r;var n=new ut;return n.parse(r,e,t),n}ut.prototype.parse=function(r,e,t){if(!mt.isString(r))throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var n=r.indexOf("?"),i=n!==-1&&n<r.indexOf("#")?"?":"#",o=r.split(i),s=/\\/g;o[0]=o[0].replace(s,"/"),r=o.join(i);var u=r;if(u=u.trim(),!t&&r.split("#").length===1){var c=Ws.exec(u);if(c)return this.path=u,this.href=u,this.pathname=c[1],c[2]?(this.search=c[2],e?this.query=Qe.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var a=Gs.exec(u);if(a){a=a[0];var f=a.toLowerCase();this.protocol=f,u=u.substr(a.length)}if(t||a||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var h=u.substr(0,2)==="//";h&&!(a&&ze[a])&&(u=u.substr(2),this.slashes=!0)}if(!ze[a]&&(h||a&&!Ft[a])){for(var l=-1,p=0;p<Cr.length;p++){var g=u.indexOf(Cr[p]);g!==-1&&(l===-1||g<l)&&(l=g)}var d,v;l===-1?v=u.lastIndexOf("@"):v=u.lastIndexOf("@",l),v!==-1&&(d=u.slice(0,v),u=u.slice(v+1),this.auth=decodeURIComponent(d)),l=-1;for(var p=0;p<Mr.length;p++){var g=u.indexOf(Mr[p]);g!==-1&&(l===-1||g<l)&&(l=g)}l===-1&&(l=u.length),this.host=u.slice(0,l),u=u.slice(l),this.parseHost(),this.hostname=this.hostname||"";var A=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!A)for(var m=this.hostname.split(/\./),p=0,b=m.length;p<b;p++){var C=m[p];if(C&&!C.match(Br)){for(var I="",H=0,W=C.length;H<W;H++)C.charCodeAt(H)>127?I+="x":I+=C[H];if(!I.match(Br)){var x=m.slice(0,p),U=m.slice(p+1),S=C.match(Ys);S&&(x.push(S[1]),U.unshift(S[2])),U.length&&(u="/"+U.join(".")+u),this.hostname=x.join(".");break}}}this.hostname.length>Qs?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=Us.toASCII(this.hostname));var w=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+w,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),u[0]!=="/"&&(u="/"+u))}if(!Js[f])for(var p=0,b=Fe.length;p<b;p++){var B=Fe[p];if(u.indexOf(B)!==-1){var R=encodeURIComponent(B);R===B&&(R=escape(B)),u=u.split(B).join(R)}}var j=u.indexOf("#");j!==-1&&(this.hash=u.substr(j),u=u.slice(0,j));var O=u.indexOf("?");if(O!==-1?(this.search=u.substr(O),this.query=u.substr(O+1),e&&(this.query=Qe.parse(this.query)),u=u.slice(0,O)):e&&(this.search="",this.query={}),u&&(this.pathname=u),Ft[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var w=this.pathname||"",ot=this.search||"";this.path=w+ot}return this.href=this.format(),this};function Zs(r){return mt.isString(r)&&(r=he(r)),r instanceof ut?r.format():ut.prototype.format.call(r)}ut.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var e=this.protocol||"",t=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=r+this.host:this.hostname&&(i=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&mt.isObject(this.query)&&Object.keys(this.query).length&&(o=Qe.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Ft[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),n&&n.charAt(0)!=="#"&&(n="#"+n),s&&s.charAt(0)!=="?"&&(s="?"+s),t=t.replace(/[?#]/g,function(u){return encodeURIComponent(u)}),s=s.replace("#","%23"),e+i+t+s+n};function Xs(r,e){return he(r,!1,!0).resolve(e)}ut.prototype.resolve=function(r){return this.resolveObject(he(r,!1,!0)).format()};function ta(r,e){return r?he(r,!1,!0).resolveObject(e):e}ut.prototype.resolveObject=function(r){if(mt.isString(r)){var e=new ut;e.parse(r,!1,!0),r=e}for(var t=new ut,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];t[o]=this[o]}if(t.hash=r.hash,r.href==="")return t.href=t.format(),t;if(r.slashes&&!r.protocol){for(var s=Object.keys(r),u=0;u<s.length;u++){var c=s[u];c!=="protocol"&&(t[c]=r[c])}return Ft[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(r.protocol&&r.protocol!==t.protocol){if(!Ft[r.protocol]){for(var a=Object.keys(r),f=0;f<a.length;f++){var h=a[f];t[h]=r[h]}return t.href=t.format(),t}if(t.protocol=r.protocol,!r.host&&!ze[r.protocol]){for(var b=(r.pathname||"").split("/");b.length&&!(r.host=b.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),t.pathname=b.join("/")}else t.pathname=r.pathname;if(t.search=r.search,t.query=r.query,t.host=r.host||"",t.auth=r.auth,t.hostname=r.hostname||r.host,t.port=r.port,t.pathname||t.search){var l=t.pathname||"",p=t.search||"";t.path=l+p}return t.slashes=t.slashes||r.slashes,t.href=t.format(),t}var g=t.pathname&&t.pathname.charAt(0)==="/",d=r.host||r.pathname&&r.pathname.charAt(0)==="/",v=d||g||t.host&&r.pathname,A=v,m=t.pathname&&t.pathname.split("/")||[],b=r.pathname&&r.pathname.split("/")||[],C=t.protocol&&!Ft[t.protocol];if(C&&(t.hostname="",t.port=null,t.host&&(m[0]===""?m[0]=t.host:m.unshift(t.host)),t.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(b[0]===""?b[0]=r.host:b.unshift(r.host)),r.host=null),v=v&&(b[0]===""||m[0]==="")),d)t.host=r.host||r.host===""?r.host:t.host,t.hostname=r.hostname||r.hostname===""?r.hostname:t.hostname,t.search=r.search,t.query=r.query,m=b;else if(b.length)m||(m=[]),m.pop(),m=m.concat(b),t.search=r.search,t.query=r.query;else if(!mt.isNullOrUndefined(r.search)){if(C){t.hostname=t.host=m.shift();var I=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;I&&(t.auth=I.shift(),t.host=t.hostname=I.shift())}return t.search=r.search,t.query=r.query,(!mt.isNull(t.pathname)||!mt.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!m.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var H=m.slice(-1)[0],W=(t.host||r.host||m.length>1)&&(H==="."||H==="..")||H==="",x=0,U=m.length;U>=0;U--)H=m[U],H==="."?m.splice(U,1):H===".."?(m.splice(U,1),x++):x&&(m.splice(U,1),x--);if(!v&&!A)for(;x--;x)m.unshift("..");v&&m[0]!==""&&(!m[0]||m[0].charAt(0)!=="/")&&m.unshift(""),W&&m.join("/").substr(-1)!=="/"&&m.push("");var S=m[0]===""||m[0]&&m[0].charAt(0)==="/";if(C){t.hostname=t.host=S?"":m.length?m.shift():"";var I=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;I&&(t.auth=I.shift(),t.host=t.hostname=I.shift())}return v=v||t.host&&m.length,v&&!S&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),(!mt.isNull(t.pathname)||!mt.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=r.auth||t.auth,t.slashes=t.slashes||r.slashes,t.href=t.format(),t};ut.prototype.parseHost=function(){var r=this.host,e=Vs.exec(r);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),r=r.substr(0,r.length-e.length)),r&&(this.hostname=r)};function ea(r,e){for(var t=0,n=r.length-1;n>=0;n--){var i=r[n];i==="."?r.splice(n,1):i===".."?(r.splice(n,1),t++):t&&(r.splice(n,1),t--)}if(e)for(;t--;t)r.unshift("..");return r}function ra(){for(var r="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var n=t>=0?arguments[t]:"/";if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)continue;r=n+"/"+r,e=n.charAt(0)==="/"}return r=ea(na(r.split("/"),function(i){return!!i}),!e).join("/"),(e?"/":"")+r||"."}function na(r,e){if(r.filter)return r.filter(e);for(var t=[],n=0;n<r.length;n++)e(r[n],n,r)&&t.push(r[n]);return t}var Pn=function(r){function e(){var n=this||self;return delete r.prototype.__magic__,n}if(typeof globalThis=="object")return globalThis;if(this)return e();r.defineProperty(r.prototype,"__magic__",{configurable:!0,get:e});var t=__magic__;return t}(Object),ia=Ds,An=qs,xn=Ks,Tn=Hs,Ct=Pn.URL,On=Pn.URLSearchParams,oa=/%/g,sa=/\\/g,aa=/\n/g,ua=/\r/g,ca=/\t/g,la=47;function fa(r){var e=r??null;return!!(e!==null&&(e!=null&&e.href)&&(e!=null&&e.origin))}function ha(r){if(r.hostname!=="")throw new TypeError('File URL host must be "localhost" or empty on browser');for(var e=r.pathname,t=0;t<e.length;t++)if(e[t]==="%"){var n=e.codePointAt(t+2)|32;if(e[t+1]==="2"&&n===102)throw new TypeError("File URL path must not include encoded / characters")}return decodeURIComponent(e)}function pa(r){return r.includes("%")&&(r=r.replace(oa,"%25")),r.includes("\\")&&(r=r.replace(sa,"%5C")),r.includes(`
`)&&(r=r.replace(aa,"%0A")),r.includes("\r")&&(r=r.replace(ua,"%0D")),r.includes("	")&&(r=r.replace(ca,"%09")),r}var kn=function(e){if(typeof e>"u")throw new TypeError('The "domain" argument must be specified');return new Ct("http://"+e).hostname},Mn=function(e){if(typeof e>"u")throw new TypeError('The "domain" argument must be specified');return new Ct("http://"+e).hostname},Cn=function(e){var t=new Ct("file://"),n=ra(e),i=e.charCodeAt(e.length-1);return i===la&&n[n.length-1]!=="/"&&(n+="/"),t.pathname=pa(n),t},Bn=function(e){if(!fa(e)&&typeof e!="string")throw new TypeError('The "path" argument must be of type string or an instance of URL. Received type '+typeof e+" ("+e+")");var t=new Ct(e);if(t.protocol!=="file:")throw new TypeError("The URL must be of scheme file");return ha(t)},Nn=function(e,t){var n,i,o;if(t===void 0&&(t={}),!(e instanceof Ct))return ia(e);if(typeof t!="object"||t===null)throw new TypeError('The "options" argument must be of type object.');var s=(n=t.auth)!=null?n:!0,u=(i=t.fragment)!=null?i:!0,c=(o=t.search)!=null?o:!0,a=new Ct(e.toString());return s||(a.username="",a.password=""),u||(a.hash=""),c||(a.search=""),a.toString()},da={format:Nn,parse:An,resolve:xn,resolveObject:In,Url:Tn,URL:Ct,URLSearchParams:On,domainToASCII:kn,domainToUnicode:Mn,pathToFileURL:Cn,fileURLToPath:Bn};const ya=Object.freeze(Object.defineProperty({__proto__:null,URL:Ct,URLSearchParams:On,Url:Tn,default:da,domainToASCII:kn,domainToUnicode:Mn,fileURLToPath:Bn,format:Nn,parse:An,pathToFileURL:Cn,resolve:xn,resolveObject:In},Symbol.toStringTag,{value:"Module"})),ga=Xe(ya);var ma=null;const va=Object.freeze(Object.defineProperty({__proto__:null,default:ma},Symbol.toStringTag,{value:"Module"})),Ye=Xe(va);var $e,Nr;function Rr(){if(Nr)return $e;Nr=1;const r=Ye,e=At("mqttjs:tcp");function t(n,i){i.port=i.port||1883,i.hostname=i.hostname||i.host||"localhost";const o=i.port,s=i.hostname;return e("port %d and host %s",o,s),r.createConnection(o,s)}return $e=t,$e}var Ue,Lr;function qe(){if(Lr)return Ue;Lr=1;const r=Ye,e=Ye,t=At("mqttjs:tls");function n(i,o){o.port=o.port||8883,o.host=o.hostname||o.host||"localhost",e.isIP(o.host)===0&&(o.servername=o.host),o.rejectUnauthorized=o.rejectUnauthorized!==!1,delete o.path,t("port %d host %s rejectUnauthorized %b",o.port,o.host,o.rejectUnauthorized);const s=r.connect(o);s.on("secureConnect",function(){o.rejectUnauthorized&&!s.authorized?s.emit("error",new Error("TLS not authorized")):s.removeListener("error",u)});function u(c){o.rejectUnauthorized&&i.emit("error",c),s.end()}return s.on("error",u),s}return Ue=n,Ue}var ur={exports:{}},_a=Rn;function Rn(r,e){if(r&&e)return Rn(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(u){o[u]=s[u]}),o}}var Ln=_a;ur.exports=Ln(ye);ur.exports.strict=Ln(jn);ye.proto=ye(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return ye(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return jn(this)},configurable:!0})});function ye(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function jn(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}var ba=ur.exports,wa=ba,Sa=function(){},Ea=function(r){return r.setHeader&&typeof r.abort=="function"},Ia=function(r){return r.stdio&&Array.isArray(r.stdio)&&r.stdio.length===3},$n=function(r,e,t){if(typeof e=="function")return $n(r,null,e);e||(e={}),t=wa(t||Sa);var n=r._writableState,i=r._readableState,o=e.readable||e.readable!==!1&&r.readable,s=e.writable||e.writable!==!1&&r.writable,u=!1,c=function(){r.writable||a()},a=function(){s=!1,o||t.call(r)},f=function(){o=!1,s||t.call(r)},h=function(v){t.call(r,v?new Error("exited with error code: "+v):null)},l=function(v){t.call(r,v)},p=function(){Pt.nextTick(g)},g=function(){if(!u){if(o&&!(i&&i.ended&&!i.destroyed))return t.call(r,new Error("premature close"));if(s&&!(n&&n.ended&&!n.destroyed))return t.call(r,new Error("premature close"))}},d=function(){r.req.on("finish",a)};return Ea(r)?(r.on("complete",a),r.on("abort",p),r.req?d():r.on("request",d)):s&&!n&&(r.on("end",c),r.on("close",c)),Ia(r)&&r.on("exit",h),r.on("end",f),r.on("finish",a),e.error!==!1&&r.on("error",l),r.on("close",p),function(){u=!0,r.removeListener("complete",a),r.removeListener("abort",p),r.removeListener("request",d),r.req&&r.req.removeListener("finish",a),r.removeListener("end",c),r.removeListener("close",c),r.removeListener("finish",a),r.removeListener("exit",h),r.removeListener("end",f),r.removeListener("error",l),r.removeListener("close",p)}},Pa=$n,Aa=xa;function xa(r){var e=r._readableState;return e?e.objectMode||typeof r._duplexState=="number"?r.read():r.read(Ta(e)):null}function Ta(r){if(r.buffer.length){var e=r.bufferIndex||0;if(r.buffer.head)return r.buffer.head.data.length;if(r.buffer.length-e>0&&r.buffer[e])return r.buffer[e].length}return r.length}var Me=Ut,Un=Pa,Oa=tr,ka=Aa,qn=_.from&&_.from!==Uint8Array.from?_.from([0]):new _([0]),Je=function(r,e){r._corked?r.once("uncork",e):e()},Ma=function(r,e){r._autoDestroy&&r.destroy(e)},Kn=function(r,e){return function(t){t?Ma(r,t.message==="premature close"?null:t):e&&!r._ended&&r.end()}},Ca=function(r,e){if(!r||r._writableState&&r._writableState.finished)return e();if(r._writableState)return r.end(e);r.end(),e()},Ba=function(){},Na=function(r){return new Me.Readable({objectMode:!0,highWaterMark:16}).wrap(r)},J=function(r,e,t){if(!(this instanceof J))return new J(r,e,t);Me.Duplex.call(this,t),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!t||t.autoDestroy!==!1,this._forwardDestroy=!t||t.destroy!==!1,this._forwardEnd=!t||t.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,r&&this.setWritable(r),e&&this.setReadable(e)};Oa(J,Me.Duplex);J.obj=function(r,e,t){return t||(t={}),t.objectMode=!0,t.highWaterMark=16,new J(r,e,t)};J.prototype.cork=function(){++this._corked===1&&this.emit("cork")};J.prototype.uncork=function(){this._corked&&--this._corked===0&&this.emit("uncork")};J.prototype.setWritable=function(r){if(this._unwrite&&this._unwrite(),this.destroyed){r&&r.destroy&&r.destroy();return}if(r===null||r===!1){this.end();return}var e=this,t=Un(r,{writable:!0,readable:!1},Kn(this,this._forwardEnd)),n=function(){var o=e._ondrain;e._ondrain=null,o&&o()},i=function(){e._writable.removeListener("drain",n),t()};this._unwrite&&Pt.nextTick(n),this._writable=r,this._writable.on("drain",n),this._unwrite=i,this.uncork()};J.prototype.setReadable=function(r){if(this._unread&&this._unread(),this.destroyed){r&&r.destroy&&r.destroy();return}if(r===null||r===!1){this.push(null),this.resume();return}var e=this,t=Un(r,{writable:!1,readable:!0},Kn(this)),n=function(){e._forward()},i=function(){e.push(null)},o=function(){e._readable2.removeListener("readable",n),e._readable2.removeListener("end",i),t()};this._drained=!0,this._readable=r,this._readable2=r._readableState?r:Na(r),this._readable2.on("readable",n),this._readable2.on("end",i),this._unread=o,this._forward()};J.prototype._read=function(){this._drained=!0,this._forward()};J.prototype._forward=function(){if(!(this._forwarding||!this._readable2||!this._drained)){this._forwarding=!0;for(var r;this._drained&&(r=ka(this._readable2))!==null;)this.destroyed||(this._drained=this.push(r));this._forwarding=!1}};J.prototype.destroy=function(r,e){if(e||(e=Ba),this.destroyed)return e(null);this.destroyed=!0;var t=this;Pt.nextTick(function(){t._destroy(r),e(null)})};J.prototype._destroy=function(r){if(r){var e=this._ondrain;this._ondrain=null,e?e(r):this.emit("error",r)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")};J.prototype._write=function(r,e,t){if(!this.destroyed){if(this._corked)return Je(this,this._write.bind(this,r,e,t));if(r===qn)return this._finish(t);if(!this._writable)return t();this._writable.write(r)===!1?this._ondrain=t:this.destroyed||t()}};J.prototype._finish=function(r){var e=this;this.emit("preend"),Je(this,function(){Ca(e._forwardEnd&&e._writable,function(){e._writableState.prefinished===!1&&(e._writableState.prefinished=!0),e.emit("prefinish"),Je(e,r)})})};J.prototype.end=function(r,e,t){return typeof r=="function"?this.end(null,null,r):typeof e=="function"?this.end(r,null,e):(this._ended=!0,r&&this.write(r),!this._writableState.ending&&!this._writableState.destroyed&&this.write(qn),Me.Writable.prototype.end.call(this,t))};var cr=J,Ke,jr;function $r(){if(jr)return Ke;jr=1;const{Buffer:r}=Pe,e=Ut.Transform,t=cr;let n,i,o;function s(){const h=new e;return h._write=function(l,p,g){n.send({data:l.buffer,success:function(){g()},fail:function(d){g(new Error(d))}})},h._flush=function(p){n.close({success:function(){p()}})},h}function u(h){h.hostname||(h.hostname="localhost"),h.path||(h.path="/"),h.wsOptions||(h.wsOptions={})}function c(h,l){const p=h.protocol==="wxs"?"wss":"ws";let g=p+"://"+h.hostname+h.path;return h.port&&h.port!==80&&h.port!==443&&(g=p+"://"+h.hostname+":"+h.port+h.path),typeof h.transformWsUrl=="function"&&(g=h.transformWsUrl(g,h,l)),g}function a(){n.onOpen(function(){o.setReadable(i),o.setWritable(i),o.emit("connect")}),n.onMessage(function(h){let l=h.data;l instanceof ArrayBuffer?l=r.from(l):l=r.from(l,"utf8"),i.push(l)}),n.onClose(function(){o.end(),o.destroy()}),n.onError(function(h){o.destroy(new Error(h.errMsg))})}function f(h,l){if(l.hostname=l.hostname||l.host,!l.hostname)throw new Error("Could not determine host. Specify host manually.");const p=l.protocolId==="MQIsdp"&&l.protocolVersion===3?"mqttv3.1":"mqtt";u(l);const g=c(l,h);n=wx.connectSocket({url:g,protocols:[p]}),i=s(),o=t.obj(),o._destroy=function(v,A){n.close({success:function(){A&&A(v)}})};const d=o.destroy;return o.destroy=(function(){o.destroy=d;const v=this;setTimeout(function(){n.close({fail:function(){v._destroy(new Error)}})},0)}).bind(o),a(),o}return Ke=f,Ke}var De,Ur;function qr(){if(Ur)return De;Ur=1;const{Buffer:r}=Pe,e=Ut.Transform,t=cr;let n,i,o,s=!1;function u(){const l=new e;return l._write=function(p,g,d){n.sendSocketMessage({data:p.buffer,success:function(){d()},fail:function(){d(new Error)}})},l._flush=function(g){n.closeSocket({success:function(){g()}})},l}function c(l){l.hostname||(l.hostname="localhost"),l.path||(l.path="/"),l.wsOptions||(l.wsOptions={})}function a(l,p){const g=l.protocol==="alis"?"wss":"ws";let d=g+"://"+l.hostname+l.path;return l.port&&l.port!==80&&l.port!==443&&(d=g+"://"+l.hostname+":"+l.port+l.path),typeof l.transformWsUrl=="function"&&(d=l.transformWsUrl(d,l,p)),d}function f(){s||(s=!0,n.onSocketOpen(function(){o.setReadable(i),o.setWritable(i),o.emit("connect")}),n.onSocketMessage(function(l){if(typeof l.data=="string"){const p=r.from(l.data,"base64");i.push(p)}else{const p=new FileReader;p.addEventListener("load",function(){let g=p.result;g instanceof ArrayBuffer?g=r.from(g):g=r.from(g,"utf8"),i.push(g)}),p.readAsArrayBuffer(l.data)}}),n.onSocketClose(function(){o.end(),o.destroy()}),n.onSocketError(function(l){o.destroy(l)}))}function h(l,p){if(p.hostname=p.hostname||p.host,!p.hostname)throw new Error("Could not determine host. Specify host manually.");const g=p.protocolId==="MQIsdp"&&p.protocolVersion===3?"mqttv3.1":"mqtt";c(p);const d=a(p,l);return n=p.my,n.connectSocket({url:d,protocols:g}),i=u(),o=t.obj(),f(),o}return De=h,De}var Ze={exports:{}},Ra=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const{Buffer:ie}=Pe,Dn=Ra,ae=At("mqttjs:ws"),La=cr,ja=Ut.Transform,$a=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],Hn=typeof Pt<"u"&&Pt.title==="browser"||typeof __webpack_require__=="function";function Gn(r,e){let t=r.protocol+"://"+r.hostname+":"+r.port+r.path;return typeof r.transformWsUrl=="function"&&(t=r.transformWsUrl(t,r,e)),t}function Vn(r){const e=r;return r.hostname||(e.hostname="localhost"),r.port||(r.protocol==="wss"?e.port=443:e.port=80),r.path||(e.path="/"),r.wsOptions||(e.wsOptions={}),!Hn&&r.protocol==="wss"&&$a.forEach(function(t){Object.prototype.hasOwnProperty.call(r,t)&&!Object.prototype.hasOwnProperty.call(r.wsOptions,t)&&(e.wsOptions[t]=r[t])}),e}function Ua(r){const e=Vn(r);if(e.hostname||(e.hostname=e.host),!e.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");const t=new URL(document.URL);e.hostname=t.hostname,e.port||(e.port=t.port)}return e.objectMode===void 0&&(e.objectMode=!(e.binary===!0||e.binary===void 0)),e}function qa(r,e,t){ae("createWebSocket"),ae("protocol: "+t.protocolId+" "+t.protocolVersion);const n=t.protocolId==="MQIsdp"&&t.protocolVersion===3?"mqttv3.1":"mqtt";return ae("creating new Websocket for url: "+e+" and protocol: "+n),new Dn(e,[n],t.wsOptions)}function Ka(r,e){const t=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt",n=Gn(e,r),i=new WebSocket(n,[t]);return i.binaryType="arraybuffer",i}function Da(r,e){ae("streamBuilder");const t=Vn(e),n=Gn(t,r),i=qa(r,n,t),o=Dn.createWebSocketStream(i,t.wsOptions);return o.url=n,i.on("close",()=>{o.destroy()}),o}function Ha(r,e){ae("browserStreamBuilder");let t;const i=Ua(e).browserBufferSize||1024*512,o=e.browserBufferTimeout||1e3,s=!e.objectMode,u=Ka(r,e),c=f(e,v,A);e.objectMode||(c._writev=d),c.on("close",()=>{u.close()});const a=typeof u.addEventListener<"u";u.readyState===u.OPEN?t=c:(t=t=La(void 0,void 0,e),e.objectMode||(t._writev=d),a?u.addEventListener("open",h):u.onopen=h),t.socket=u,a?(u.addEventListener("close",l),u.addEventListener("error",p),u.addEventListener("message",g)):(u.onclose=l,u.onerror=p,u.onmessage=g);function f(m,b,C){const I=new ja({objectModeMode:m.objectMode});return I._write=b,I._flush=C,I}function h(){t.setReadable(c),t.setWritable(c),t.emit("connect")}function l(){t.end(),t.destroy()}function p(m){t.destroy(m)}function g(m){let b=m.data;b instanceof ArrayBuffer?b=ie.from(b):b=ie.from(b,"utf8"),c.push(b)}function d(m,b){const C=new Array(m.length);for(let I=0;I<m.length;I++)typeof m[I].chunk=="string"?C[I]=ie.from(m[I],"utf8"):C[I]=m[I].chunk;this._write(ie.concat(C),"binary",b)}function v(m,b,C){u.bufferedAmount>i&&setTimeout(v,o,m,b,C),s&&typeof m=="string"&&(m=ie.from(m,"utf8"));try{u.send(m)}catch(I){return C(I)}C()}function A(m){u.close(),m()}return t}Hn?Ze.exports=Ha:Ze.exports=Da;var Wn=Ze.exports;const Fn=Is,Ga=Vr,Va=ga,Wa=rr,Kr=At("mqttjs"),it={};typeof Pt<"u"&&Pt.title!=="browser"||typeof __webpack_require__!="function"?(it.mqtt=Rr(),it.tcp=Rr(),it.ssl=qe(),it.tls=qe(),it.mqtts=qe()):(it.wx=$r(),it.wxs=$r(),it.ali=qr(),it.alis=qr());it.ws=Wn;it.wss=Wn;function Fa(r){let e;r.auth&&(e=r.auth.match(/^(.+):(.+)$/),e?(r.username=e[1],r.password=e[2]):r.username=r.auth)}function zn(r,e){if(Kr("connecting to an MQTT broker..."),typeof r=="object"&&!e&&(e=r,r=null),e=e||{},r){const i=Va.parse(r,!0);if(i.port!=null&&(i.port=Number(i.port)),e=Wa(i,e),e.protocol===null)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(Fa(e),e.query&&typeof e.query.clientId=="string"&&(e.clientId=e.query.clientId),e.cert&&e.key)if(e.protocol){if(["mqtts","wss","wxs","alis"].indexOf(e.protocol)===-1)switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}else throw new Error("Missing secure protocol key");if(!it[e.protocol]){const i=["mqtts","wss"].indexOf(e.protocol)!==-1;e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(o,s){return i&&s%2===0?!1:typeof it[o]=="function"})[0]}if(e.clean===!1&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);function t(i){return e.servers&&((!i._reconnectCount||i._reconnectCount===e.servers.length)&&(i._reconnectCount=0),e.host=e.servers[i._reconnectCount].host,e.port=e.servers[i._reconnectCount].port,e.protocol=e.servers[i._reconnectCount].protocol?e.servers[i._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,i._reconnectCount++),Kr("calling streambuilder for",e.protocol),it[e.protocol](i,e)}const n=new Fn(t,e);return n.on("error",function(){}),n}ue.exports=zn;ue.exports.connect=zn;ue.exports.MqttClient=Fn;ue.exports.Store=Ga;var za=ue.exports;const Qa=Ie(za),Ya=Bt({key:"messageCrypto",default:{}}),Ja=Bt({key:"messageRanking",default:{}});function ru(){const[r,e]=dt.useState(null),t=He(Ya),n=He(Ja),[i,o]=dt.useState(!1),s=dt.useRef(null),u=dt.useRef(null),c=ri(),a=(l,p,g)=>{var d;(d=s.current)!=null&&d.connected||(s.current&&(s.current.end(),s.current=null),s.current=Qa.connect(l,{clean:!0,keepalive:10,clientId:c,connectTimeout:4e3,reconnectPeriod:3e3,username:p,password:g}),s.current.on("connect",()=>{var v,A,m;console.log("Connection mqtt succeeded!"),o(!0),(v=s.current)==null||v.subscribe(["lt_result","future/pair_info","ranking/betRecord"],{qos:1}),(A=s.current)==null||A.removeAllListeners("message"),(m=s.current)==null||m.on("message",(b,C)=>{if(b==="lt_result"){const I=JSON.parse(C.toString());e(I)}if(b==="future/pair_info"){const I=JSON.parse(C.toString());t(I)}if(b==="ranking/betRecord"){const I=JSON.parse(C.toString());n(I)}})}),s.current.on("disconnect",()=>{f(l,p,g),o(!1)}),s.current.on("error",v=>{console.log("MQTT error",v),o(!1),f(l,p,g)}))},f=(l,p,g)=>{console.log("Connection lost, attempting to reconnect..."),u.current&&clearInterval(u.current),u.current=setInterval(()=>{var d,v;(d=s.current)!=null&&d.connected?(u.current&&clearInterval(u.current),u.current=null,console.log("Reconnected successfully!")):((v=s.current)==null||v.end(!0,()=>{console.log("Successfully disconnected!")}),s.current=null,a(l,p,g))},3e3)},h=()=>{var l,p;if((l=s.current)!=null&&l.connected)try{(p=s.current)==null||p.end(!0,()=>{console.log("Successfully disconnected!")}),s.current=null}catch(g){console.log("Disconnect failed",g.toString())}u.current&&clearInterval(u.current)};return dt.useEffect(()=>()=>{h()},[]),{message:r,mqttClient:s.current,isConnected:i,createConnection:a,destroyConnection:h}}export{tu as a,ru as b,Ja as c,Ya as m,di as p,gi as u};
