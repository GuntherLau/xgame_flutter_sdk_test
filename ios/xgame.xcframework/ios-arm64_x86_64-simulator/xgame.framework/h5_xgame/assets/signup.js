import{j as e,u as le,a as ie,S as ce,r as l,g as de,h as me,b as pe,k as ue,T as s,M as j,H as m,R as he,t as fe,v as xe,m as R,n as I,w as ve,o as we,p as _e,q as D,G}from"./index.sdk-0.0.1.js";import{S as Ce,C as _,I as ge,a as Ne,b as je}from"./captcha.js";import{P as ye,p as be}from"./index5.js";import{A as Pe}from"./button.js";import{A as X,O as Se}from"./auth.dto.js";import{UserAgreementModal as ke}from"./user-aggrement.js";import{e as Te}from"./common.js";import{T as Re}from"./captcha2.js";import"./Modal.js";import"./emotion-react.browser.esm.js";import"./popover.js";import"./chains.js";import"./modals.js";import"./no-record.js";import"./normal-layout.js";import"./main-layout.js";import"./lazy-load-component.js";function Ke(){return e.jsx(Ce,{children:e.jsx("div",{className:"px-5 py-3 bg-[var(--auth-bg)] grow overflow-hidden overflow-y-auto hide-scrollbar rounded-t-[20px]",children:e.jsx(Ae,{})})})}const Ie={phone:"",email:"",account:"",password:"",confirmPassword:"",intrCode:"",otp:"",fullName:"",vCode:"",errors:{phone:"",email:"",account:"",password:"",confirmPassword:"",intrCode:"",otp:"",fullName:"",vCode:""}},Ee=(f,x)=>{switch(x.type){case"change":return f.errors[x.field]="",{...f,[x.field]:x.value};default:return f}};function Ae(){const{i18n:{language:f}}=le(),x=ie(),E=new ce(x.search),[i,B]=l.useState({intrCode:2,fullName:2,email:0,phone:0,vCode:0}),[A,F]=l.useState(!1),[v,M]=l.useState(""),[c,w]=l.useState(!1),[Y,Z]=l.useState(!1),[y,Q]=l.useState(!0),[Fe,V]=de(me),[n,J]=l.useState(!1),[b,K]=l.useState(!0),[r,P]=l.useReducer(Ee,Ie),[W,ee]=l.useState(!1),[S,O]=l.useState(0),L=l.useRef(null),C=pe(ue),k=l.useRef(null),U=l.useRef(null),p=l.useMemo(()=>({account:{pattern:/^[a-zA-Z][a-zA-Z0-9]{5,14}$/,message:s.username_rule()},password:{pattern:/^.{8,20}$/,message:s.password_rule()},confirmPassword:{validator:(a,t)=>t.password!=a?(t.errors.confirmPassword=s.password_confirm_not_match(),!1):/^.{8,20}$/.test(a)?!0:(t.errors.confirmPassword=s.password_rule(),!1)},phone:{validator:(a,t)=>a?a.length<8||a.length>15?(t.errors.phone=s.phone_number_invalid(),!1):!0:(t.errors.phone=s.phone_is_required(),!1)},email:{validator:(a,t)=>Te.test(a)?!0:(t.errors.email=s.email_is_invalid(),!1)},intrCode:{validator:(a,t)=>i.intrCode==1&&!a?(t.errors.intrCode=s.introCodeRequired(),!1):!0},fullName:{validator:(a,t)=>i.fullName==1&&!a?(t.errors.intrCode=s.fullname_is_required(),!1):!0},otp:{validator:(a,t)=>(n&&i.phone==3||!n&&i.email==3)&&!a?(t.errors.intrCode=s.otp_is_required(),!1):!0},vCode:{validator:(a,t)=>i.vCode==1&&[_.COMPLEX,_.SIMPLE].includes(C)&&!a?(t.errors.vCode=s.vali_code_is_required(),!1):!0}}),[f,i,n,i.vCode,C]),ae=n?i.phone==3:i.email==3,re=a=>{a&&(w(!1),P({type:"change",field:"phone",value:a}))},u=a=>{const{name:t,value:o}=a.target;w(!1),P({type:"change",field:t,value:o})},se=async()=>{try{const a=await fe();B({intrCode:a.intrCode,fullName:a.fullName,email:a.email,phone:a.phone,vCode:a.vCode})}catch(a){console.log(a)}},T=()=>{var t;for(const o of Object.keys(p))r.errors[o]="",!(n&&o=="email"||!n&&o=="phone")&&(p[o].validator&&p[o].validator(r[o],r),p[o].pattern&&((t=p[o].pattern)!=null&&t.test(r[o])||(r.errors[o]=p[o].message??"")));const a=!Object.values(r.errors).some(o=>o!="");return Z(a),a},$=async a=>{var t,o,g,q,H;if(m.removeToken(),!y){m.showError(s.must_accept_term());return}if(!T()){w(!0);return}try{F(!0);const h=(((t=be(a.phone))==null?void 0:t.nationalNumber)||"").replace("+",""),N={phone:h,email:a.email,account:a.account,password:R(a.password),confirmPassword:R(a.confirmPassword),version:I.version(),otp:a.otp,fullName:a.fullName,vCode:a.vCode};if(n?delete N.email:delete N.phone,a.intrCode&&(N.intrCode=a.intrCode),await ve(N),I.isCORS()){const d={phone:h,email:a.account,account:a.account,password:R(a.password),version:I.version(),mode:n?1:2,valiCode:a.vCode};n?(delete d.account,delete d.email):(delete d.phone,/^[\w-.]+@([\w-]+.)+[\w-]{2,4}$/.test(d.account||"")?(d.mode=2,delete d.account):(d.mode=3,delete d.email)),await we(d),m.setRemember({account:a.account,password:a.password,phone:h})}const z=await _e();z!=null&&V(z),m.showToast(s.register_successfully()),m.navigateBack()}catch(h){console.log(h),(o=k.current)==null||o.refresh(),(g=U.current)==null||g.refresh(),D.emit(G.showError,(((H=(q=h.response)==null?void 0:q.data)==null?void 0:H.message)??h.message).replace(n?a.phone:a.email,""))}finally{F(!1)}},te=async()=>{var a,t;if(!(S>0)){if(r.errors={phone:"",email:"",account:"",password:"",confirmPassword:"",intrCode:"",otp:"",fullName:"",vCode:""},n){if(!p.phone.validator(r.phone,r)){w(!0);return}}else if(!p.email.validator(r.email,r)){w(!0);return}try{await xe({authenType:n?X.PHONE:X.EMAIL,authenValue:n?r.phone:r.email,otpType:Se.REGISTER});let o=60;O(o),L.current=setInterval(()=>{O(--o),o<=0&&clearInterval(L.current)},1e3)}catch(o){const g=((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)??"";m.showToast(g.replace(r.phone,"").trim().replace(n?r.phone:r.email,""))}}},oe=async()=>new Promise(a=>{var t;(t=k.current)==null||t.verify(),D.on(G.waitFor3rdCaptcha,o=>{a(o)})}),ne=async()=>{if(m.removeToken(),!T()){w(!0);return}if(i.vCode==1&&C==_.THIRD_PARTY){const a=await oe();if(!a)return;r.vCode=a,$(r);return}$(r)};return l.useEffect(()=>{se(),E.findString("intrCode","")&&P({type:"change",field:"intrCode",value:E.findString("intrCode","")})},[]),l.useEffect(()=>{T()},[r.account,r.confirmPassword,r.email,r.password,r.phone,r.intrCode,r.fullName,r.otp,r.vCode]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 justify-between",children:[e.jsx("h1",{className:"text-[var(--active)] font-bold text-shadow text-xl",children:s.sign_up()}),e.jsxs("div",{className:"flex items-center gap-1 cursor-pointer",onClick:()=>J(!n),children:[e.jsx(j,{name:"ic_change",color:"var(--text-content-color)",className:"w-3 h-3"}),e.jsx("span",{className:"text-[var(--auth-label)] text-xs",children:n?s.account_or_email():s.phone_number()})]})]}),n?e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"phone",className:"text-[var(--auth-label)] text-sm block",children:[s.phone_number()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsx(ye,{className:"mt-2",value:r.phone,onChange:re,placeholder:s.enter_phone(),local:f}),c&&r.errors.phone&&e.jsx("p",{className:"error",children:r.errors.phone})]}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"email",className:"text-[var(--auth-label)] text-sm block",children:[s.email_address()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsx("input",{type:"text",id:"email",name:"email",value:r.email,onChange:u,placeholder:s.enter_email(),autoComplete:"off",className:"auth input-all input-all__border mt-2 px-2 py-2 w-full"}),c&&r.errors.email&&e.jsx("p",{className:"error",children:r.errors.email})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"account-name",className:"text-[var(--auth-label)] text-sm block",children:[s.account_name()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsx("input",{type:"text",id:"account-name",name:"account",value:r.account,onChange:u,placeholder:s.enter_account(),autoComplete:"off",className:"auth input-all input-all__border mt-2 px-2 py-2 w-full"}),c&&r.errors.account&&e.jsx("p",{className:"error",children:r.errors.account})]}),i.fullName!=2&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"full-name",className:"text-[var(--auth-label)] text-sm block",children:[s.full_name()," ",i.fullName==1&&e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsx("input",{type:"text",id:"full-name",name:"fullName",value:r.fullName,onChange:u,placeholder:s.enter_your_real_name(),autoComplete:"off",maxLength:50,className:"auth input-all input-all__border mt-2 px-2 py-2 w-full"}),c&&r.errors.fullName&&e.jsx("p",{className:"error",children:r.errors.fullName})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-[var(--auth-label)] text-sm block",children:[s.password()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 ",children:[e.jsx("input",{type:v=="password"?"text":"password",id:"password",name:"password",value:r.password,onChange:u,placeholder:s.enter_password(),autoComplete:"off",className:"auth input-all py-2 grow"}),e.jsx(j,{name:v=="password"?"ic_eye_open":"ic_eye_close",onClick:()=>M(v=="password"?"":"password"),color:"#444449",className:"w-4 h-4"})]}),c&&r.errors.password&&e.jsx("p",{className:"error",children:r.errors.password})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"text-[var(--auth-label)] text-sm block",children:[s.confirm_password()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 ",children:[e.jsx("input",{type:v=="confirmPassword"?"text":"password",id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:u,placeholder:s.enter_confirm_password(),autoComplete:"off",className:"auth input-all py-2 grow"}),e.jsx(j,{name:v=="confirmPassword"?"ic_eye_open":"ic_eye_close",onClick:()=>M(v=="confirmPassword"?"":"confirmPassword"),color:"#444449",className:"w-4 h-4"})]}),c&&r.errors.confirmPassword&&e.jsx("p",{className:"error",children:r.errors.confirmPassword})]}),ae&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"otp",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",n?s.get_a_verification_code():s.email_verification_code()]}),e.jsxs("div",{className:"w-full input-all input-all__border px-3 h-11 mt-1 flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:r.otp,onChange:u,className:"auth input-all grow"}),e.jsx("span",{onClick:te,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:S>0?`${s.resend()}(${S}s)`:s.get_a_verification_code()})]}),c&&r.errors.otp&&e.jsx("p",{className:"error",children:r.errors.otp})]}),i.vCode==1&&[_.COMPLEX,_.SIMPLE].includes(C)&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"vCode",className:"text-[var(--auth-label)] text-sm block",children:[s.vali_code()," ",e.jsx("span",{className:"text-[#df183c]",children:"*"})]}),e.jsx(ge,{ref:U,className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 py-0.5",inputClassName:"auth input-all py-2 h-full",onChange:u,id:"vCode",name:"vCode",placeholder:s.enter_vali_code_hint()}),c&&r.errors.vCode&&e.jsx("p",{className:"error",children:r.errors.vCode})]}),i.vCode==1&&C==_.THIRD_PARTY&&e.jsx(Re,{ref:k}),i.intrCode!=2&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"invite-code",className:"text-[var(--auth-label)] text-sm flex items-center",children:[e.jsxs("span",{children:[s.invitation_code()," "]}),i.intrCode==0?e.jsxs("span",{className:"flex items-center pl-1 gap-2",children:["(",s.optional(),")",e.jsx("span",{className:"w-4 h-4 rounded-[50%] bg-[#4f4f55] flex items-center justify-center",onClick:()=>K(!b),children:e.jsx(j,{name:"ic_arrow_down",color:"#858590",className:`w-2 h-2 ${b?"rotate-180":""}`})})]}):e.jsx("span",{className:"text-[#df183c] pl-0.5",children:"*"})]}),e.jsx("input",{type:"text",id:"intrCode",name:"intrCode",autoComplete:"off",value:r.intrCode,onChange:u,placeholder:s.enter_invite_code(),className:`auth input-all input-all__border mt-2 px-2 py-2 w-full ${b?"":"hidden"}`}),c&&r.errors.intrCode&&e.jsx("p",{className:"error",children:r.errors.intrCode})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx(Ne,{checked:y,onChange:a=>Q(a.target.checked),size:"small",sx:{color:"var(--active)",padding:"0px !important","&.Mui-checked":{color:"var(--active)"},"& .MuiSvgIcon-root":{fontSize:19}}}),e.jsxs("div",{className:"text-xs text-[var(--text-content-color)]",children:[e.jsxs("span",{children:[s.I_have_read_and_aggree()," "]}),e.jsxs("span",{className:"text-[var(--active)] underline cursor-pointer",onClick:()=>m.navigate(he.userAggrement),children:[" ","Xgames ",s.term_and_condition()]})]})]}),e.jsx("div",{className:"text-center mt-5 flex justify-center",children:e.jsx(Pe,{title:s.sign_up(),onClick:ne,loading:A,disable:A,useDisableStyle:!Y||!y})}),e.jsxs("div",{className:"text-center text-sm text-[var(--text-content-color)] py-3",children:[s.already_have_an_account(),"."," ",e.jsx("span",{className:"text-[var(--active)] cursor-pointer",onClick:()=>m.navigate("/auth/login",{replace:!0}),children:s.login()})]}),e.jsx(je,{title:s.sign_up_directly_with()}),e.jsx(ke,{onClose:()=>ee(!1),open:W})]})}export{Ke as SignUpView};
