import{b as k,h as M,r as c,j as a,T as s,l as A,M as d,H as n,af as l,bd as T,q as E,G as F}from"./index.sdk-0.0.1.js";import{N as O}from"./normal-layout.js";import{a as P,A as R}from"./avatar-selector.js";import{S as B}from"./modals.js";import{D as G}from"./date-picker-bottom-sheet.js";import"./main-layout.js";import"./popover.js";import"./Modal.js";import"./lazy-load-component.js";import"./SwipeableDrawer.js";import"./Drawer.js";import"./index7.js";const H={nickname:"",avatarId:1,birthday:null,gender:""},$=e=>Object.assign({},H,e),q=(e,i)=>{switch(i.type){case"change":return{...e,[i.field]:i.value};case"reset":return i.payload;default:return e}};function ae(){var w;const{userInfo:e}=k(M),[i,v]=c.useState(!1),[x,b]=c.useState(!1),[f,g]=c.useState(!1),[t,m]=c.useReducer(q,$({avatarId:(e==null?void 0:e.avatarId)||1,birthday:e!=null&&e.birthday?new Date(e.birthday):null,gender:(e==null?void 0:e.gender)||""})),[N,p]=c.useState(!1),y=r=>{const{name:h,value:o}=r.target;m({type:"change",field:h,value:o})},C=r=>{r&&m({type:"change",field:"birthday",value:r})},D=r=>{m({type:"change",field:"avatarId",value:r})},_=()=>{p(!0)},S=()=>{b(t.avatarId!=(e==null?void 0:e.avatarId)||t.gender!=((e==null?void 0:e.gender)||"")||!!t.birthday&&l(t.birthday??"").format("YYYY-MM-DD")!="Invalid Date"&&l(t.birthday??"").format("YYYY-MM-DD")!=((e==null?void 0:e.birthday)||""))},j=async()=>{var r,h;try{const o={};if(t.avatarId!=(e==null?void 0:e.avatarId)&&(o.avatarId=t.avatarId),t.birthday&&l(t.birthday).format("YYYY-MM-DD")!=(e==null?void 0:e.birthday)&&(o.birthday=l(t.birthday).format("YYYY-MM-DD")),t.gender!=(e==null?void 0:e.gender)&&(o.gender=t.gender),Object.keys(o).length==0)return;await T(o),E.emit(F.refreshUserInfo),n.showToast(s.save_successfully()),b(!1)}catch(o){n.showToast(((h=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:h.message)??"")}},u=()=>{if(x){g(!0);return}n.navigate(-1)},Y=async()=>{await j(),n.navigate(-1)};return c.useEffect(()=>{e!=null&&e.account&&S()},[t.avatarId,t.birthday,t.gender,t.nickname]),c.useEffect(()=>{m({type:"reset",payload:{avatarId:(e==null?void 0:e.avatarId)||1,birthday:e!=null&&e.birthday?new Date(e.birthday):null,gender:(e==null?void 0:e.gender)||""}})},[e]),a.jsx(O,{title:s.personal_information(),className:"max-w-[800px] mx-auto ",rightEl:a.jsx("span",{onClick:j,className:`text-sm ${x?"text-[#adf100]":"text-[var(--arrow-color)]"}`,children:s.save()}),onBack:u,children:a.jsxs("div",{className:" p-3 overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[a.jsxs("div",{className:"bg-[var(--box-bg)] rounded-md ",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"text-[var(--text-color)]",children:s.avatar()}),a.jsxs("div",{className:"pl-10 flex items-center gap-3",onClick:()=>v(!0),children:[a.jsx(A,{src:(w=P.find(r=>r.id==t.avatarId))==null?void 0:w.value,alt:"",className:"w-11 circle"}),a.jsx(d,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:s.username()}),a.jsxs("span",{onClick:()=>n.copy((e==null?void 0:e.account)??""),className:"font-light",children:[" ",e==null?void 0:e.account]}),a.jsx(d,{color:"var(--text-content-color)",name:"ic_copy",className:"w-3 h-3 opacity-80",onClick:()=>n.copy((e==null?void 0:e.account)??"")})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:s.register_time()}),a.jsx("input",{className:"font-light outline-none border-none bg-transparent text-right",disabled:!0,value:e==null?void 0:e.addTime}),a.jsx(d,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:"ID"}),a.jsx("span",{className:"font-light",onClick:()=>{var r;return n.copy(((r=e==null?void 0:e.userId)==null?void 0:r.toString())??"")},children:e==null?void 0:e.userId}),a.jsx(d,{color:"var(--text-content-color)",name:"ic_copy",className:"w-3 h-3 opacity-80",onClick:()=>{var r;return n.copy(((r=e==null?void 0:e.userId)==null?void 0:r.toString())??"")}})]})]}),a.jsxs("div",{className:"bg-[var(--box-bg)] rounded-md mt-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:s.birthday()}),a.jsxs("div",{className:"flex items-center justify-center gap-3 max-w-[80%]",onClick:_,children:[a.jsx("div",{className:`overflow-hidden overflow-ellipsis text-nowrap ${t.birthday?"":"text-[var(--text-content-color)] text-sm"}`,children:t.birthday?l(t.birthday).format("YYYY/MM/DD"):s.complete_birthday_information()}),a.jsx(d,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:s.gender()}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{htmlFor:"gender_man",children:s.man()}),a.jsx("input",{id:"gender_man",type:"radio",name:"gender",value:"M",checked:t.gender=="M",onChange:y}),a.jsx("label",{htmlFor:"gender_woman",className:"ml-3",children:s.woman()}),a.jsx("input",{id:"gender_woman",type:"radio",name:"gender",value:"F",checked:t.gender=="F",onChange:y})]})]})]}),a.jsx(R,{onChange:D,onClose:()=>v(!1),open:i}),a.jsx(G,{isOpen:N,initialDate:t.birthday?l(t.birthday).toDate():void 0,onCancel:()=>p(!1),onConfirm:r=>{p(!1),C(r)},maxDate:new Date}),a.jsx(B,{content:s.do_you_want_to_save_change(),onClose:()=>g(!1),onCancel:()=>n.navigate(-1),onConfirm:Y,open:f,cancelText:s.no(),confirmText:s.yes()})]})})}export{ae as PersonalInfoView};
