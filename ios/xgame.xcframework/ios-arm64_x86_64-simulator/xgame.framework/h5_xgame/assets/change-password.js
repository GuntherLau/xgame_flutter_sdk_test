import{a as G,j as e,R as h,T as o,b as q,h as D,r as l,H as m,M as P,aF as $,aG as U,v as W,b7 as z}from"./index.sdk-0.0.1.js";import{A as J}from"./button.js";import{N as K}from"./normal-layout.js";import{O as Q,A as v}from"./auth.dto.js";import{p as S}from"./common.js";import{S as X}from"./sucess-view.js";import{u as Y}from"./useSetupConfig.js";import{S as Z}from"./modals.js";import"./main-layout.js";import"./popover.js";import"./Modal.js";import"./lazy-load-component.js";const I={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:"",errors:{oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""}},ee=(a,i)=>{switch(i.type){case"change":return a.errors[i.field]="",{...a,[i.field]:i.value};default:return a}};function he(){const a=G();return e.jsx(K,{title:a.pathname==h.changePassword?o.login_password():o.transaction_password(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt ",children:e.jsx(se,{})})})}function se(){const{userInfo:a}=q(D),{needBind:i,formConf:r,setFormConf:E}=Y(),[F,j]=l.useState(!1),[u,C]=l.useState(!1),[s,O]=l.useReducer(ee,I),[T,R]=l.useState(!1),[k,A]=l.useState(!1),[x,y]=l.useState(0),b=l.useRef(null),[p,_]=l.useState({isPhone:!1,open:!1}),[c,V]=l.useState({oldPassword:!1,newPassword:!1,newPasswordConfirm:!1}),g=t=>{V(Object.assign({},{oldPassword:!1,newPassword:!1,newPasswordConfirm:!1},{[t]:!c[t]}))},f=t=>{const{name:d,value:n}=t.target;C(!1),O({type:"change",field:d,value:n})},N=()=>{s.errors={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""},r.verifyOldPass&&!s.oldPassword&&(s.errors.oldPassword=o.current_password_is_required()),S.test(s.newPassword)||(s.errors.newPassword=o.password_rule()),S.test(s.newPasswordConfirm)||(s.errors.newPasswordConfirm=o.password_rule()),s.newPasswordConfirm!=s.newPassword&&(s.errors.newPasswordConfirm=o.password_confirm_not_match()),(r.verifyPassPhone||r.verifyPassEmail)&&!s.otp&&(s.errors.otp=o.otp_is_required());const t=!Object.values(s.errors).some(d=>d!="");return R(t),t},M=async()=>{var t,d;if(!(x>0))try{const n=Q.CHANGE_PASSWORD;await W({authenType:r.usePhone?v.PHONE:v.EMAIL,authenValue:r.usePhone?a==null?void 0:a.phone:a==null?void 0:a.email,otpType:n});let w=60;y(w),b.current=setInterval(()=>{y(--w),w<=0&&clearInterval(b.current)},1e3)}catch(n){const w=((d=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:d.message)??"";m.showToast(w.replace((a==null?void 0:a.phone)??"","").replace((a==null?void 0:a.email)??"","").trim())}},H=async()=>{var t,d;if(!N()){C(!0);return}if(s.oldPassword==s.newPassword){m.showToast(o.new_password_and_old_must_differ());return}j(!0);try{const n={newPwd:s.newPassword,oldPwd:s.oldPassword};r.verifyPassEmail&&!r.usePhone&&(n.email=(a==null?void 0:a.email)??"",n.otp=s.otp),r.verifyPassPhone&&r.usePhone&&(n.phone=(a==null?void 0:a.phone)??"",n.otp=s.otp),await z(n),A(!0)}catch(n){const w=((d=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:d.message)??"";m.showToast(w.trim())}finally{j(!1)}},L=()=>{m.navigate(p.isPhone?h.changePhone:h.changeEmail)},B=()=>{m.navigate(h.security),_({...p,open:!1})};return l.useEffect(()=>{if(i.phoneFundPassword||i.emailFundPassword){_({open:!0,isPhone:i.phoneFundPassword});return}_({open:!1,isPhone:i.phoneFundPassword})},[i]),l.useEffect(()=>{N()},[s.oldPassword,s.newPassword,s.newPasswordConfirm,s.otp]),k?e.jsx(X,{msg:o.login_password_has_been_changed(),onClick:()=>m.navigate(h.home)}):e.jsxs(e.Fragment,{children:[r.verifyOldPass&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.old_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 ",children:[e.jsx("input",{type:c.oldPassword?"text":"password",id:"oldPassword",name:"oldPassword",value:s.oldPassword,onChange:f,autoComplete:"off",placeholder:o.enter_login_pass_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(P,{name:c.oldPassword?"ic_eye_open":"ic_eye_close",onClick:()=>g("oldPassword"),color:"#444449",className:"w-4 h-4"})]}),u&&s.errors.oldPassword&&e.jsx("p",{className:"error",children:s.errors.oldPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.new_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 ",children:[e.jsx("input",{type:c.newPassword?"text":"password",id:"newPassword",name:"newPassword",value:s.newPassword,onChange:f,autoComplete:"off",placeholder:o.enter_new_passowrd_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(P,{name:c.newPassword?"ic_eye_open":"ic_eye_close",onClick:()=>g("newPassword"),color:"#444449",className:"w-4 h-4"})]}),u&&s.errors.newPassword&&e.jsx("p",{className:"error",children:s.errors.newPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.confirm_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 ",children:[e.jsx("input",{type:c.newPasswordConfirm?"text":"password",id:"newPasswordConfirm",name:"newPasswordConfirm",value:s.newPasswordConfirm,onChange:f,autoComplete:"off",placeholder:o.enter_new_passowrd_hint_again(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(P,{name:c.newPasswordConfirm?"ic_eye_open":"ic_eye_close",onClick:()=>g("newPasswordConfirm"),color:"#444449",className:"w-4 h-4"})]}),u&&s.errors.newPasswordConfirm&&e.jsx("p",{className:"error",children:s.errors.newPasswordConfirm})]}),r.canUsePassOtp&&(r.verifyPassEmail||r.verifyPassPhone)&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",r.usePhone?o.sms_verification_code():o.email_verification_code()]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[#b1f600] pl-2",children:[" ",r.usePhone?$((a==null?void 0:a.phone)??""):U((a==null?void 0:a.email)??"")]}),r.showSwitch&&e.jsxs("span",{className:"flex items-center justify-center text-sm gap-2",onClick:()=>E({...r,usePhone:!r.usePhone}),children:[e.jsx(P,{color:"#bbbbbb",name:"ic_change",className:"w-4 h-3"}),e.jsx("span",{className:"text-label",children:r.usePhone?"E-mail":o.phone_number()})]})]}),e.jsxs("div",{className:"w-full rounded-md px-3 py-2.5 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",value:s.otp,name:"otp",id:"otp",autoComplete:"off",onChange:f,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:M,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:x>0?`${o.resend()}(${x})`:o.get_a_verification_code()})]})]}),e.jsx(J,{title:o.confirm(),onClick:H,className:"mt-9 uppercase",disable:F,useDisableStyle:!T}),e.jsx(Z,{content:"",onClose:B,onConfirm:L,open:p.open,children:e.jsxs("div",{children:[e.jsx("p",{className:"text-center pt-3",children:p.isPhone?o.bind_phone_confirm_title():o.bind_email_confirm_title()}),e.jsx("p",{className:"text-center pt-2 text-[var(--text-content-color)] text-xs",children:p.isPhone?o.bind_phone_confirm_title_content():o.bind_email_confirm_title_content()})]})})]})}export{he as ChangePasswordView};
