import{R as A,v as F,r as s,j as a,N as T,T as r,H as c,M as i,C as E,aR as O,aa as d,F as R,aS as P,aT as B,aA as G,aU as H,l as U,G as V}from"./index-BRyeyo8a.js";const $={nickname:"",avatarId:1,birthday:null,gender:"",fullName:" "},L=e=>Object.assign({},$,e),q=(e,o)=>{switch(o.type){case"change":return{...e,[o.field]:o.value};case"reset":return o.payload;default:return e}};function J(){var k,w;const{userInfo:e}=A(F),[o,g]=s.useState(!1),[p,y]=s.useState(!1),[_,N]=s.useState(!1),[t,m]=s.useReducer(q,L({avatarId:(e==null?void 0:e.avatarId)||1,birthday:e!=null&&e.birthday?new Date(e.birthday):null,gender:(e==null?void 0:e.gender)||"",fullName:(e==null?void 0:e.fullName)||"",nickname:(e==null?void 0:e.nickname)||""})),[f,v]=s.useState(!1),h=n=>{const{name:x,value:l}=n.target;m({type:"change",field:x,value:l})},u=n=>{n&&m({type:"change",field:"birthday",value:n})},C=n=>{m({type:"change",field:"avatarId",value:n})},D=()=>{v(!0)},j=()=>t.nickname&&t.nickname.length>15?!1:t.avatarId!=(e==null?void 0:e.avatarId)||t.gender!=((e==null?void 0:e.gender)||"")||t.fullName!=((e==null?void 0:e.fullName)||"")||t.nickname!=((e==null?void 0:e.nickname)||"")||!!t.birthday&&d(t.birthday??"").format("YYYY-MM-DD")!="Invalid Date"&&d(t.birthday??"").format("YYYY-MM-DD")!=((e==null?void 0:e.birthday)||""),S=()=>{y(j())},b=async()=>{var n,x;if(j())try{const l={};if(t.avatarId!=(e==null?void 0:e.avatarId)&&(l.avatarId=t.avatarId),t.birthday&&d(t.birthday).format("YYYY-MM-DD")!=(e==null?void 0:e.birthday)&&(l.birthday=d(t.birthday).format("YYYY-MM-DD")),t.gender!=(e==null?void 0:e.gender)&&(l.gender=t.gender),t.fullName!=(e==null?void 0:e.fullName)&&(l.fullName=t.fullName),t.nickname!=(e==null?void 0:e.nickname)&&(l.nickname=t.nickname),Object.keys(l).length==0)return;await H(l),U.emit(V.refreshUserInfo),c.showToast(r.save_successfully()),y(!1)}catch(l){c.showToast(((x=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:x.message)??"")}},Y=()=>{if(p){N(!0);return}c.navigate(-1)},M=async()=>{await b(),c.navigate(-1)};return s.useEffect(()=>{e!=null&&e.account&&S()},[t.avatarId,t.birthday,t.gender,t.nickname,t.fullName]),s.useEffect(()=>{m({type:"reset",payload:{avatarId:(e==null?void 0:e.avatarId)||1,birthday:e!=null&&e.birthday?new Date(e.birthday):null,gender:(e==null?void 0:e.gender)||"",fullName:(e==null?void 0:e.fullName)||"",nickname:(e==null?void 0:e.nickname)||""}})},[e]),a.jsx(T,{title:r.personal_information(),className:"max-w-[800px] mx-auto ",rightEl:a.jsx("span",{onClick:b,className:`text-sm ${p?"text-[#adf100]":"text-[var(--arrow-color)]"}`,children:r.save()}),onBack:Y,children:a.jsxs("div",{className:" p-3 overflow-hidden overflow-y-auto hide-scrollbar h-full text-support",children:[a.jsxs("div",{className:"bg-[var(--box-bg)] rounded-md ",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.username()}),a.jsx("span",{onClick:()=>c.copy((e==null?void 0:e.account)??""),className:"font-light",children:e==null?void 0:e.account}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_copy",className:"w-3 h-3 opacity-80",onClick:()=>c.copy((e==null?void 0:e.account)??"")})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"text-[var(--text-color)]",children:r.avatar()}),a.jsxs("div",{className:"pl-10 flex items-center gap-3",onClick:()=>g(!0),children:[a.jsx(E,{src:(k=O.find(n=>n.id==t.avatarId))==null?void 0:k.value,alt:"",className:"w-11 circle"}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.full_name()}),a.jsx("input",{id:"fullName",name:"fullName",className:"font-light outline-none border-none bg-transparent text-right placeholder:text-[var(--text-content-color)] placeholder:text-sm",value:t.fullName,onChange:h,disabled:!!(e!=null&&e.fullName),placeholder:r.enter_your_real_name()}),a.jsx(i,{color:"var(--text-content-color)",onClick:e!=null&&e.fullName?()=>c.copy((e==null?void 0:e.fullName)??""):void 0,name:e!=null&&e.fullName?"ic_copy":"ic_chevon_right",className:"w-3 h-3 opacity-80"})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.register_time()}),a.jsx("input",{className:"font-light outline-none border-none bg-transparent text-right",disabled:!0,value:e==null?void 0:e.addTime}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]}),a.jsxs("div",{className:"p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsxs("div",{className:"flex items-center gap-3 ",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.nickname()}),a.jsx("input",{id:"nickname",name:"nickname",className:"font-light outline-none border-none bg-transparent text-right placeholder:text-[var(--text-content-color)] placeholder:text-sm",value:t.nickname,onChange:h,placeholder:r.enter_nickname_hint()}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]}),t.nickname&&((w=t.nickname)==null?void 0:w.length)>15?a.jsx("p",{className:"error",children:r.nick_name_rule_hint()}):a.jsx(a.Fragment,{})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:"ID"}),a.jsx("span",{className:"font-light",onClick:()=>{var n;return c.copy(((n=e==null?void 0:e.userId)==null?void 0:n.toString())??"")},children:e==null?void 0:e.userId}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_copy",className:"w-3 h-3 opacity-80",onClick:()=>{var n;return c.copy(((n=e==null?void 0:e.userId)==null?void 0:n.toString())??"")}})]})]}),a.jsxs("div",{className:"bg-[var(--box-bg)] rounded-md mt-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.birthday()}),a.jsxs("div",{className:"flex items-center justify-center gap-3 max-w-[80%]",onClick:D,children:[a.jsx("div",{className:`overflow-hidden overflow-ellipsis text-nowrap ${t.birthday?"":"text-[var(--text-content-color)] text-sm"}`,children:t.birthday?d(t.birthday).format("YYYY/MM/DD"):r.complete_birthday_information()}),a.jsx(i,{color:"var(--text-content-color)",name:"ic_chevon_right",className:"w-3 h-3 opacity-80"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-b-[var(--bottomsheet-separator)]",children:[a.jsx("span",{className:"grow text-[var(--text-color)]",children:r.gender()}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{htmlFor:"gender_man",children:r.man()}),a.jsx("input",{id:"gender_man",type:"radio",name:"gender",value:"M",checked:t.gender=="M",onChange:h}),a.jsx("label",{htmlFor:"gender_woman",className:"ml-3",children:r.woman()}),a.jsx("input",{id:"gender_woman",type:"radio",name:"gender",value:"F",checked:t.gender=="F",onChange:h})]})]})]}),a.jsx(R,{title:r.save(),onClick:b,className:"hidden pc:block mt-5",useDisableStyle:!p}),a.jsx(P,{onChange:C,onClose:()=>g(!1),open:o}),a.jsx(B,{isOpen:f,initialDate:t.birthday?d(t.birthday).toDate():void 0,onCancel:()=>v(!1),onConfirm:n=>{v(!1),u(n)},maxDate:new Date}),a.jsx(G,{content:r.do_you_want_to_save_change(),onClose:()=>N(!1),onCancel:()=>c.navigate(-1),onConfirm:M,open:_,cancelText:r.no(),confirmText:r.yes()})]})})}export{J as PersonalInfoView};
