import{r as i,j as e,N as V,T as l,H as x,f as L,F as k,R as H,v as U,az as P,aO as R,aK as z,l as D,G,aD as K,aE as C,aC as T,aM as B,aP as W,aN as Y}from"./index-BRyeyo8a.js";import{a as $}from"./sucess-view-Cd-dyNf2.js";const J={email:"",otp:"",errors:{email:"",otp:""}},Q=(a,m)=>{switch(m.type){case"change":return a.errors[m.field]="",{...a,[m.field]:m.value};default:return a}};function ae(){const[a,m]=i.useState(!1),[w,v]=i.useState(!1),[s,t]=i.useReducer(Q,J),[O,F]=i.useState(!1),[_,f]=i.useState(0),[g,h]=i.useState(!1),E=i.useRef(null),S=d=>{const{name:p,value:o}=d.target;v(!1),t({type:"change",field:p,value:o})},j=()=>{s.errors={email:"",otp:""},R.test(s.email)||(s.errors.email=l.email_is_invalid()),s.otp||(s.errors.otp=l.otp_is_required());const d=!Object.values(s.errors).some(p=>p!="");return F(d),d},y=async()=>{var d,p;if(!j()){v(!0);return}m(!0);try{await z({newEmail:s.email,oldEmail:"",newOtp:s.otp,oldOtp:""}),h(!0),D.emit(G.refreshUserInfo)}catch(o){const N=((p=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:p.message)??"";x.showToast(N.replace(s.email,"").trim())}finally{m(!1)}},b=async()=>{var d,p;if(!(_>0)){if(!R.test(s.email)){s.errors.email=l.email_is_invalid(),v(!0);return}try{await K({authenType:C.EMAIL,authenValue:s.email,otpType:T.ADD});let o=60;f(o),E.current=setInterval(()=>{f(--o),o<=0&&clearInterval(E.current)},1e3)}catch(o){const N=((p=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:p.message)??"";x.showToast(N.replace(s.email,"").trim())}}};return i.useEffect(()=>()=>{clearInterval(E.current)},[]),i.useEffect(()=>{j()},[s.email,s.otp]),g?e.jsx(V,{title:"Email",className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt  overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx($,{msg:l.email_has_been_bond(),onClick:()=>x.navigate(L.home),title:s.email.substring(0,4)+"***"+s.email.substring(s.email.indexOf("@"))})})}):e.jsx(V,{title:"Email",className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"oldPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",l.email_address()]}),e.jsx("input",{type:"text",name:"email",id:"email",value:s.email,onChange:S,placeholder:l.enter_email_hint(),className:"security w-full rounded-md px-3 h-11 mt-1 outline-none border bg-[#1b1b1e] border-[#333239] placeholder:text-xs placeholder:text-[#393a3e] text-white font-bold input-add-email"}),w&&s.errors.email&&e.jsx("p",{className:"error",children:s.errors.email})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",l.email_verification_code()]}),e.jsxs("div",{className:"w-full rounded-md px-3 h-11 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between input-add-email-box",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:s.otp,onChange:S,className:"security border-none outline-none grow bg-transparent input-add-email-2"}),e.jsx("span",{onClick:b,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:_>0?`${l.resend()}(${_})`:l.get_a_verification_code()})]}),w&&s.errors.otp&&e.jsx("p",{className:"error",children:s.errors.otp})]}),e.jsx(k,{title:l.confirm(),onClick:y,className:"mt-9 uppercase",disable:a,useDisableStyle:!O})]})})}const X={newEmail:"",newOtp:"",oldOtp:"",verifyKey:"",errors:{newEmail:"",newOtp:"",oldOtp:""}},Z=(a,m)=>{switch(m.type){case"change":return a.errors[m.field]="",{...a,[m.field]:m.value};default:return a}};function te(){const{userInfo:a}=H(U),[m,w]=i.useState(!1),[v,s]=i.useState(!1),[t,O]=i.useReducer(Z,X),[F,_]=i.useState(!1),[f,g]=i.useState(0),[h,E]=i.useState(1),[S,j]=i.useState(!1),y=(a==null?void 0:a.verifyEmail)==0,b=i.useRef(null),d=n=>{const{name:c,value:r}=n.target;s(!1),O({type:"change",field:c,value:r})},p=()=>{t.errors={newEmail:"",newOtp:"",oldOtp:""},h==1?t.oldOtp||(t.errors.oldOtp=l.otp_is_required()):(R.test(t.newEmail)||(t.errors.newEmail=l.email_is_invalid()),t.newEmail==(a==null?void 0:a.email)&&(t.errors.newEmail=l.new_email_must_differ_from_cur()),t.newOtp||(t.errors.newOtp=l.otp_is_required()));const n=!Object.values(t.errors).some(c=>c!="");return _(n),n},o=async()=>{var n,c;if(!p()){s(!0);return}w(!0);try{await B({authenType:C.EMAIL,authenValue:t.newEmail,otp:t.newOtp,verifyKey:t.verifyKey}),j(!0),D.emit(G.refreshUserInfo)}catch(r){const u=((c=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:c.message)??"";x.showToast(u.replace(a==null?void 0:a.email,"").replace(t.newEmail,"").trim())}finally{w(!1)}},N=async()=>{var n,c;if(!t.oldOtp){t.errors.oldOtp=l.otp_is_required(),s(!0);return}w(!0);try{await W({email:(a==null?void 0:a.email)??"",phone:"",otp:t.oldOtp}),j(!0)}catch(r){const u=((c=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:c.message)??"";x.showToast(u.replace((a==null?void 0:a.email)||"","").trim())}finally{w(!1)}},M=async()=>{var n,c;if(!p()){s(!0);return}try{const{verifyKey:r}=await Y({authenType:C.EMAIL,authenValue:a==null?void 0:a.email,otp:t.oldOtp});O({type:"change",field:"verifyKey",value:r}),_(!1),g(0),clearInterval(b.current),E(2)}catch(r){const u=((c=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:c.message)??"";x.showToast(u.replace(a==null?void 0:a.email,"").trim())}},A=async()=>{var n,c;if(!(f>0)){if(t.errors={newEmail:"",newOtp:"",oldOtp:""},h==2){if(!R.test(t.newEmail)){t.errors.newEmail=l.email_is_invalid(),s(!0);return}if(t.newEmail==(a==null?void 0:a.email)){t.errors.newEmail=l.new_email_must_differ_from_cur(),s(!0);return}}try{let r=T.VERIFY;y||(h==1?r=T.CHANGE_OLD:r=T.CHANGE_NEW),await K({authenType:C.EMAIL,authenValue:h==1?a==null?void 0:a.email:t.newEmail,otpType:r});let u=60;g(u),b.current=setInterval(()=>{g(--u),u<=0&&clearInterval(b.current)},1e3)}catch(r){const u=((c=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:c.message)??"";x.showToast(u.replace(t.newEmail,"").replace((a==null?void 0:a.email)??"","").trim())}}},q=()=>{if(y){N();return}if(h==1){M();return}o()};return i.useEffect(()=>()=>{clearInterval(b.current)},[]),i.useEffect(()=>{p()},[t.newEmail,t.newOtp,t.oldOtp]),S?e.jsx(V,{title:"Email",className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt  overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx($,{msg:y?l.email_has_been_verified():l.email_has_been_bond(),onClick:()=>x.navigate(L.home),title:P(t.newEmail||(a==null?void 0:a.email))})})}):e.jsx(V,{title:"Email",className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 pt  overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[h==1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-md flex flex-col items-center justify-center py-14 bg-[var(--box-bg)]",children:[e.jsx("div",{className:"text-3xl font-semibold",children:P((a==null?void 0:a.email)??"")}),e.jsx("div",{className:"text-[var(--text-content-color)] mt-2",children:l.your_current_email_address()})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",l.email_verification_code()]}),e.jsxs("div",{className:"w-full input-all input-all__border px-3 h-11 mt-1 flex items-center justify-between input-login-register",children:[e.jsx("input",{type:"text",id:"oldOtp",name:"oldOtp",value:t.oldOtp,onChange:d,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:A,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:f>0?`${l.resend()}(${f})`:l.get_a_verification_code()})]}),v&&t.errors.oldOtp&&e.jsx("p",{className:"error",children:t.errors.oldOtp})]})]}),h==2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"newEmail",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",l.new_email_address()]}),e.jsx("input",{type:"text",name:"newEmail",id:"newEmail",value:t.newEmail,onChange:d,placeholder:l.enter_email_hint(),className:"security w-full input-all input-all__border px-3 h-11 mt-1 font-bold"}),v&&t.errors.newEmail&&e.jsx("p",{className:"error",children:t.errors.newEmail})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",l.email_verification_code()]}),e.jsxs("div",{className:"w-full input-all input-all__border px-3 h-11 mt-1 flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"newOtp",name:"newOtp",value:t.newOtp,onChange:d,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:A,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:f>0?`${l.resend()}(${f})`:l.get_a_verification_code()})]}),v&&t.errors.newOtp&&e.jsx("p",{className:"error",children:t.errors.newOtp})]})]}),e.jsx(k,{title:h==1&&!y?l.next_step():l.confirm(),onClick:q,className:"mt-9 uppercase",disable:m,useDisableStyle:!F})]})})}export{ae as AddEmail,te as ChangeEmail};
