import{r as u,ad as T,H as g,ae as Ce,j as e,T as l,C as I,Z as se,W as pe,a7 as $,af as Se,l as Ne,G as ge,E as _e,ag as y,u as Ie,S as ke,R as Le,ah as me,ai as Ee,t as Me,f as fe,aj as he,ak as be,N as Ae,al as Oe,k as we,M as Q,h as Pe,d as ve,p as He,am as $e,an as Ve,c as je,ao as Ye}from"./index-BRyeyo8a.js";import{C as Be}from"./currency-selector-CI5Ibmdo.js";import{c as ze}from"./cash-back-BYrP5q_k.js";var h=(s=>(s[s.ALL=-1]="ALL",s[s.VIP=3]="VIP",s[s.BONUS=4]="BONUS",s))(h||{});const We=()=>({[y.HASH]:l.hash_cashback(),[y.CRYPTO_GAME]:l.crypto_game_cashback(),[y.FUTURE]:l.future_cashback(),[y.LIVE]:l.live_cashback(),[y.SLOTS]:l.slot_cashback(),[y.SPORTS]:l.sport_cashback(),[y.LOTTERY]:l.lottery_cashback(),[y.FISHING]:l.fish_cashback(),[y.CARD_GAME]:l.card_cashback()});function Re({item:s,handleOpenDownloadPopup:D,onSuccess:w,onFailed:k,handleOpenSuccessPopup:v,resetBonusList:G,nameMap:m,tab:K}){var P;const[j,C]=u.useState(!1),[L,V]=u.useState(!!(s!=null&&s.expiredTime&&(s!=null&&s.serverTime)&&+(s==null?void 0:s.expiredTime)<=+(s==null?void 0:s.serverTime))),[x,Y]=u.useState(s&&s.status==T.UNCLAIM&&(s!=null&&s.expiredTime)&&(s!=null&&s.serverTime)&&+(s==null?void 0:s.expiredTime)>+(s==null?void 0:s.serverTime)?s.expiredTime-s.serverTime:null),B=g.getIsMobileAppEnv(),z=g.getIsPWAEnv(),E=Ce(),M=s.androidDownloadUrl||s.iosDownloadUrl,o=K!=2&&!B&&!z&&M,A=()=>{const d=s.expiredTime||0,p=s.serverTime;let N=0;return d&&d>0&&p?N=d-p:N=0,N};u.useEffect(()=>{if(s.status==T.UNCLAIM&&(s!=null&&s.expiredTime)&&(s!=null&&s.serverTime)&&+(s==null?void 0:s.expiredTime)>+(s==null?void 0:s.serverTime)){let d=A();if(V(!1),s!=null&&s.expiredTime&&d>=0&&s.status==T.UNCLAIM){const p=setInterval(()=>{Y(d>0?d:0),d<=1e3?(V(!0),clearInterval(p)):d=d-1e3},1e3);return()=>clearInterval(p)}}},[]);const X=async()=>{if(o){D(E?s.iosDownloadUrl:s.androidDownloadUrl,s);return}r()};async function r(){var d,p,N,U,S,H,R,Z;try{C(!0);let c={};s!=null&&s.bonusId?c=await Se(s.bonusId):c=await ze({gameType:s.gameType}),(c==null?void 0:c.statusCode)==200||c!=null&&c.success?(v(s),G(),Ne.emit(ge.onClaimBonus)):((d=c==null?void 0:c.message)==null?void 0:d.length)>0||((N=(p=c==null?void 0:c.data)==null?void 0:p.message)==null?void 0:N.length)>0?g.showError((c==null?void 0:c.message)||((U=c==null?void 0:c.data)==null?void 0:U.message)):g.showError(l.no_data_at_the_moment()),w(),C(!1)}catch(c){g.showError(((H=(S=c.response)==null?void 0:S.data)==null?void 0:H.message)??c.message??""),((Z=(R=c.response)==null?void 0:R.data)==null?void 0:Z.code)=="ERROR_FAIL_BONUS"&&k(),C(!1)}}const O=d=>{const p=Math.floor(d/864e5),N=String(Math.floor(d%(1e3*60*60*24)/(1e3*60*60))).padStart(2,"0"),U=String(Math.floor(d%(1e3*60*60)/(1e3*60))).padStart(2,"0"),S=String(Math.floor(d%(1e3*60)/1e3)).padStart(2,"0");return`${p} ${l.day()} ${N}:${U}:${S}`},W=()=>{var d;return typeof s.gameType=="number"&&s.bonusClassify==h.BONUS?We()[s.gameType]:((d=m[s.name])==null?void 0:d[_e.currentLang()])??s.name};return e.jsxs("div",{className:"relative w-full mt-2 flex flex-col justify-between bg-[#242427] px-3 py-4 rounded-md bg-[var(--box-bg)] p-3",children:[o&&!L&&s.status!=T.CLAIMED&&e.jsxs("div",{className:"absolute flex justify-center items-center top-0 right-[-1px] bg-[#fcd072] px-5",style:{borderTopRightRadius:7,clipPath:"polygon(0 0, 50% 1000%, 120% 0%, 0% 0%, 0% 0)"},children:[e.jsx("span",{className:"text-sm text-black mr-2 ml-2",children:l.only_app_member()}),e.jsx(I,{src:"/assets/icon/download-app-icon.png",alt:"",className:"w-3 h-3 "})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-[#a3a3a7] flex items-baseline",children:[e.jsxs("span",{className:"text-2xl font-semibold text-[#c3fb04]",children:["+",(s==null?void 0:s.amount)||0]}),e.jsx("span",{className:"ml-2 text-base font-light text-[#b1b1b4] event-bonus-text-black",children:`(${(P=se.defaultCurrency)==null?void 0:P.currency})`})]}),e.jsx("div",{className:"text-sm text-[#959599] font-light uppercase mt-1",children:e.jsx("span",{className:"text-white text-base capitalize event-bonus-text-black",children:W()})})]}),e.jsx(Ze,{item:s,isExpired:L,handleClaimBonus:X,isLoading:j,isOnlyAppmember:o})]}),e.jsx("div",{className:"h-[1px] my-2 bg-[#343438] bg-support event-bonus-item-separate-line"}),e.jsxs("div",{className:"flex items-center justify-between text-[#b1b1b4] text-sm",children:[s.bonusClassify==3?e.jsx("span",{className:"",children:pe(new Date(s.createTime),"YYYY/MM/DD HH:mm:ss")}):s.usedTime?e.jsx("span",{className:"",children:pe(new Date(s.usedTime),"YYYY/MM/DD HH:mm:ss")}):e.jsx("span",{className:""}),s.status==T.UNCLAIM?s.expiredTime?+(s==null?void 0:s.expiredTime)>+s.serverTime&&!L?e.jsxs("div",{className:"flex justify-end items-center",children:[e.jsx(I,{src:"/assets/icon/oclock-icon.png",alt:"",className:"w-3 mr-1 event-bonus-text-black"}),e.jsxs("span",{className:"text-sm",children:[l.countdown_receive(),": "]}),e.jsx("span",{className:"ml-1 text-sm",children:x?O(x):"--"})]}):e.jsx(e.Fragment,{}):e.jsxs("div",{className:"flex justify-end items-center",children:[e.jsx(I,{src:"/assets/icon/oclock-icon.png",alt:"",className:"w-3 mr-1 event-bonus-text-black"}),e.jsx("span",{className:"text-sm",children:l.permanent()})]}):e.jsx(e.Fragment,{}),s.status==T.CLAIMED&&e.jsx("span",{children:l.bonus_has_been_sent()})]})]},s.bonusId)}function Ze({item:s,isExpired:D,handleClaimBonus:w,isLoading:k,isOnlyAppmember:v}){return s.status==T.CLAIMED?e.jsx("div",{className:"text-end flex items-center justify-end",children:e.jsx("div",{className:"bg-[#595e49] px-3 py-1 rounded-md text-sm text-[#dfefac]",children:l.received()})}):D?e.jsx("div",{className:"text-end flex items-center justify-end",children:e.jsx("div",{className:"bg-[#595e49] px-3 py-1 rounded-md text-sm text-[#dfefac]",children:l.expired()})}):e.jsx("div",{className:"text-end flex items-center justify-end",onClick:w,children:k?e.jsxs("div",{className:"bg-[#ffebd3] px-3 py-1 rounded-md text-sm text-black",children:[l.loading(),"..."]}):e.jsx("div",{className:"bg-[#b3fc00] px-3 py-1 rounded-md text-sm text-black",children:v?l.download_receive():l.receive_3()})})}function qe(){return e.jsxs("div",{className:"relative w-full mt-2 flex flex-col justify-between rounded-md bg-[var(--box-bg)] bonus-skeleton-container p-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[#a3a3a7] flex items-baseline",children:e.jsx($,{variant:"text",sx:{fontSize:"1.2rem"},className:"bonus-skeleton",width:100})}),e.jsx("div",{className:"text-sm text-[#959599] font-light uppercase mt-1",children:e.jsx($,{variant:"text",sx:{fontSize:"1rem"},className:"bonus-skeleton",width:100})})]}),e.jsx($,{variant:"rounded",className:"bonus-skeleton",height:28,width:60})]}),e.jsx("div",{className:"h-[1px] my-2 bg-[var(--box-separator)]"}),e.jsxs("div",{className:"flex items-center justify-between text-[#b1b1b4] text-sm",children:[e.jsx($,{variant:"text",sx:{fontSize:"1.2rem"},className:"bonus-skeleton",width:100}),e.jsx($,{variant:"text",sx:{fontSize:"1.2rem"},className:"bonus-skeleton",width:100})]})]})}function Ke(){var te,re,oe,le;const s=Ie(),D=new ke(s.search),[w,k]=u.useState(D.findNumber("state",0)),[v,G]=u.useState(D.findNumber("time",7)),[m,K]=u.useState(D.findNumber("type",-1)),[j,C]=u.useState(),[L,V]=u.useState(!1),[x,Y]=u.useState(),[B,z]=u.useState(""),[E,M]=u.useState({}),[o,A]=u.useState([]),X=Le(me),[r,O]=u.useState([]),{nameMap:W,totalBonusAmount:P,activityRecord:d,eventBonusList:p}=X,[N,U]=u.useState(!p),S=[l.all(),l.not_collected(),l.received(),l.expired()],H=Ee(),R=u.useRef(null),Z=Me(me),c=t=>{t!=v&&(q(t),G(t))},ae=t=>{t!=m&&K(t)};u.useEffect(()=>{Z({nameMap:E,totalBonusAmount:j,activityRecord:o,eventBonusList:r})},[E,j,o,r]);const ne=u.useMemo(()=>{const t=[{type:-1,name:l.all()},{type:h.VIP,name:l.vip()}];return w!=3&&t.push({type:h.BONUS,name:l.cash_back()}),t},[w]),ye=t=>{k(t),m==h.BONUS&&t==3&&ae(h.ALL)},F=async(t=!1)=>{if(!t&&j)return;const f=await Ve({status:2});C(f)},Te=()=>{he().then(t=>M(t)),F(!0),be().then(t=>A(t)),q()},q=async(t=v)=>{U(!0);const f=new Date;f.setHours(23,59,59,999);const b=new Date(f);b.setDate(f.getDate()-t+1),b.setHours(0,0,0,0);const J={endDate:je(f),startDate:je(b)},_=await Ye(J);O(_==null?void 0:_.data),setTimeout(()=>{U(!1)},200)},De=u.useCallback(t=>{O(f=>f.map(b=>b.bonusId==t||!b.bonusId&&b.gameType==t?{...b,status:T.CLAIMED}:b))},[]);u.useEffect(()=>{g.navigate(`${fe.eventBonus}?state=${w}&time=${v}&type=${m}`,{replace:!0})},[m,v,w]);const Ue=t=>{Y(t)};u.useEffect(()=>{W?M(W):he().then(t=>M(t)),P?C(P):F(!0),d?A(d):be().then(t=>A(t)),p?O(p):q()},[]);const ee=()=>{var t,f,b,J,_,ce,de,ie,ue,xe;if(!(r!=null&&r.length))return[];switch(w){case 0:default:switch(m){case-1:default:return r==null?void 0:r.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.VIP:return(t=r==null?void 0:r.filter(n=>n.bonusClassify==3))==null?void 0:t.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.BONUS:return(f=r==null?void 0:r.filter(n=>n.bonusClassify==4))==null?void 0:f.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}})}case 1:switch(m){case-1:default:return(b=r==null?void 0:r.filter(n=>n.status==1&&(n.serverTime<n.expiredTime&&n.expiredTime||!n.expiredTime)))==null?void 0:b.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.VIP:return(J=r==null?void 0:r.filter(n=>n.status==1&&n.bonusClassify==3&&(n.serverTime<n.expiredTime&&n.expiredTime||!n.expiredTime)))==null?void 0:J.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.BONUS:return(_=r==null?void 0:r.filter(n=>n.status==1&&n.bonusClassify==4))==null?void 0:_.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}})}case 2:switch(m){case-1:default:return(ce=r==null?void 0:r.filter(n=>n.status==2))==null?void 0:ce.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.VIP:return(de=r==null?void 0:r.filter(n=>n.status==2&&n.bonusClassify==3))==null?void 0:de.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.BONUS:return(ie=r==null?void 0:r.filter(n=>n.status==2&&n.bonusClassify==4))==null?void 0:ie.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}})}case 3:switch(m){case-1:default:return(ue=r==null?void 0:r.filter(n=>n.serverTime>=n.expiredTime&&n.expiredTime&&n.status==1))==null?void 0:ue.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}});case h.VIP:return(xe=r==null?void 0:r.filter(n=>n.serverTime>=n.expiredTime&&n.expiredTime&&n.bonusClassify==3&&n.status==1))==null?void 0:xe.map(n=>{const a=o==null?void 0:o.find(i=>i.id==n.activityId);return{...n,androidDownloadUrl:a==null?void 0:a.androidDownloadUrl,iosDownloadUrl:a==null?void 0:a.iosDownloadUrl}})}}};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:l.event_bonus(),className:"max-w-[800px] mx-auto",onBack:()=>g.navigate(-1),enableMenu:!1,hideRightEl:!0,tabEl:e.jsxs("div",{children:[e.jsx(Oe,{onChange:ye,selected:w,tabs:S,className:"px-2 sticky top-0 gap-2",itemClassName:"fundings-tab",selectedItemClassName:"tab-active"}),e.jsxs("div",{className:"p-3 flex gap-3",children:[e.jsx(we,{actionELClassName:"w-1/2",className:"anchor-arrow-top-right",actionEL:e.jsxs("button",{className:"rounded-full px-3 py-1 border border-[var(--box-separator)] w-full flex items-center justify-between",style:{backgroundImage:"var(--selector-bg)"},children:[e.jsx("span",{className:"text-[var(--text-content-color)] capitalize",children:(te=ne.find(t=>t.type==m))==null?void 0:te.name}),e.jsx(Q,{color:"var(--text-content-color)",name:"ic_arrow_down",className:"w-3 h-3"})]}),children:ne.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 min-",onClick:()=>ae(t.type),children:[e.jsx("span",{className:`${t.type==m?"text-[var(--active)] font-semibold":""} capitalize`,children:t.name}),t.type==m&&e.jsx(Q,{color:"var(--active)",name:"ic_tick",className:"w-5 h-5"})]},t.name))}),e.jsx(we,{actionELClassName:"w-1/2",className:"anchor-arrow-top-right",actionEL:e.jsxs("button",{className:"rounded-full px-3 py-1 border border-[var(--box-separator)] w-full flex items-center justify-between",style:{backgroundImage:"var(--selector-bg)"},children:[e.jsx("span",{className:"text-[var(--text-content-color)]",children:(re=H.find(t=>t.value==v))==null?void 0:re.name}),e.jsx(Q,{color:"var(--text-content-color)",name:"ic_arrow_down",className:"w-3 h-3"})]}),children:H.map(t=>e.jsxs("div",{onClick:()=>c(t.value),className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:`${t.value==v?"text-[var(--active)] font-semibold":""}`,children:t.name}),t.value==v&&e.jsx(Q,{color:"var(--active)",name:"ic_tick",className:"w-5 h-5"})]},t.name))})]})]}),children:e.jsxs("div",{className:"relative",children:[N&&e.jsx("div",{className:"px-3",children:[1,2,3,4,5,6].map(t=>e.jsx(qe,{},t))}),!N&&e.jsxs("div",{ref:R,className:"flex flex-col overflow-hidden overflow-y-auto hide-scrollbar h-full grow",children:[ee().length?"":e.jsx(Pe,{className:"grow"}),ee().length>0&&e.jsx("div",{className:"p-3 pt-0 pb-0 mt-0 flex flex-col mb-20",children:ee().map((t,f)=>e.jsx(Re,{onSuccess:()=>{De(t.bonusId||t.gameType),F(!0),Ne.emit(ge.onClaimBonus)},onFailed:q,resetBonusList:Te,handleOpenSuccessPopup:Ue,handleOpenDownloadPopup:z,item:t,nameMap:E,tab:w},t.bonusId??f))}),e.jsx(Be,{onChange:()=>{},onClose:()=>V(!1),open:L})]}),g.isPC()&&e.jsxs("div",{className:"pc:bottom-sheet-container w-[calc(100vw_-_var(--side-menu-width)_-_var(--chat-widget-max-width))] fixed bottom-5 mx-auto bg-red flex justify-center flex-wrap items-center bg-[#3e3e44] p-3 px-5 rounded-full max-w-[1024px]",children:[e.jsx("div",{className:"h-full flex justify-center items-center mr-2 mb-1",children:e.jsx(I,{src:"/assets/icon/money-bag-icon.png",alt:"",className:"w-4 h-5"})}),e.jsxs("span",{className:"text-sm text-[#aeaeb2] mr-2 event-bonus-text-black",children:[l.total_bonus_received(),":"]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-base font-semibold text-white mr-2",style:{lineHeight:"1.55rem"},children:ve((j==null?void 0:j.amount)||0)}),e.jsx("span",{className:"text-sm text-[#aeaeb2] event-bonus-text-black",children:(oe=se.defaultCurrency)==null?void 0:oe.currency})]})]})]})}),e.jsx(He,{open:!!(x!=null&&x.bonusId||Number(x==null?void 0:x.amount)>0||x!=null&&x.gameType),onClose:()=>Y(null),showTitle:!1,title:"no",className:"!m-w-[200px] !w-[80%] bg-white text-black !top-[30%] !translate-y-0 !translate-x-[-50%] flex justify-center",children:e.jsxs(e.Fragment,{children:[e.jsx(I,{src:"/assets/icon/check-big-icon.png",alt:"",className:"w-[5.2rem] h-[5.2rem] mx-auto object-contain absolute top-[-2.5rem] left-[calc(51%-2.6rem)]"}),e.jsxs("div",{className:"relative p-5 pb-2 pt-10 flex flex-col items-center justify-center gap-1",children:[e.jsxs("span",{className:"text-3xl text-[#c3fb04] font-bold",children:["+",x==null?void 0:x.amount]}),e.jsx("p",{className:"text-white text-base text-center",children:l.successfully_received()}),e.jsx("p",{className:"text-[#8e8e8e] text-center",children:l.verify_bonus_claim()}),e.jsx("p",{className:"text-[var(--active)] underline text-center",onClick:()=>g.navigate(fe.fundingHistory),children:l.please_go_check()})]})]})}),e.jsx($e,{open:B!="",onClose:()=>z(""),onDownload:()=>{var t;return(t=window.open(B,"_blank"))==null?void 0:t.focus()}}),g.isMobile()&&e.jsxs("div",{className:"fixed bottom-3 mx-auto bg-red w-[90%] flex justify-center flex-wrap items-center bg-[#3e3e44] p-3 px-5 rounded-full left-[5%] event-bonus-totalbonus-container",children:[e.jsx("div",{className:"h-full flex justify-center items-center mr-2 mb-1",children:e.jsx(I,{src:"/assets/icon/money-bag-icon.png",alt:"",className:"w-4 h-5"})}),e.jsxs("span",{className:"text-sm text-[#aeaeb2] mr-2 event-bonus-text-black",children:[l.total_bonus_received(),":"]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-base font-semibold text-white mr-2",style:{lineHeight:"1.55rem"},children:ve((j==null?void 0:j.amount)||0)}),e.jsx("span",{className:"text-sm text-[#aeaeb2] event-bonus-text-black",children:(le=se.defaultCurrency)==null?void 0:le.currency})]})]})]})}export{Ke as EventBonusContainer};
