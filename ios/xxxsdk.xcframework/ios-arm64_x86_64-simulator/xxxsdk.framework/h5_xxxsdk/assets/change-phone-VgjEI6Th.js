import{aJ as D,r as o,j as e,N as R,T as s,H as x,f as G,ay as k,F as K,R as Y,v as z,aK as $,l as L,G as U,aD as B,aE as T,aC as V,aL as Q,aM as X,aN as Z}from"./index-BRyeyo8a.js";import{a as J}from"./sucess-view-Cd-dyNf2.js";import{PhoneNumberInput2 as M}from"./phone-input-BerRZ2Es.js";const I={phone:"",otp:"",errors:{phone:"",otp:""}},ee=(u,t)=>{switch(t.type){case"change":return u.errors[t.field]="",{...u,[t.field]:t.value};default:return u}};function oe(){const{i18n:{language:u}}=D(),[t,C]=o.useState(!1),[g,f]=o.useState(!1),[r,n]=o.useReducer(ee,I),[j,F]=o.useState(!1),[b,w]=o.useState(0),[P,m]=o.useState(!1),O=o.useRef(null),q=c=>{const{name:d,value:p}=c.target;f(!1),n({type:"change",field:d,value:p})},S=c=>{c&&(f(!1),n({type:"change",field:"phone",value:c}))},y=()=>{r.errors={phone:"",otp:""},r.phone||(r.errors.phone=s.phone_is_required()),r.otp||(r.errors.otp=s.otp_is_required());const c=!Object.values(r.errors).some(d=>d!="");return F(c),c},N=async()=>{var d,p;if(!y()){f(!0);return}C(!0);const c=r.phone.replace("+","");try{await $({newPhone:c,oldPhone:"",newOtp:r.otp,oldOtp:""}),m(!0),L.emit(U.refreshUserInfo)}catch(_){const H=((p=(d=_==null?void 0:_.response)==null?void 0:d.data)==null?void 0:p.message)??"";x.showToast(H.replace(c,"").trim())}finally{C(!1)}},E=async()=>{var c,d;if(!(b>0)){if(!r.phone){r.errors.phone=s.phone_is_required(),f(!0);return}try{await B({authenType:T.PHONE,authenValue:r.phone.replace("+",""),otpType:V.ADD});let p=60;w(p),O.current=setInterval(()=>{w(--p),p<=0&&clearInterval(O.current)},1e3)}catch(p){const _=((d=(c=p==null?void 0:p.response)==null?void 0:c.data)==null?void 0:d.message)??"";x.showToast(_.replace(r.phone,"").trim())}}};return o.useEffect(()=>()=>{clearInterval(O.current)},[]),o.useEffect(()=>{y()},[r.phone,r.otp]),P?e.jsx(R,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx(J,{msg:s.successfully_change_new_phone(),onClick:()=>x.navigate(G.home),title:k(r.phone)})})}):e.jsx(R,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"oldPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.phone_number()]}),e.jsx(M,{className:"mt-2 input-all input-all__border",value:r.phone,onChange:S,placeholder:s.enter_phone_hint(),local:u}),g&&r.errors.phone&&e.jsx("p",{className:"error",children:r.errors.phone})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.get_a_verification_code()]}),e.jsxs("div",{className:"w-full input-all input-all__border px-3 h-11 mt-1 flex items-center justify-between input-login-register",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:r.otp,onChange:q,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:E,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:b>0?`${s.resend()}(${b})`:s.get_a_verification_code()})]}),g&&r.errors.otp&&e.jsx("p",{className:"error",children:r.errors.otp})]}),e.jsx(K,{title:s.confirm(),onClick:N,className:"mt-9 uppercase",disable:t,useDisableStyle:!j})]})})}const te={newPhone:"",newOtp:"",oldOtp:"",verifyKey:"",errors:{newPhone:"",newOtp:"",oldOtp:""}},ne=(u,t)=>{switch(t.type){case"change":return u.errors[t.field]="",{...u,[t.field]:t.value};default:return u}};function le(){const{i18n:{language:u}}=D(),{userInfo:t}=Y(z),[C,g]=o.useState(!1),[f,r]=o.useState(!1),[n,j]=o.useReducer(ne,te),[F,b]=o.useState(!1),[w,P]=o.useState(0),[m,O]=o.useState(1),[q,S]=o.useState(!1),y=(t==null?void 0:t.verifyPhone)==0,N=o.useRef(null),E=a=>{const{name:i,value:l}=a.target;r(!1),j({type:"change",field:i,value:l})},c=a=>{a&&(r(!1),j({type:"change",field:"newPhone",value:a}))},d=()=>{n.errors={newPhone:"",newOtp:"",oldOtp:""},m==1?n.oldOtp||(n.errors.oldOtp=s.otp_is_required()):(n.newPhone||(n.errors.newPhone=s.phone_is_required()),Q(n.newPhone)||(n.errors.newPhone=s.phone_number_invalid()),n.newPhone==(t==null?void 0:t.phone)&&(n.errors.newPhone=s.new_phone_must_differ_from_cur()),n.newOtp||(n.errors.newOtp=s.otp_is_required()));const a=!Object.values(n.errors).some(i=>i!="");return b(a),a},p=async()=>{var i,l;if(!d()){r(!0);return}g(!0);const a=n.newPhone.replace("+","");try{await $({newPhone:a,oldPhone:(t==null?void 0:t.phone)??"",newOtp:n.newOtp,oldOtp:n.oldOtp}),L.emit(U.refreshUserInfo),S(!0)}catch(h){const v=((l=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:l.message)??"";x.showToast(v.replace((t==null?void 0:t.phone)||"","").replace(a,"").trim())}finally{g(!1)}},_=async()=>{var a,i;if(!n.oldOtp){n.errors.oldOtp=s.otp_is_required(),r(!0);return}g(!0);try{await X({authenType:T.PHONE,authenValue:n.newPhone,otp:n.newOtp,verifyKey:n.verifyKey}),S(!0)}catch(l){const h=((i=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:i.message)??"";x.showToast(h.replace((t==null?void 0:t.phone)||"","").replace(n.newPhone,"").trim())}finally{g(!1)}},H=async()=>{var a,i;if(!d()){r(!0);return}try{const{verifyKey:l}=await Z({authenType:T.PHONE,authenValue:(t==null?void 0:t.phone)??"",otp:n.oldOtp});j({type:"change",field:"verifyKey",value:l}),b(!1),P(0),clearInterval(N.current),O(2)}catch(l){const h=((i=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:i.message)??"";x.showToast(h.replace((t==null?void 0:t.phone)??"","").trim())}},A=async()=>{var a,i,l;if(!(w>0)){if(n.errors={newPhone:"",newOtp:"",oldOtp:""},m==2){if(!n.newPhone){n.errors.newPhone=s.phone_is_required(),r(!0);return}if(n.newPhone==(t==null?void 0:t.phone)){n.errors.newPhone=s.new_phone_must_differ_from_cur(),r(!0);return}}try{let h=V.VERIFY;y||(m==1?h=V.CHANGE_OLD:h=V.CHANGE_NEW),await B({authenType:T.PHONE,authenValue:m==1?((a=t==null?void 0:t.phone)==null?void 0:a.replace("+",""))??"":n.newPhone.replace("+",""),otpType:h});let v=60;P(v),N.current=setInterval(()=>{P(--v),v<=0&&clearInterval(N.current)},1e3)}catch(h){const v=((l=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:l.message)??"";x.showToast(v.replace(n.newPhone,"").replace((t==null?void 0:t.phone)??"","").trim())}}},W=()=>{if(y){_();return}if(m==1){H();return}p()};return o.useEffect(()=>()=>{clearInterval(N.current)},[]),o.useEffect(()=>{d()},[n.newPhone,n.newOtp,n.oldOtp]),q?e.jsx(R,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx(J,{msg:s.successfully_change_new_phone(),onClick:()=>x.navigate(G.home),title:k(n.newPhone)})})}):e.jsx(R,{title:s.phone_number(),className:"max-w-[800px] mx-auto ",children:e.jsxs("div",{className:" p-5 pt overflow-hidden overflow-y-auto hide-scrollbar h-full",children:[m==1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-md flex flex-col items-center justify-center py-14 bg-[var(--box-bg)]",children:[e.jsx("div",{className:"text-3xl text-white font-semibold",children:k((t==null?void 0:t.phone)??"")}),e.jsx("div",{className:"text-[var(--text-content-color)] mt-2",children:s.original_mobile_phone_number()})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.sms_verification_code()]}),e.jsxs("div",{className:"w-full rounded-md px-3 h-11 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"oldOtp",name:"oldOtp",value:n.oldOtp,onChange:E,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:A,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:w>0?`${s.resend()}(${w})`:s.get_a_verification_code()})]}),f&&n.errors.oldOtp&&e.jsx("p",{className:"error",children:n.errors.oldOtp})]})]}),m==2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-label",htmlFor:"newPhone",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.new_phone_number()]}),e.jsx(M,{className:"mt-2 !border-[#333239]",value:n.newPhone,onChange:c,placeholder:s.enter_phone(),local:u}),f&&n.errors.newPhone&&e.jsx("p",{className:"error",children:n.errors.newPhone})]}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",s.sms_verification_code()]}),e.jsxs("div",{className:"w-full rounded-md px-3 h-11 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",id:"newOtp",name:"newOtp",value:n.newOtp,onChange:E,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:A,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:w>0?`${s.resend()}(${w})`:s.get_a_verification_code()})]}),f&&n.errors.newOtp&&e.jsx("p",{className:"error",children:n.errors.newOtp})]})]}),e.jsx(K,{title:m==1&&!y?s.next_step():s.confirm(),onClick:W,className:"mt-9 uppercase",disable:C,useDisableStyle:!F})]})})}export{oe as AddPhone,le as ChangePhone};
