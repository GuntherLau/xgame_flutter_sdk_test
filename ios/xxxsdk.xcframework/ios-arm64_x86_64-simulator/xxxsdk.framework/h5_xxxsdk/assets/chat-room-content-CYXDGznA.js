const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chat-menu-sSQ75ZY7.js","./index-BRyeyo8a.js","./index-jC4Kdk4u.css","./ClickAwayListener-2fbp9eZL.js"])))=>i.map(i=>d[i]);
var ar=Object.defineProperty;var ir=(t,r,o)=>r in t?ar(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;var _e=(t,r,o)=>ir(t,typeof r!="symbol"?r+"":r,o);import{cd as cr,r as x,j as u,ce as lr,cf as ur,cg as dr,ch as fr,bi as Ve,bI as nn,ci as hr,ba as mr,bb as st,bf as ct,by as Ot,bw as Pt,cj as gr,ck as pr,bx as Le,bA as St,bv as Bt,cl as Ht,cm as vr,bs as yr,cn as wt,l as at,G as it,a_ as It,c3 as Re,H as q,b1 as lt,co as we,cp as Ze,cq as et,cr as xr,cs as br,ct as Sr,cc as _t,cu as pt,cv as te,cw as ye,cx as wr,cy as Ir,cz as _r,cA as Cr,cB as Er,cC as Nr,cD as Tr,cE as kr,cF as rn,cG as Mr,cH as Rr,c4 as Ar,C as on,O as Dr,A as sn,M as Je,T as fe,cI as Ft,aY as jr,cJ as rt,p as an,cK as $t,cL as Lr,cM as Or,cN as Pr,ca as ot,R as Br,v as Hr,cO as Fr,F as $r,aA as Ur,a7 as Ut,f as Vt,cP as Vr,cQ as zt,aU as zr}from"./index-BRyeyo8a.js";import{G as Wr}from"./GlobalStyles-Dtc_kgga.js";const Oe=cr(),cn=x.createContext(null);function Ct(){return x.useContext(cn)}const Gr=typeof Symbol=="function"&&Symbol.for,Kr=Gr?Symbol.for("mui.nested"):"__THEME_NESTED__";function Yr(t,r){return typeof r=="function"?r(t):{...t,...r}}function Jr(t){const{children:r,theme:o}=t,s=Ct(),d=x.useMemo(()=>{const h=s===null?{...o}:Yr(s,o);return h!=null&&(h[Kr]=s!==null),h},[o,s]);return u.jsx(cn.Provider,{value:d,children:r})}const Wt={};function Gt(t,r,o,s=!1){return x.useMemo(()=>{const d=t&&r[t]||r;if(typeof o=="function"){const h=o(d),f=t?{...r,[t]:h}:h;return s?()=>f:f}return t?{...r,[t]:o}:{...r,...o}},[t,r,o,s])}function ln(t){const{children:r,theme:o,themeId:s}=t,d=lr(Wt),h=Ct()||Wt,f=Gt(s,d,o),y=Gt(s,h,o,!0),w=f.direction==="rtl";return u.jsx(Jr,{theme:y,children:u.jsx(ur.Provider,{value:f,children:u.jsx(dr,{value:w,children:u.jsx(fr,{value:f==null?void 0:f.components,children:r})})})})}const Et="mode",Nt="color-scheme",Qr="data-color-scheme";function Xr(t){const{defaultLightColorScheme:r="light",defaultDarkColorScheme:o="dark",modeStorageKey:s=Et,colorSchemeStorageKey:d=Nt,attribute:h=Qr,colorSchemeNode:f="document.documentElement",nonce:y}=t||{};let w="",E=h;if(h==="class"&&(E=".%s"),h==="data"&&(E="[data-%s]"),E.startsWith(".")){const p=E.substring(1);w+=`${f}.classList.remove('${p}'.replace('%s', light), '${p}'.replace('%s', dark));
      ${f}.classList.add('${p}'.replace('%s', colorScheme));`}const D=E.match(/\[([^\]]+)\]/);if(D){const[p,C]=D[1].split("=");C||(w+=`${f}.removeAttribute('${p}'.replace('%s', light));
      ${f}.removeAttribute('${p}'.replace('%s', dark));`),w+=`
      ${f}.setAttribute('${p}'.replace('%s', colorScheme), ${C?`${C}.replace('%s', colorScheme)`:'""'});`}else w+=`${f}.setAttribute('${E}', colorScheme);`;return u.jsx("script",{suppressHydrationWarning:!0,nonce:typeof window>"u"?y:"",dangerouslySetInnerHTML:{__html:`(function() {
try {
  let colorScheme = '';
  const mode = localStorage.getItem('${s}') || 'system';
  const dark = localStorage.getItem('${d}-dark') || '${o}';
  const light = localStorage.getItem('${d}-light') || '${r}';
  if (mode === 'system') {
    // handle system mode
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql.matches) {
      colorScheme = dark
    } else {
      colorScheme = light
    }
  }
  if (mode === 'light') {
    colorScheme = light;
  }
  if (mode === 'dark') {
    colorScheme = dark;
  }
  if (colorScheme) {
    ${w}
  }
} catch(e){}})();`}},"mui-color-scheme-init")}function Kt(t){if(typeof window<"u"&&typeof window.matchMedia=="function"&&t==="system")return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function un(t,r){if(t.mode==="light"||t.mode==="system"&&t.systemMode==="light")return r("light");if(t.mode==="dark"||t.mode==="system"&&t.systemMode==="dark")return r("dark")}function qr(t){return un(t,r=>{if(r==="light")return t.lightColorScheme;if(r==="dark")return t.darkColorScheme})}function vt(t,r){if(typeof window>"u")return;let o;try{o=localStorage.getItem(t)||void 0,o||localStorage.setItem(t,r)}catch{}return o||r}function Zr(t){const{defaultMode:r="light",defaultLightColorScheme:o,defaultDarkColorScheme:s,supportedColorSchemes:d=[],modeStorageKey:h=Et,colorSchemeStorageKey:f=Nt,storageWindow:y=typeof window>"u"?void 0:window}=t,w=d.join(","),E=d.length>1,[D,p]=x.useState(()=>{const N=vt(h,r),R=vt(`${f}-light`,o),g=vt(`${f}-dark`,s);return{mode:N,systemMode:Kt(N),lightColorScheme:R,darkColorScheme:g}}),[,C]=x.useState(!1),M=x.useRef(!1);x.useEffect(()=>{E&&C(!0),M.current=!0},[E]);const j=qr(D),$=x.useCallback(N=>{p(R=>{if(N===R.mode)return R;const g=N??r;try{localStorage.setItem(h,g)}catch{}return{...R,mode:g,systemMode:Kt(g)}})},[h,r]),F=x.useCallback(N=>{N?typeof N=="string"?N&&!w.includes(N)?console.error(`\`${N}\` does not exist in \`theme.colorSchemes\`.`):p(R=>{const g={...R};return un(R,A=>{try{localStorage.setItem(`${f}-${A}`,N)}catch{}A==="light"&&(g.lightColorScheme=N),A==="dark"&&(g.darkColorScheme=N)}),g}):p(R=>{const g={...R},A=N.light===null?o:N.light,T=N.dark===null?s:N.dark;if(A)if(!w.includes(A))console.error(`\`${A}\` does not exist in \`theme.colorSchemes\`.`);else{g.lightColorScheme=A;try{localStorage.setItem(`${f}-light`,A)}catch{}}if(T)if(!w.includes(T))console.error(`\`${T}\` does not exist in \`theme.colorSchemes\`.`);else{g.darkColorScheme=T;try{localStorage.setItem(`${f}-dark`,T)}catch{}}return g}):p(R=>{try{localStorage.setItem(`${f}-light`,o),localStorage.setItem(`${f}-dark`,s)}catch{}return{...R,lightColorScheme:o,darkColorScheme:s}})},[w,f,o,s]),G=x.useCallback(N=>{D.mode==="system"&&p(R=>{const g=N!=null&&N.matches?"dark":"light";return R.systemMode===g?R:{...R,systemMode:g}})},[D.mode]),H=x.useRef(G);return H.current=G,x.useEffect(()=>{if(typeof window.matchMedia!="function"||!E)return;const N=(...g)=>H.current(...g),R=window.matchMedia("(prefers-color-scheme: dark)");return R.addListener(N),N(R),()=>{R.removeListener(N)}},[E]),x.useEffect(()=>{if(y&&E){const N=R=>{const g=R.newValue;typeof R.key=="string"&&R.key.startsWith(f)&&(!g||w.match(g))&&(R.key.endsWith("light")&&F({light:g}),R.key.endsWith("dark")&&F({dark:g})),R.key===h&&(!g||["light","dark","system"].includes(g))&&$(g||r)};return y.addEventListener("storage",N),()=>{y.removeEventListener("storage",N)}}},[F,$,h,f,w,r,y,E]),{...D,mode:M.current||!E?D.mode:void 0,systemMode:M.current||!E?D.systemMode:void 0,colorScheme:M.current||!E?j:void 0,setMode:$,setColorScheme:F}}const eo="*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}";function to(t){const{themeId:r,theme:o={},modeStorageKey:s=Et,colorSchemeStorageKey:d=Nt,disableTransitionOnChange:h=!1,defaultColorScheme:f,resolveTheme:y}=t,w={allColorSchemes:[],colorScheme:void 0,darkColorScheme:void 0,lightColorScheme:void 0,mode:void 0,setColorScheme:()=>{},setMode:()=>{},systemMode:void 0},E=x.createContext(void 0),D=()=>x.useContext(E)||w;function p($){var Te,_,L,Z,me;const{children:F,theme:G,modeStorageKey:H=s,colorSchemeStorageKey:N=d,disableTransitionOnChange:R=h,storageWindow:g=typeof window>"u"?void 0:window,documentNode:A=typeof document>"u"?void 0:document,colorSchemeNode:T=typeof document>"u"?void 0:document.documentElement,disableNestedContext:O=!1,disableStyleSheetGeneration:Y=!1,defaultMode:J="system"}=$,z=x.useRef(!1),Q=Ct(),ee=x.useContext(E),le=!!ee&&!O,ie=x.useMemo(()=>G||(typeof o=="function"?o():o),[G]),U=ie[r],{colorSchemes:P={},components:se={},cssVarPrefix:xe,...ne}=U||ie,re=Object.keys(P).filter(V=>!!P[V]).join(","),ce=x.useMemo(()=>re.split(","),[re]),be=typeof f=="string"?f:f.light,Ae=typeof f=="string"?f:f.dark,ze=P[be]&&P[Ae]?J:((_=(Te=P[ne.defaultColorScheme])==null?void 0:Te.palette)==null?void 0:_.mode)||((L=ne.palette)==null?void 0:L.mode),{mode:We,setMode:Pe,systemMode:Be,lightColorScheme:He,darkColorScheme:Se,colorScheme:Ge,setColorScheme:De}=Zr({supportedColorSchemes:ce,defaultLightColorScheme:be,defaultDarkColorScheme:Ae,modeStorageKey:H,colorSchemeStorageKey:N,defaultMode:ze,storageWindow:g});let Ne=We,de=Ge;le&&(Ne=ee.mode,de=ee.colorScheme);const ge=de||ne.defaultColorScheme,Fe=((Z=ne.generateThemeVars)==null?void 0:Z.call(ne))||ne.vars,he={...ne,components:se,colorSchemes:P,cssVarPrefix:xe,vars:Fe};if(typeof he.generateSpacing=="function"&&(he.spacing=he.generateSpacing()),ge){const V=P[ge];V&&typeof V=="object"&&Object.keys(V).forEach(X=>{V[X]&&typeof V[X]=="object"?he[X]={...he[X],...V[X]}:he[X]=V[X]})}const pe=ne.colorSchemeSelector;x.useEffect(()=>{if(de&&T&&pe&&pe!=="media"){const V=pe;let X=pe;if(V==="class"&&(X=".%s"),V==="data"&&(X="[data-%s]"),V!=null&&V.startsWith("data-")&&!V.includes("%s")&&(X=`[${V}="%s"]`),X.startsWith("."))T.classList.remove(...ce.map(Ie=>X.substring(1).replace("%s",Ie))),T.classList.add(X.substring(1).replace("%s",de));else{const Ie=X.replace("%s",de).match(/\[([^\]]+)\]/);if(Ie){const[ke,$e]=Ie[1].split("=");$e||ce.forEach(Xe=>{T.removeAttribute(ke.replace(de,Xe))}),T.setAttribute(ke,$e?$e.replace(/"|'/g,""):"")}else T.setAttribute(X,de)}}},[de,pe,T,ce]),x.useEffect(()=>{let V;if(R&&z.current&&A){const X=A.createElement("style");X.appendChild(A.createTextNode(eo)),A.head.appendChild(X),window.getComputedStyle(A.body),V=setTimeout(()=>{A.head.removeChild(X)},1)}return()=>{clearTimeout(V)}},[de,R,A]),x.useEffect(()=>(z.current=!0,()=>{z.current=!1}),[]);const je=x.useMemo(()=>({allColorSchemes:ce,colorScheme:de,darkColorScheme:Se,lightColorScheme:He,mode:Ne,setColorScheme:De,setMode:Pe,systemMode:Be}),[ce,de,Se,He,Ne,De,Pe,Be]);let Ce=!0;(Y||ne.cssVariables===!1||le&&(Q==null?void 0:Q.cssVarPrefix)===xe)&&(Ce=!1);const Ee=u.jsxs(x.Fragment,{children:[u.jsx(ln,{themeId:U?r:void 0,theme:y?y(he):he,children:F}),Ce&&u.jsx(Wr,{styles:((me=he.generateStyleSheets)==null?void 0:me.call(he))||[]})]});return le?Ee:u.jsx(E.Provider,{value:je,children:Ee})}const C=typeof f=="string"?f:f.light,M=typeof f=="string"?f:f.dark;return{CssVarsProvider:p,useColorScheme:D,getInitColorSchemeScript:$=>Xr({colorSchemeStorageKey:d,defaultLightColorScheme:C,defaultDarkColorScheme:M,modeStorageKey:s,...$})}}function Yt({theme:t,...r}){const o=Ve in t?t[Ve]:void 0;return u.jsx(ln,{...r,themeId:o?Ve:void 0,theme:o||t})}const tt={attribute:"data-mui-color-scheme",colorSchemeStorageKey:"mui-color-scheme",defaultLightColorScheme:"light",defaultDarkColorScheme:"dark",modeStorageKey:"mui-mode"},{CssVarsProvider:no,useColorScheme:hs,getInitColorSchemeScript:ms}=to({themeId:Ve,theme:()=>nn({cssVariables:!0}),colorSchemeStorageKey:tt.colorSchemeStorageKey,modeStorageKey:tt.modeStorageKey,defaultColorScheme:{light:tt.defaultLightColorScheme,dark:tt.defaultDarkColorScheme},resolveTheme:t=>{const r={...t,typography:hr(t.palette,t.typography)};return r.unstable_sx=function(s){return mr({sx:s,theme:this})},r}}),ro=no;function oo({theme:t,...r}){return typeof t=="function"?u.jsx(Yt,{theme:t,...r}):"colorSchemes"in(Ve in t?t[Ve]:t)?u.jsx(ro,{theme:t,...r}):u.jsx(Yt,{theme:t,...r})}function so(t){return typeof t=="string"}function ao(t,r,o){return t===void 0||so(t)?r:{...r,ownerState:{...r.ownerState,...o}}}const io={disableDefaultClasses:!1},co=x.createContext(io);function lo(t){const{disableDefaultClasses:r}=x.useContext(co);return o=>r?"":t(o)}function dn(t,r=[]){if(t===void 0)return{};const o={};return Object.keys(t).filter(s=>s.match(/^on[A-Z]/)&&typeof t[s]=="function"&&!r.includes(s)).forEach(s=>{o[s]=t[s]}),o}function uo(t,r,o){return typeof t=="function"?t(r,o):t}function Jt(t){if(t===void 0)return{};const r={};return Object.keys(t).filter(o=>!(o.match(/^on[A-Z]/)&&typeof t[o]=="function")).forEach(o=>{r[o]=t[o]}),r}function fo(t){const{getSlotProps:r,additionalProps:o,externalSlotProps:s,externalForwardedProps:d,className:h}=t;if(!r){const M=st(o==null?void 0:o.className,h,d==null?void 0:d.className,s==null?void 0:s.className),j={...o==null?void 0:o.style,...d==null?void 0:d.style,...s==null?void 0:s.style},$={...o,...d,...s};return M.length>0&&($.className=M),Object.keys(j).length>0&&($.style=j),{props:$,internalRef:void 0}}const f=dn({...d,...s}),y=Jt(s),w=Jt(d),E=r(f),D=st(E==null?void 0:E.className,o==null?void 0:o.className,h,d==null?void 0:d.className,s==null?void 0:s.className),p={...E==null?void 0:E.style,...o==null?void 0:o.style,...d==null?void 0:d.style,...s==null?void 0:s.style},C={...E,...o,...w,...y};return D.length>0&&(C.className=D),Object.keys(p).length>0&&(C.style=p),{props:C,internalRef:E.ref}}function Qt(t){var p;const{elementType:r,externalSlotProps:o,ownerState:s,skipResolvingSlotProps:d=!1,...h}=t,f=d?{}:uo(o,s),{props:y,internalRef:w}=fo({...h,externalSlotProps:f}),E=ct(w,f==null?void 0:f.ref,(p=t.additionalProps)==null?void 0:p.ref);return ao(r,{...y,ref:E},s)}function ho(t){return typeof t=="function"?t():t}const mo=x.forwardRef(function(r,o){const{children:s,container:d,disablePortal:h=!1}=r,[f,y]=x.useState(null),w=ct(x.isValidElement(s)?s.ref:null,o);if(Ot(()=>{h||y(ho(d)||document.body)},[d,h]),Ot(()=>{if(f&&!h)return Pt(o,f),()=>{Pt(o,null)}},[o,f,h]),h){if(x.isValidElement(s)){const E={ref:w};return x.cloneElement(s,E)}return u.jsx(x.Fragment,{children:s})}return u.jsx(x.Fragment,{children:f&&gr.createPortal(s,f)})});function go(t){const r=Le(t);return r.body===t?St(t).innerWidth>r.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function Qe(t,r){r?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function Xt(t){return parseInt(St(t).getComputedStyle(t).paddingRight,10)||0}function po(t){const o=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(t.tagName)!==-1,s=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return o||s}function qt(t,r,o,s,d){const h=[r,o,...s];[].forEach.call(t.children,f=>{const y=h.indexOf(f)===-1,w=!po(f);y&&w&&Qe(f,d)})}function yt(t,r){let o=-1;return t.some((s,d)=>r(s)?(o=d,!0):!1),o}function vo(t,r){const o=[],s=t.container;if(!r.disableScrollLock){if(go(s)){const f=pr(Le(s));o.push({value:s.style.paddingRight,property:"padding-right",el:s}),s.style.paddingRight=`${Xt(s)+f}px`;const y=Le(s).querySelectorAll(".mui-fixed");[].forEach.call(y,w=>{o.push({value:w.style.paddingRight,property:"padding-right",el:w}),w.style.paddingRight=`${Xt(w)+f}px`})}let h;if(s.parentNode instanceof DocumentFragment)h=Le(s).body;else{const f=s.parentElement,y=St(s);h=(f==null?void 0:f.nodeName)==="HTML"&&y.getComputedStyle(f).overflowY==="scroll"?f:s}o.push({value:h.style.overflow,property:"overflow",el:h},{value:h.style.overflowX,property:"overflow-x",el:h},{value:h.style.overflowY,property:"overflow-y",el:h}),h.style.overflow="hidden"}return()=>{o.forEach(({value:h,el:f,property:y})=>{h?f.style.setProperty(y,h):f.style.removeProperty(y)})}}function yo(t){const r=[];return[].forEach.call(t.children,o=>{o.getAttribute("aria-hidden")==="true"&&r.push(o)}),r}class xo{constructor(){this.modals=[],this.containers=[]}add(r,o){let s=this.modals.indexOf(r);if(s!==-1)return s;s=this.modals.length,this.modals.push(r),r.modalRef&&Qe(r.modalRef,!1);const d=yo(o);qt(o,r.mount,r.modalRef,d,!0);const h=yt(this.containers,f=>f.container===o);return h!==-1?(this.containers[h].modals.push(r),s):(this.containers.push({modals:[r],container:o,restore:null,hiddenSiblings:d}),s)}mount(r,o){const s=yt(this.containers,h=>h.modals.indexOf(r)!==-1),d=this.containers[s];d.restore||(d.restore=vo(d,o))}remove(r,o=!0){const s=this.modals.indexOf(r);if(s===-1)return s;const d=yt(this.containers,f=>f.modals.indexOf(r)!==-1),h=this.containers[d];if(h.modals.splice(h.modals.indexOf(r),1),this.modals.splice(s,1),h.modals.length===0)h.restore&&h.restore(),r.modalRef&&Qe(r.modalRef,o),qt(h.container,r.mount,r.modalRef,h.hiddenSiblings,!1),this.containers.splice(d,1);else{const f=h.modals[h.modals.length-1];f.modalRef&&Qe(f.modalRef,!1)}return s}isTopModal(r){return this.modals.length>0&&this.modals[this.modals.length-1]===r}}function bo(t){return typeof t=="function"?t():t}function So(t){return t?t.props.hasOwnProperty("in"):!1}const wo=new xo;function Io(t){const{container:r,disableEscapeKeyDown:o=!1,disableScrollLock:s=!1,manager:d=wo,closeAfterTransition:h=!1,onTransitionEnter:f,onTransitionExited:y,children:w,onClose:E,open:D,rootRef:p}=t,C=x.useRef({}),M=x.useRef(null),j=x.useRef(null),$=ct(j,p),[F,G]=x.useState(!D),H=So(w);let N=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(N=!1);const R=()=>Le(M.current),g=()=>(C.current.modalRef=j.current,C.current.mount=M.current,C.current),A=()=>{d.mount(g(),{disableScrollLock:s}),j.current&&(j.current.scrollTop=0)},T=Bt(()=>{const U=bo(r)||R().body;d.add(g(),U),j.current&&A()}),O=x.useCallback(()=>d.isTopModal(g()),[d]),Y=Bt(U=>{M.current=U,U&&(D&&O()?A():j.current&&Qe(j.current,N))}),J=x.useCallback(()=>{d.remove(g(),N)},[N,d]);x.useEffect(()=>()=>{J()},[J]),x.useEffect(()=>{D?T():(!H||!h)&&J()},[D,J,H,h,T]);const z=U=>P=>{var se;(se=U.onKeyDown)==null||se.call(U,P),!(P.key!=="Escape"||P.which===229||!O())&&(o||(P.stopPropagation(),E&&E(P,"escapeKeyDown")))},Q=U=>P=>{var se;(se=U.onClick)==null||se.call(U,P),P.target===P.currentTarget&&E&&E(P,"backdropClick")};return{getRootProps:(U={})=>{const P=dn(t);delete P.onTransitionEnter,delete P.onTransitionExited;const se={...P,...U};return{role:"presentation",...se,onKeyDown:z(se),ref:$}},getBackdropProps:(U={})=>{const P=U;return{"aria-hidden":!0,...P,onClick:Q(P),open:D}},getTransitionProps:()=>{const U=()=>{G(!1),f&&f()},P=()=>{G(!0),y&&y(),h&&J()};return{onEnter:Ht(U,w==null?void 0:w.props.onEnter),onExited:Ht(P,w==null?void 0:w.props.onExited)}},rootRef:$,portalRef:Y,isTopModal:O,exited:F,hasTransition:H}}const _o=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Co(t){const r=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(r)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:r}function Eo(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const r=s=>t.ownerDocument.querySelector(`input[type="radio"]${s}`);let o=r(`[name="${t.name}"]:checked`);return o||(o=r(`[name="${t.name}"]`)),o!==t}function No(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||Eo(t))}function To(t){const r=[],o=[];return Array.from(t.querySelectorAll(_o)).forEach((s,d)=>{const h=Co(s);h===-1||!No(s)||(h===0?r.push(s):o.push({documentOrder:d,tabIndex:h,node:s}))}),o.sort((s,d)=>s.tabIndex===d.tabIndex?s.documentOrder-d.documentOrder:s.tabIndex-d.tabIndex).map(s=>s.node).concat(r)}function ko(){return!0}function Mo(t){const{children:r,disableAutoFocus:o=!1,disableEnforceFocus:s=!1,disableRestoreFocus:d=!1,getTabbable:h=To,isEnabled:f=ko,open:y}=t,w=x.useRef(!1),E=x.useRef(null),D=x.useRef(null),p=x.useRef(null),C=x.useRef(null),M=x.useRef(!1),j=x.useRef(null),$=ct(r.ref,j),F=x.useRef(null);x.useEffect(()=>{!y||!j.current||(M.current=!o)},[o,y]),x.useEffect(()=>{if(!y||!j.current)return;const N=Le(j.current);return j.current.contains(N.activeElement)||(j.current.hasAttribute("tabIndex")||j.current.setAttribute("tabIndex","-1"),M.current&&j.current.focus()),()=>{d||(p.current&&p.current.focus&&(w.current=!0,p.current.focus()),p.current=null)}},[y]),x.useEffect(()=>{if(!y||!j.current)return;const N=Le(j.current),R=T=>{F.current=T,!(s||!f()||T.key!=="Tab")&&N.activeElement===j.current&&T.shiftKey&&(w.current=!0,D.current&&D.current.focus())},g=()=>{var Y,J;const T=j.current;if(T===null)return;if(!N.hasFocus()||!f()||w.current){w.current=!1;return}if(T.contains(N.activeElement)||s&&N.activeElement!==E.current&&N.activeElement!==D.current)return;if(N.activeElement!==C.current)C.current=null;else if(C.current!==null)return;if(!M.current)return;let O=[];if((N.activeElement===E.current||N.activeElement===D.current)&&(O=h(j.current)),O.length>0){const z=!!((Y=F.current)!=null&&Y.shiftKey&&((J=F.current)==null?void 0:J.key)==="Tab"),Q=O[0],ee=O[O.length-1];typeof Q!="string"&&typeof ee!="string"&&(z?ee.focus():Q.focus())}else T.focus()};N.addEventListener("focusin",g),N.addEventListener("keydown",R,!0);const A=setInterval(()=>{N.activeElement&&N.activeElement.tagName==="BODY"&&g()},50);return()=>{clearInterval(A),N.removeEventListener("focusin",g),N.removeEventListener("keydown",R,!0)}},[o,s,d,f,y,h]);const G=N=>{p.current===null&&(p.current=N.relatedTarget),M.current=!0,C.current=N.target;const R=r.props.onFocus;R&&R(N)},H=N=>{p.current===null&&(p.current=N.relatedTarget),M.current=!0};return u.jsxs(x.Fragment,{children:[u.jsx("div",{tabIndex:y?0:-1,onFocus:H,ref:E,"data-testid":"sentinelStart"}),x.cloneElement(r,{ref:$,onFocus:G}),u.jsx("div",{tabIndex:y?0:-1,onFocus:H,ref:D,"data-testid":"sentinelEnd"})]})}const fn="base";function Ro(t){return`${fn}--${t}`}function Ao(t,r){return`${fn}-${t}-${r}`}function hn(t,r){const o=vr[r];return o?Ro(o):Ao(t,r)}function Do(t,r){const o={};return r.forEach(s=>{o[s]=hn(t,s)}),o}const mn="Modal";function jo(t){return hn(mn,t)}Do(mn,["root","hidden","backdrop"]);const Lo=t=>{const{open:r,exited:o}=t;return yr({root:["root",!r&&o&&"hidden"],backdrop:["backdrop"]},lo(jo))},gn=x.forwardRef(function(r,o){const{children:s,closeAfterTransition:d=!1,container:h,disableAutoFocus:f=!1,disableEnforceFocus:y=!1,disableEscapeKeyDown:w=!1,disablePortal:E=!1,disableRestoreFocus:D=!1,disableScrollLock:p=!1,hideBackdrop:C=!1,keepMounted:M=!1,onBackdropClick:j,onClose:$,onKeyDown:F,open:G,onTransitionEnter:H,onTransitionExited:N,slotProps:R={},slots:g={},...A}=r,T={...r,closeAfterTransition:d,disableAutoFocus:f,disableEnforceFocus:y,disableEscapeKeyDown:w,disablePortal:E,disableRestoreFocus:D,disableScrollLock:p,hideBackdrop:C,keepMounted:M},{getRootProps:O,getBackdropProps:Y,getTransitionProps:J,portalRef:z,isTopModal:Q,exited:ee,hasTransition:le}=Io({...T,rootRef:o}),ie={...T,exited:ee,hasTransition:le},U=Lo(ie),P={};if(s.props.tabIndex===void 0&&(P.tabIndex="-1"),le){const{onEnter:ce,onExited:be}=J();P.onEnter=ce,P.onExited=be}const se=g.root??"div",xe=Qt({elementType:se,externalSlotProps:R.root,externalForwardedProps:A,getSlotProps:O,className:U.root,ownerState:ie}),ne=g.backdrop,re=Qt({elementType:ne,externalSlotProps:R.backdrop,getSlotProps:ce=>Y({...ce,onClick:be=>{j&&j(be),ce!=null&&ce.onClick&&ce.onClick(be)}}),className:U.backdrop,ownerState:ie});return!M&&!G&&(!le||ee)?null:u.jsx(mo,{ref:z,container:h,disablePortal:E,children:u.jsxs(se,{...xe,children:[!C&&ne?u.jsx(ne,{...re}):null,u.jsx(Mo,{disableEnforceFocus:y,disableAutoFocus:f,disableRestoreFocus:D,isEnabled:Q,open:G,children:x.cloneElement(s,P)})]})})});function Oo(){const[t,r]=x.useState(null);x.useEffect(()=>(at.on(it.showInstantMessageDialog,s=>{r(s)}),()=>{at.remove(it.showInstantMessageDialog)}),[]);const o=nn({palette:{mode:"dark"}});return u.jsx("div",{children:u.jsx(oo,{theme:o,children:u.jsx(Po,{"aria-labelledby":"unstyled-modal-title","aria-describedby":"unstyled-modal-description",open:!!t,onClose:()=>r(null),slots:{backdrop:Bo},children:u.jsxs(Ho,{sx:{width:300},children:[u.jsx("h2",{id:"unstyled-modal-title",className:"modal-title",children:t==null?void 0:t.msgHeader}),u.jsx("p",{id:"unstyled-modal-description",className:"modal-description",children:t==null?void 0:t.msgContent})]})})})})}const pn=x.forwardRef((t,r)=>{const{open:o,className:s,...d}=t;return u.jsx("div",{className:st({"base-Backdrop-open":o},s),ref:r,...d})});pn.displayName="Backdrop-2";const Zt={200:"#99CCFF",300:"#66B2FF",400:"#3399FF",500:"#007FFF",600:"#0072E5",700:"#0066CC"},ue={50:"#F3F6F9",100:"#E5EAF2",200:"#DAE2ED",300:"#C7D0DD",400:"#B0B8C4",500:"#9DA8B7",600:"#6B7A90",700:"#434D5B",800:"#303740",900:"#1C2025"},Po=Oe(gn)`
  position: fixed;
  z-index: 1300;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
`,Bo=Oe(pn)`
  z-index: -1;
  position: fixed;
  inset: 0;
  background-color: rgb(0 0 0 / 0.5);
  -webkit-tap-highlight-color: transparent;
`,Ho=Oe("div")(({theme:t})=>wt`
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 500;
    text-align: start;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow: hidden;
    background-color: ${t.palette.mode==="dark"?ue[900]:"#fff"};
    border-radius: 8px;
    border: 1px solid ${t.palette.mode==="dark"?ue[700]:ue[200]};
    box-shadow: 0 4px 12px ${t.palette.mode==="dark"?"rgb(0 0 0 / 0.5)":"rgb(0 0 0 / 0.2)"};
    padding: 24px;
    color: ${t.palette.mode==="dark"?ue[50]:ue[900]};

    & .modal-title {
      margin: 0;
      line-height: 1.5rem;
      margin-bottom: 8px;
    }

    & .modal-description {
      margin: 0;
      line-height: 1.5rem;
      font-weight: 400;
      color: ${t.palette.mode==="dark"?ue[400]:ue[800]};
      margin-bottom: 4px;
    }
  `);Oe("button")(({theme:t})=>wt`
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 600;
    font-size: 0.875rem;
    line-height: 1.5;
    padding: 8px 16px;
    border-radius: 8px;
    transition: all 150ms ease;
    cursor: pointer;
    background: ${t.palette.mode==="dark"?ue[900]:"#fff"};
    border: 1px solid ${t.palette.mode==="dark"?ue[700]:ue[200]};
    color: ${t.palette.mode==="dark"?ue[200]:ue[900]};
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);

    &:hover {
      background: ${t.palette.mode==="dark"?ue[800]:ue[50]};
      border-color: ${t.palette.mode==="dark"?ue[600]:ue[300]};
    }

    &:active {
      background: ${t.palette.mode==="dark"?ue[700]:ue[100]};
    }

    &:focus-visible {
      box-shadow: 0 0 0 4px ${t.palette.mode==="dark"?Zt[300]:Zt[200]};
      outline: none;
    }
  `);async function Fo(t){return(await It(Re.chatApiUrl+"/message/customer/getAction?groupId="+t,{headers:{accessToken:q.chatToken()}})).data}async function $o(t){try{return(await lt(Re.chatApiUrl+"/message/customer/historyPage",{headers:{accessToken:q.chatToken()}},t)).data.datas.map(o=>new we(o))}catch(r){return console.error(r),[]}}var vn={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,r){(function(o){t.exports=o()})(function(){return function o(s,d,h){function f(E,D){if(!d[E]){if(!s[E]){var p=typeof et=="function"&&et;if(!D&&p)return p(E,!0);if(y)return y(E,!0);var C=new Error("Cannot find module '"+E+"'");throw C.code="MODULE_NOT_FOUND",C}var M=d[E]={exports:{}};s[E][0].call(M.exports,function(j){var $=s[E][1][j];return f($||j)},M,M.exports,o,s,d,h)}return d[E].exports}for(var y=typeof et=="function"&&et,w=0;w<h.length;w++)f(h[w]);return f}({1:[function(o,s,d){(function(h){var f=h.MutationObserver||h.WebKitMutationObserver,y;if(f){var w=0,E=new f(j),D=h.document.createTextNode("");E.observe(D,{characterData:!0}),y=function(){D.data=w=++w%2}}else if(!h.setImmediate&&typeof h.MessageChannel<"u"){var p=new h.MessageChannel;p.port1.onmessage=j,y=function(){p.port2.postMessage(0)}}else"document"in h&&"onreadystatechange"in h.document.createElement("script")?y=function(){var F=h.document.createElement("script");F.onreadystatechange=function(){j(),F.onreadystatechange=null,F.parentNode.removeChild(F),F=null},h.document.documentElement.appendChild(F)}:y=function(){setTimeout(j,0)};var C,M=[];function j(){C=!0;for(var F,G,H=M.length;H;){for(G=M,M=[],F=-1;++F<H;)G[F]();H=M.length}C=!1}s.exports=$;function $(F){M.push(F)===1&&!C&&y()}}).call(this,typeof Ze<"u"?Ze:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(o,s,d){var h=o(1);function f(){}var y={},w=["REJECTED"],E=["FULFILLED"],D=["PENDING"];s.exports=p;function p(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=D,this.queue=[],this.outcome=void 0,g!==f&&$(this,g)}p.prototype.catch=function(g){return this.then(null,g)},p.prototype.then=function(g,A){if(typeof g!="function"&&this.state===E||typeof A!="function"&&this.state===w)return this;var T=new this.constructor(f);if(this.state!==D){var O=this.state===E?g:A;M(T,O,this.outcome)}else this.queue.push(new C(T,g,A));return T};function C(g,A,T){this.promise=g,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}C.prototype.callFulfilled=function(g){y.resolve(this.promise,g)},C.prototype.otherCallFulfilled=function(g){M(this.promise,this.onFulfilled,g)},C.prototype.callRejected=function(g){y.reject(this.promise,g)},C.prototype.otherCallRejected=function(g){M(this.promise,this.onRejected,g)};function M(g,A,T){h(function(){var O;try{O=A(T)}catch(Y){return y.reject(g,Y)}O===g?y.reject(g,new TypeError("Cannot resolve promise with itself")):y.resolve(g,O)})}y.resolve=function(g,A){var T=F(j,A);if(T.status==="error")return y.reject(g,T.value);var O=T.value;if(O)$(g,O);else{g.state=E,g.outcome=A;for(var Y=-1,J=g.queue.length;++Y<J;)g.queue[Y].callFulfilled(A)}return g},y.reject=function(g,A){g.state=w,g.outcome=A;for(var T=-1,O=g.queue.length;++T<O;)g.queue[T].callRejected(A);return g};function j(g){var A=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof A=="function")return function(){A.apply(g,arguments)}}function $(g,A){var T=!1;function O(Q){T||(T=!0,y.reject(g,Q))}function Y(Q){T||(T=!0,y.resolve(g,Q))}function J(){A(Y,O)}var z=F(J);z.status==="error"&&O(z.value)}function F(g,A){var T={};try{T.value=g(A),T.status="success"}catch(O){T.status="error",T.value=O}return T}p.resolve=G;function G(g){return g instanceof this?g:y.resolve(new this(f),g)}p.reject=H;function H(g){var A=new this(f);return y.reject(A,g)}p.all=N;function N(g){var A=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=g.length,O=!1;if(!T)return this.resolve([]);for(var Y=new Array(T),J=0,z=-1,Q=new this(f);++z<T;)ee(g[z],z);return Q;function ee(le,ie){A.resolve(le).then(U,function(P){O||(O=!0,y.reject(Q,P))});function U(P){Y[ie]=P,++J===T&&!O&&(O=!0,y.resolve(Q,Y))}}}p.race=R;function R(g){var A=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=g.length,O=!1;if(!T)return this.resolve([]);for(var Y=-1,J=new this(f);++Y<T;)z(g[Y]);return J;function z(Q){A.resolve(Q).then(function(ee){O||(O=!0,y.resolve(J,ee))},function(ee){O||(O=!0,y.reject(J,ee))})}}},{1:1}],3:[function(o,s,d){(function(h){typeof h.Promise!="function"&&(h.Promise=o(2))}).call(this,typeof Ze<"u"?Ze:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(o,s,d){var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function f(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function y(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var w=y();function E(){try{if(!w||!w.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),a=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||a)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function D(e,a){e=e||[],a=a||{};try{return new Blob(e,a)}catch(i){if(i.name!=="TypeError")throw i;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,c=new n,l=0;l<e.length;l+=1)c.append(e[l]);return c.getBlob(a.type)}}typeof Promise>"u"&&o(3);var p=Promise;function C(e,a){a&&e.then(function(n){a(null,n)},function(n){a(n)})}function M(e,a,n){typeof a=="function"&&e.then(a),typeof n=="function"&&e.catch(n)}function j(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function $(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var F="local-forage-detect-blob-support",G=void 0,H={},N=Object.prototype.toString,R="readonly",g="readwrite";function A(e){for(var a=e.length,n=new ArrayBuffer(a),c=new Uint8Array(n),l=0;l<a;l++)c[l]=e.charCodeAt(l);return n}function T(e){return new p(function(a){var n=e.transaction(F,g),c=D([""]);n.objectStore(F).put(c,"key"),n.onabort=function(l){l.preventDefault(),l.stopPropagation(),a(!1)},n.oncomplete=function(){var l=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);a(i||!l||parseInt(l[1],10)>=43)}}).catch(function(){return!1})}function O(e){return typeof G=="boolean"?p.resolve(G):T(e).then(function(a){return G=a,G})}function Y(e){var a=H[e.name],n={};n.promise=new p(function(c,l){n.resolve=c,n.reject=l}),a.deferredOperations.push(n),a.dbReady?a.dbReady=a.dbReady.then(function(){return n.promise}):a.dbReady=n.promise}function J(e){var a=H[e.name],n=a.deferredOperations.pop();if(n)return n.resolve(),n.promise}function z(e,a){var n=H[e.name],c=n.deferredOperations.pop();if(c)return c.reject(a),c.promise}function Q(e,a){return new p(function(n,c){if(H[e.name]=H[e.name]||ce(),e.db)if(a)Y(e),e.db.close();else return n(e.db);var l=[e.name];a&&l.push(e.version);var i=w.open.apply(w,l);a&&(i.onupgradeneeded=function(m){var v=i.result;try{v.createObjectStore(e.storeName),m.oldVersion<=1&&v.createObjectStore(F)}catch(b){if(b.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+m.oldVersion+" to version "+m.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw b}}),i.onerror=function(m){m.preventDefault(),c(i.error)},i.onsuccess=function(){var m=i.result;m.onversionchange=function(v){v.target.close()},n(m),J(e)}})}function ee(e){return Q(e,!1)}function le(e){return Q(e,!0)}function ie(e,a){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),c=e.version<e.db.version,l=e.version>e.db.version;if(c&&(e.version!==a&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),l||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function U(e){return new p(function(a,n){var c=new FileReader;c.onerror=n,c.onloadend=function(l){var i=btoa(l.target.result||"");a({__local_forage_encoded_blob:!0,data:i,type:e.type})},c.readAsBinaryString(e)})}function P(e){var a=A(atob(e.data));return D([a],{type:e.type})}function se(e){return e&&e.__local_forage_encoded_blob}function xe(e){var a=this,n=a._initReady().then(function(){var c=H[a._dbInfo.name];if(c&&c.dbReady)return c.dbReady});return M(n,e,e),n}function ne(e){Y(e);for(var a=H[e.name],n=a.forages,c=0;c<n.length;c++){var l=n[c];l._dbInfo.db&&(l._dbInfo.db.close(),l._dbInfo.db=null)}return e.db=null,ee(e).then(function(i){return e.db=i,ie(e)?le(e):i}).then(function(i){e.db=a.db=i;for(var m=0;m<n.length;m++)n[m]._dbInfo.db=i}).catch(function(i){throw z(e,i),i})}function re(e,a,n,c){c===void 0&&(c=1);try{var l=e.db.transaction(e.storeName,a);n(null,l)}catch(i){if(c>0&&(!e.db||i.name==="InvalidStateError"||i.name==="NotFoundError"))return p.resolve().then(function(){if(!e.db||i.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),le(e)}).then(function(){return ne(e).then(function(){re(e,a,n,c-1)})}).catch(n);n(i)}}function ce(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function be(e){var a=this,n={db:null};if(e)for(var c in e)n[c]=e[c];var l=H[n.name];l||(l=ce(),H[n.name]=l),l.forages.push(a),a._initReady||(a._initReady=a.ready,a.ready=xe);var i=[];function m(){return p.resolve()}for(var v=0;v<l.forages.length;v++){var b=l.forages[v];b!==a&&i.push(b._initReady().catch(m))}var S=l.forages.slice(0);return p.all(i).then(function(){return n.db=l.db,ee(n)}).then(function(I){return n.db=I,ie(n,a._defaultConfig.version)?le(n):I}).then(function(I){n.db=l.db=I,a._dbInfo=n;for(var k=0;k<S.length;k++){var B=S[k];B!==a&&(B._dbInfo.db=n.db,B._dbInfo.version=n.version)}})}function Ae(e,a){var n=this;e=j(e);var c=new p(function(l,i){n.ready().then(function(){re(n._dbInfo,R,function(m,v){if(m)return i(m);try{var b=v.objectStore(n._dbInfo.storeName),S=b.get(e);S.onsuccess=function(){var I=S.result;I===void 0&&(I=null),se(I)&&(I=P(I)),l(I)},S.onerror=function(){i(S.error)}}catch(I){i(I)}})}).catch(i)});return C(c,a),c}function ze(e,a){var n=this,c=new p(function(l,i){n.ready().then(function(){re(n._dbInfo,R,function(m,v){if(m)return i(m);try{var b=v.objectStore(n._dbInfo.storeName),S=b.openCursor(),I=1;S.onsuccess=function(){var k=S.result;if(k){var B=k.value;se(B)&&(B=P(B));var W=e(B,k.key,I++);W!==void 0?l(W):k.continue()}else l()},S.onerror=function(){i(S.error)}}catch(k){i(k)}})}).catch(i)});return C(c,a),c}function We(e,a,n){var c=this;e=j(e);var l=new p(function(i,m){var v;c.ready().then(function(){return v=c._dbInfo,N.call(a)==="[object Blob]"?O(v.db).then(function(b){return b?a:U(a)}):a}).then(function(b){re(c._dbInfo,g,function(S,I){if(S)return m(S);try{var k=I.objectStore(c._dbInfo.storeName);b===null&&(b=void 0);var B=k.put(b,e);I.oncomplete=function(){b===void 0&&(b=null),i(b)},I.onabort=I.onerror=function(){var W=B.error?B.error:B.transaction.error;m(W)}}catch(W){m(W)}})}).catch(m)});return C(l,n),l}function Pe(e,a){var n=this;e=j(e);var c=new p(function(l,i){n.ready().then(function(){re(n._dbInfo,g,function(m,v){if(m)return i(m);try{var b=v.objectStore(n._dbInfo.storeName),S=b.delete(e);v.oncomplete=function(){l()},v.onerror=function(){i(S.error)},v.onabort=function(){var I=S.error?S.error:S.transaction.error;i(I)}}catch(I){i(I)}})}).catch(i)});return C(c,a),c}function Be(e){var a=this,n=new p(function(c,l){a.ready().then(function(){re(a._dbInfo,g,function(i,m){if(i)return l(i);try{var v=m.objectStore(a._dbInfo.storeName),b=v.clear();m.oncomplete=function(){c()},m.onabort=m.onerror=function(){var S=b.error?b.error:b.transaction.error;l(S)}}catch(S){l(S)}})}).catch(l)});return C(n,e),n}function He(e){var a=this,n=new p(function(c,l){a.ready().then(function(){re(a._dbInfo,R,function(i,m){if(i)return l(i);try{var v=m.objectStore(a._dbInfo.storeName),b=v.count();b.onsuccess=function(){c(b.result)},b.onerror=function(){l(b.error)}}catch(S){l(S)}})}).catch(l)});return C(n,e),n}function Se(e,a){var n=this,c=new p(function(l,i){if(e<0){l(null);return}n.ready().then(function(){re(n._dbInfo,R,function(m,v){if(m)return i(m);try{var b=v.objectStore(n._dbInfo.storeName),S=!1,I=b.openKeyCursor();I.onsuccess=function(){var k=I.result;if(!k){l(null);return}e===0||S?l(k.key):(S=!0,k.advance(e))},I.onerror=function(){i(I.error)}}catch(k){i(k)}})}).catch(i)});return C(c,a),c}function Ge(e){var a=this,n=new p(function(c,l){a.ready().then(function(){re(a._dbInfo,R,function(i,m){if(i)return l(i);try{var v=m.objectStore(a._dbInfo.storeName),b=v.openKeyCursor(),S=[];b.onsuccess=function(){var I=b.result;if(!I){c(S);return}S.push(I.key),I.continue()},b.onerror=function(){l(b.error)}}catch(I){l(I)}})}).catch(l)});return C(n,e),n}function De(e,a){a=$.apply(this,arguments);var n=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var c=this,l;if(!e.name)l=p.reject("Invalid arguments");else{var i=e.name===n.name&&c._dbInfo.db,m=i?p.resolve(c._dbInfo.db):ee(e).then(function(v){var b=H[e.name],S=b.forages;b.db=v;for(var I=0;I<S.length;I++)S[I]._dbInfo.db=v;return v});e.storeName?l=m.then(function(v){if(v.objectStoreNames.contains(e.storeName)){var b=v.version+1;Y(e);var S=H[e.name],I=S.forages;v.close();for(var k=0;k<I.length;k++){var B=I[k];B._dbInfo.db=null,B._dbInfo.version=b}var W=new p(function(K,ae){var oe=w.open(e.name,b);oe.onerror=function(ve){var Ye=oe.result;Ye.close(),ae(ve)},oe.onupgradeneeded=function(){var ve=oe.result;ve.deleteObjectStore(e.storeName)},oe.onsuccess=function(){var ve=oe.result;ve.close(),K(ve)}});return W.then(function(K){S.db=K;for(var ae=0;ae<I.length;ae++){var oe=I[ae];oe._dbInfo.db=K,J(oe._dbInfo)}}).catch(function(K){throw(z(e,K)||p.resolve()).catch(function(){}),K})}}):l=m.then(function(v){Y(e);var b=H[e.name],S=b.forages;v.close();for(var I=0;I<S.length;I++){var k=S[I];k._dbInfo.db=null}var B=new p(function(W,K){var ae=w.deleteDatabase(e.name);ae.onerror=function(){var oe=ae.result;oe&&oe.close(),K(ae.error)},ae.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},ae.onsuccess=function(){var oe=ae.result;oe&&oe.close(),W(oe)}});return B.then(function(W){b.db=W;for(var K=0;K<S.length;K++){var ae=S[K];J(ae._dbInfo)}}).catch(function(W){throw(z(e,W)||p.resolve()).catch(function(){}),W})})}return C(l,a),l}var Ne={_driver:"asyncStorage",_initStorage:be,_support:E(),iterate:ze,getItem:Ae,setItem:We,removeItem:Pe,clear:Be,length:He,key:Se,keys:Ge,dropInstance:De};function de(){return typeof openDatabase=="function"}var ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe="~~local_forage_type~",he=/^~~local_forage_type~([^~]+)~/,pe="__lfsc__:",je=pe.length,Ce="arbf",Ee="blob",Te="si08",_="ui08",L="uic8",Z="si16",me="si32",V="ur16",X="ui32",Ie="fl32",ke="fl64",$e=je+Ce.length,Xe=Object.prototype.toString;function kt(e){var a=e.length*.75,n=e.length,c,l=0,i,m,v,b;e[e.length-1]==="="&&(a--,e[e.length-2]==="="&&a--);var S=new ArrayBuffer(a),I=new Uint8Array(S);for(c=0;c<n;c+=4)i=ge.indexOf(e[c]),m=ge.indexOf(e[c+1]),v=ge.indexOf(e[c+2]),b=ge.indexOf(e[c+3]),I[l++]=i<<2|m>>4,I[l++]=(m&15)<<4|v>>2,I[l++]=(v&3)<<6|b&63;return S}function ut(e){var a=new Uint8Array(e),n="",c;for(c=0;c<a.length;c+=3)n+=ge[a[c]>>2],n+=ge[(a[c]&3)<<4|a[c+1]>>4],n+=ge[(a[c+1]&15)<<2|a[c+2]>>6],n+=ge[a[c+2]&63];return a.length%3===2?n=n.substring(0,n.length-1)+"=":a.length%3===1&&(n=n.substring(0,n.length-2)+"=="),n}function wn(e,a){var n="";if(e&&(n=Xe.call(e)),e&&(n==="[object ArrayBuffer]"||e.buffer&&Xe.call(e.buffer)==="[object ArrayBuffer]")){var c,l=pe;e instanceof ArrayBuffer?(c=e,l+=Ce):(c=e.buffer,n==="[object Int8Array]"?l+=Te:n==="[object Uint8Array]"?l+=_:n==="[object Uint8ClampedArray]"?l+=L:n==="[object Int16Array]"?l+=Z:n==="[object Uint16Array]"?l+=V:n==="[object Int32Array]"?l+=me:n==="[object Uint32Array]"?l+=X:n==="[object Float32Array]"?l+=Ie:n==="[object Float64Array]"?l+=ke:a(new Error("Failed to get type for BinaryArray"))),a(l+ut(c))}else if(n==="[object Blob]"){var i=new FileReader;i.onload=function(){var m=Fe+e.type+"~"+ut(this.result);a(pe+Ee+m)},i.readAsArrayBuffer(e)}else try{a(JSON.stringify(e))}catch(m){console.error("Couldn't convert value into a JSON string: ",e),a(null,m)}}function In(e){if(e.substring(0,je)!==pe)return JSON.parse(e);var a=e.substring($e),n=e.substring(je,$e),c;if(n===Ee&&he.test(a)){var l=a.match(he);c=l[1],a=a.substring(l[0].length)}var i=kt(a);switch(n){case Ce:return i;case Ee:return D([i],{type:c});case Te:return new Int8Array(i);case _:return new Uint8Array(i);case L:return new Uint8ClampedArray(i);case Z:return new Int16Array(i);case V:return new Uint16Array(i);case me:return new Int32Array(i);case X:return new Uint32Array(i);case Ie:return new Float32Array(i);case ke:return new Float64Array(i);default:throw new Error("Unkown type: "+n)}}var dt={serialize:wn,deserialize:In,stringToBuffer:kt,bufferToString:ut};function Mt(e,a,n,c){e.executeSql("CREATE TABLE IF NOT EXISTS "+a.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,c)}function _n(e){var a=this,n={db:null};if(e)for(var c in e)n[c]=typeof e[c]!="string"?e[c].toString():e[c];var l=new p(function(i,m){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(v){return m(v)}n.db.transaction(function(v){Mt(v,n,function(){a._dbInfo=n,i()},function(b,S){m(S)})},m)});return n.serializer=dt,l}function Me(e,a,n,c,l,i){e.executeSql(n,c,l,function(m,v){v.code===v.SYNTAX_ERR?m.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[a.storeName],function(b,S){S.rows.length?i(b,v):Mt(b,a,function(){b.executeSql(n,c,l,i)},i)},i):i(m,v)},i)}function Cn(e,a){var n=this;e=j(e);var c=new p(function(l,i){n.ready().then(function(){var m=n._dbInfo;m.db.transaction(function(v){Me(v,m,"SELECT * FROM "+m.storeName+" WHERE key = ? LIMIT 1",[e],function(b,S){var I=S.rows.length?S.rows.item(0).value:null;I&&(I=m.serializer.deserialize(I)),l(I)},function(b,S){i(S)})})}).catch(i)});return C(c,a),c}function En(e,a){var n=this,c=new p(function(l,i){n.ready().then(function(){var m=n._dbInfo;m.db.transaction(function(v){Me(v,m,"SELECT * FROM "+m.storeName,[],function(b,S){for(var I=S.rows,k=I.length,B=0;B<k;B++){var W=I.item(B),K=W.value;if(K&&(K=m.serializer.deserialize(K)),K=e(K,W.key,B+1),K!==void 0){l(K);return}}l()},function(b,S){i(S)})})}).catch(i)});return C(c,a),c}function Rt(e,a,n,c){var l=this;e=j(e);var i=new p(function(m,v){l.ready().then(function(){a===void 0&&(a=null);var b=a,S=l._dbInfo;S.serializer.serialize(a,function(I,k){k?v(k):S.db.transaction(function(B){Me(B,S,"INSERT OR REPLACE INTO "+S.storeName+" (key, value) VALUES (?, ?)",[e,I],function(){m(b)},function(W,K){v(K)})},function(B){if(B.code===B.QUOTA_ERR){if(c>0){m(Rt.apply(l,[e,b,n,c-1]));return}v(B)}})})}).catch(v)});return C(i,n),i}function Nn(e,a,n){return Rt.apply(this,[e,a,n,1])}function Tn(e,a){var n=this;e=j(e);var c=new p(function(l,i){n.ready().then(function(){var m=n._dbInfo;m.db.transaction(function(v){Me(v,m,"DELETE FROM "+m.storeName+" WHERE key = ?",[e],function(){l()},function(b,S){i(S)})})}).catch(i)});return C(c,a),c}function kn(e){var a=this,n=new p(function(c,l){a.ready().then(function(){var i=a._dbInfo;i.db.transaction(function(m){Me(m,i,"DELETE FROM "+i.storeName,[],function(){c()},function(v,b){l(b)})})}).catch(l)});return C(n,e),n}function Mn(e){var a=this,n=new p(function(c,l){a.ready().then(function(){var i=a._dbInfo;i.db.transaction(function(m){Me(m,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],function(v,b){var S=b.rows.item(0).c;c(S)},function(v,b){l(b)})})}).catch(l)});return C(n,e),n}function Rn(e,a){var n=this,c=new p(function(l,i){n.ready().then(function(){var m=n._dbInfo;m.db.transaction(function(v){Me(v,m,"SELECT key FROM "+m.storeName+" WHERE id = ? LIMIT 1",[e+1],function(b,S){var I=S.rows.length?S.rows.item(0).key:null;l(I)},function(b,S){i(S)})})}).catch(i)});return C(c,a),c}function An(e){var a=this,n=new p(function(c,l){a.ready().then(function(){var i=a._dbInfo;i.db.transaction(function(m){Me(m,i,"SELECT key FROM "+i.storeName,[],function(v,b){for(var S=[],I=0;I<b.rows.length;I++)S.push(b.rows.item(I).key);c(S)},function(v,b){l(b)})})}).catch(l)});return C(n,e),n}function Dn(e){return new p(function(a,n){e.transaction(function(c){c.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(l,i){for(var m=[],v=0;v<i.rows.length;v++)m.push(i.rows.item(v).name);a({db:e,storeNames:m})},function(l,i){n(i)})},function(c){n(c)})})}function jn(e,a){a=$.apply(this,arguments);var n=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var c=this,l;return e.name?l=new p(function(i){var m;e.name===n.name?m=c._dbInfo.db:m=openDatabase(e.name,"","",0),e.storeName?i({db:m,storeNames:[e.storeName]}):i(Dn(m))}).then(function(i){return new p(function(m,v){i.db.transaction(function(b){function S(W){return new p(function(K,ae){b.executeSql("DROP TABLE IF EXISTS "+W,[],function(){K()},function(oe,ve){ae(ve)})})}for(var I=[],k=0,B=i.storeNames.length;k<B;k++)I.push(S(i.storeNames[k]));p.all(I).then(function(){m()}).catch(function(W){v(W)})},function(b){v(b)})})}):l=p.reject("Invalid arguments"),C(l,a),l}var Ln={_driver:"webSQLStorage",_initStorage:_n,_support:de(),iterate:En,getItem:Cn,setItem:Nn,removeItem:Tn,clear:kn,length:Mn,key:Rn,keys:An,dropInstance:jn};function On(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function At(e,a){var n=e.name+"/";return e.storeName!==a.storeName&&(n+=e.storeName+"/"),n}function Pn(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function Bn(){return!Pn()||localStorage.length>0}function Hn(e){var a=this,n={};if(e)for(var c in e)n[c]=e[c];return n.keyPrefix=At(e,a._defaultConfig),Bn()?(a._dbInfo=n,n.serializer=dt,p.resolve()):p.reject()}function Fn(e){var a=this,n=a.ready().then(function(){for(var c=a._dbInfo.keyPrefix,l=localStorage.length-1;l>=0;l--){var i=localStorage.key(l);i.indexOf(c)===0&&localStorage.removeItem(i)}});return C(n,e),n}function $n(e,a){var n=this;e=j(e);var c=n.ready().then(function(){var l=n._dbInfo,i=localStorage.getItem(l.keyPrefix+e);return i&&(i=l.serializer.deserialize(i)),i});return C(c,a),c}function Un(e,a){var n=this,c=n.ready().then(function(){for(var l=n._dbInfo,i=l.keyPrefix,m=i.length,v=localStorage.length,b=1,S=0;S<v;S++){var I=localStorage.key(S);if(I.indexOf(i)===0){var k=localStorage.getItem(I);if(k&&(k=l.serializer.deserialize(k)),k=e(k,I.substring(m),b++),k!==void 0)return k}}});return C(c,a),c}function Vn(e,a){var n=this,c=n.ready().then(function(){var l=n._dbInfo,i;try{i=localStorage.key(e)}catch{i=null}return i&&(i=i.substring(l.keyPrefix.length)),i});return C(c,a),c}function zn(e){var a=this,n=a.ready().then(function(){for(var c=a._dbInfo,l=localStorage.length,i=[],m=0;m<l;m++){var v=localStorage.key(m);v.indexOf(c.keyPrefix)===0&&i.push(v.substring(c.keyPrefix.length))}return i});return C(n,e),n}function Wn(e){var a=this,n=a.keys().then(function(c){return c.length});return C(n,e),n}function Gn(e,a){var n=this;e=j(e);var c=n.ready().then(function(){var l=n._dbInfo;localStorage.removeItem(l.keyPrefix+e)});return C(c,a),c}function Kn(e,a,n){var c=this;e=j(e);var l=c.ready().then(function(){a===void 0&&(a=null);var i=a;return new p(function(m,v){var b=c._dbInfo;b.serializer.serialize(a,function(S,I){if(I)v(I);else try{localStorage.setItem(b.keyPrefix+e,S),m(i)}catch(k){(k.name==="QuotaExceededError"||k.name==="NS_ERROR_DOM_QUOTA_REACHED")&&v(k),v(k)}})})});return C(l,n),l}function Yn(e,a){if(a=$.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var c=this,l;return e.name?l=new p(function(i){e.storeName?i(At(e,c._defaultConfig)):i(e.name+"/")}).then(function(i){for(var m=localStorage.length-1;m>=0;m--){var v=localStorage.key(m);v.indexOf(i)===0&&localStorage.removeItem(v)}}):l=p.reject("Invalid arguments"),C(l,a),l}var Jn={_driver:"localStorageWrapper",_initStorage:Hn,_support:On(),iterate:Un,getItem:$n,setItem:Kn,removeItem:Gn,clear:Fn,length:Wn,key:Vn,keys:zn,dropInstance:Yn},Qn=function(a,n){return a===n||typeof a=="number"&&typeof n=="number"&&isNaN(a)&&isNaN(n)},Xn=function(a,n){for(var c=a.length,l=0;l<c;){if(Qn(a[l],n))return!0;l++}return!1},Dt=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},Ke={},jt={},Ue={INDEXEDDB:Ne,WEBSQL:Ln,LOCALSTORAGE:Jn},qn=[Ue.INDEXEDDB._driver,Ue.WEBSQL._driver,Ue.LOCALSTORAGE._driver],qe=["dropInstance"],ft=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(qe),Zn={description:"",driver:qn.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function er(e,a){e[a]=function(){var n=arguments;return e.ready().then(function(){return e[a].apply(e,n)})}}function ht(){for(var e=1;e<arguments.length;e++){var a=arguments[e];if(a)for(var n in a)a.hasOwnProperty(n)&&(Dt(a[n])?arguments[0][n]=a[n].slice():arguments[0][n]=a[n])}return arguments[0]}var tr=function(){function e(a){f(this,e);for(var n in Ue)if(Ue.hasOwnProperty(n)){var c=Ue[n],l=c._driver;this[n]=l,Ke[l]||this.defineDriver(c)}this._defaultConfig=ht({},Zn),this._config=ht({},this._defaultConfig,a),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(n){if((typeof n>"u"?"undefined":h(n))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var c in n){if(c==="storeName"&&(n[c]=n[c].replace(/\W/g,"_")),c==="version"&&typeof n[c]!="number")return new Error("Database version must be a number.");this._config[c]=n[c]}return"driver"in n&&n.driver?this.setDriver(this._config.driver):!0}else return typeof n=="string"?this._config[n]:this._config},e.prototype.defineDriver=function(n,c,l){var i=new p(function(m,v){try{var b=n._driver,S=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!n._driver){v(S);return}for(var I=ft.concat("_initStorage"),k=0,B=I.length;k<B;k++){var W=I[k],K=!Xn(qe,W);if((K||n[W])&&typeof n[W]!="function"){v(S);return}}var ae=function(){for(var Ye=function(or){return function(){var sr=new Error("Method "+or+" is not implemented by the current driver"),Lt=p.reject(sr);return C(Lt,arguments[arguments.length-1]),Lt}},mt=0,rr=qe.length;mt<rr;mt++){var gt=qe[mt];n[gt]||(n[gt]=Ye(gt))}};ae();var oe=function(Ye){Ke[b]&&console.info("Redefining LocalForage driver: "+b),Ke[b]=n,jt[b]=Ye,m()};"_support"in n?n._support&&typeof n._support=="function"?n._support().then(oe,v):oe(!!n._support):oe(!0)}catch(ve){v(ve)}});return M(i,c,l),i},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(n,c,l){var i=Ke[n]?p.resolve(Ke[n]):p.reject(new Error("Driver not found."));return M(i,c,l),i},e.prototype.getSerializer=function(n){var c=p.resolve(dt);return M(c,n),c},e.prototype.ready=function(n){var c=this,l=c._driverSet.then(function(){return c._ready===null&&(c._ready=c._initDriver()),c._ready});return M(l,n,n),l},e.prototype.setDriver=function(n,c,l){var i=this;Dt(n)||(n=[n]);var m=this._getSupportedDrivers(n);function v(){i._config.driver=i.driver()}function b(k){return i._extend(k),v(),i._ready=i._initStorage(i._config),i._ready}function S(k){return function(){var B=0;function W(){for(;B<k.length;){var K=k[B];return B++,i._dbInfo=null,i._ready=null,i.getDriver(K).then(b).catch(W)}v();var ae=new Error("No available storage method found.");return i._driverSet=p.reject(ae),i._driverSet}return W()}}var I=this._driverSet!==null?this._driverSet.catch(function(){return p.resolve()}):p.resolve();return this._driverSet=I.then(function(){var k=m[0];return i._dbInfo=null,i._ready=null,i.getDriver(k).then(function(B){i._driver=B._driver,v(),i._wrapLibraryMethodsWithReady(),i._initDriver=S(m)})}).catch(function(){v();var k=new Error("No available storage method found.");return i._driverSet=p.reject(k),i._driverSet}),M(this._driverSet,c,l),this._driverSet},e.prototype.supports=function(n){return!!jt[n]},e.prototype._extend=function(n){ht(this,n)},e.prototype._getSupportedDrivers=function(n){for(var c=[],l=0,i=n.length;l<i;l++){var m=n[l];this.supports(m)&&c.push(m)}return c},e.prototype._wrapLibraryMethodsWithReady=function(){for(var n=0,c=ft.length;n<c;n++)er(this,ft[n])},e.prototype.createInstance=function(n){return new e(n)},e}(),nr=new tr;s.exports=nr},{3:3}]},{},[4])(4)})})(vn);var Uo=vn.exports;const en=xr(Uo);class Tt{constructor(r){_e(this,"room");_e(this,"socket",br.getInstance());_e(this,"lastId",null);_e(this,"messageHolder",new Sr);_e(this,"chatUserService",_t.getInstance());_e(this,"_isActive",!1);this.room=r,this.socket.addListener("onmessage",this.onSocketMessageCome.bind(this)),this.loadCacheMessages(),this.getInstantMessages()}setIsActive(r){this._isActive=r}get isActive(){return this._isActive}onSocketMessageCome(r){const{cmd:o,data:s}=JSON.parse(r);if(o==pt.group){if(s.groupId!=this.room.id)return;const d=new we(s);if([te.text,te.image,te.tipText].includes(d.type)){this.messageHolder.isExist(d)?this.messageHolder.replaceById(d.id,d):this.messageHolder.addOne(d),this.messageHolder.notify();return}if(d.type==te.recall){this.messageHolder.removeById(d.id),this.messageHolder.notify();return}}if(o==pt.customer){const d=new we(s);if(d.id!=null&&d.id!=null&&this.socket.send(JSON.stringify({cmd:11,data:{msgId:d.id}})),d.type==te.tipText&&d.recvId==this.chatUserService.userId&&!this.messageHolder.isExist(d)){this.messageHolder.addOne(d),this.messageHolder.notify();return}if([te.text,te.image].includes(d.type)&&!this.messageHolder.isExist(d)){this.messageHolder.addOne(d),this.messageHolder.notify();return}if(d.type==te.recall){this.messageHolder.removeById(d.id),this.messageHolder.notify();return}}if(o==pt.kickedOut){this.onKickedOut();return}}onKickedOut(){this.socket.dispose()}onMessagesChanged(r,o){this.messageHolder.onMessagesChanged(r,o)}async loadCacheMessages(){const r=`chat_room_${this.room.id}_user_${this.chatUserService.userId}`,o=await en.getItem(r);this.messageHolder.addCache((o??[]).map(s=>new we(s))),this.messageHolder.notify(ye.LOAD_CACHE)}async saveToCaches(){const r=`chat_room_${this.room.id}_user_${this.chatUserService.userId}`;await en.setItem(r,this.messageHolder.messages.filter(o=>[te.instant,te.welcome,te.imagePlaceholder].includes(o.type)))}async sendTextMessage(r,o=te.text,s=!0){const d=await wr({content:r,groupId:this.room.id,type:o},this.room.type);return s&&(this.messageHolder.addOne(d),this.messageHolder.notify()),d}async sendImageMessage(r){var d,h,f;const o=new Date().getTime(),s=new we({id:o+"",sendId:this.chatUserService.userId,recvId:-1,content:"",type:te.imagePlaceholder,status:0,sendTime:o,actionId:"",groupId:this.room.id,customerId:-1,userHead:`/sys-upload/images/v2/avatar/${((d=this.chatUserService.userInfo)==null?void 0:d.avatarId)??1}.webp`,sendNickName:((h=this.chatUserService.userInfo)==null?void 0:h.nickname)??"",userVipLv:((f=this.chatUserService.userInfo)==null?void 0:f.vipLevel)??0});s.imagePlaceholder=r,this.messageHolder.addOne(s),this.messageHolder.notify(ye.LOAD_IMAGE_PLACEHOLDER);try{const y=await Ir(r);if(!y){this.messageHolder.removeOne(s),this.messageHolder.notify();return}const w=await this.sendTextMessage(JSON.stringify(y),te.image,!1);w.imagePlaceholder=r,this.messageHolder.replaceOne(s,w),this.messageHolder.sort(),this.messageHolder.notify(ye.LOAD_IMAGE)}catch{this.messageHolder.removeOne(s),this.messageHolder.notify()}}async getInstantMessages(){if(this.chatUserService.isVisistor)return;const r=await _r(this.room.id);this.messageHolder.setInstantMessages(r)}async getWelcomeMessage(){let r={};try{r=JSON.parse(sessionStorage.getItem(`chatRoom.${this.room.id}`)??"{}")}catch{}let o;this.chatUserService.isVisistor?o=await Cr(this.room.id):o=await Er(this.room.id),o&&r.sendTime&&(o.sendTime=r.sendTime),o&&(this.messageHolder.addWelcomeMsg(o),sessionStorage.setItem(`chatRoom.${this.room.id}`,JSON.stringify(o)))}sendInstantMessage(r){var f,y,w;const o=new Date().getTime(),s=o+1,d=new we({id:o+"",sendId:this.chatUserService.userId,recvId:-1,content:r.msgHeader??"",type:te.instant,status:-1,sendTime:o,actionId:"",groupId:this.room.id,customerId:-1,userHead:`/sys-upload/images/v2/avatar/${((f=this.chatUserService.userInfo)==null?void 0:f.avatarId)??1}.webp`,sendNickName:((y=this.chatUserService.userInfo)==null?void 0:y.nickname)??"",userVipLv:((w=this.chatUserService.userInfo)==null?void 0:w.vipLevel)??0}),h=new we({id:s+"",sendId:-1,recvId:-1,content:r.msgContent,type:te.instant,status:-1,sendTime:s,actionId:"",groupId:this.room.id,customerId:-1,userHead:"",sendNickName:"助手",userVipLv:-1});this.messageHolder.addOne(d),this.messageHolder.addOne(h),this.messageHolder.notify()}async editMsg(r,o,s){await Nr({content:r,groupId:this.room.id,msgId:o});const d=we.clone(s);d.content=r,this.messageHolder.replaceOne(s,d),this.messageHolder.notify()}async deleteMsg(r){await Tr({groupId:this.room.id,msgId:r.id}),this.messageHolder.removeOne(r),this.messageHolder.notify()}dispose(){console.log("chat.base.service,","disposed"),this.outRoom(),this.socket.removeListener("onmessage",this.onSocketMessageCome)}}class Vo extends Tt{constructor(){super(...arguments);_e(this,"action")}async init(){await this.getAction(),await this.loadMessagesFromApi(),this.messageHolder.notify()}async loadMessagesFromApi(){var s,d;if(!this.action)return;const o=await $o({actionId:(s=this.action)==null?void 0:s.id,pageSize:20,lastId:this.lastId??null});this.messageHolder.addEnd(o),this.lastId=((d=this.messageHolder.messages[0])==null?void 0:d.id)??null}async loadPreviousMessages(){await this.loadMessagesFromApi(),this.messageHolder.notify(ye.LOAD_OLD)}async getAction(){this.action=await Fo(this.room.id)}async sendTextMessage(o,s=te.text,d=!0){const h=await super.sendTextMessage(o,s,d);return this.action||this.getAction(),h}async sendImageMessage(o){await super.sendImageMessage(o),this.action||this.getAction()}async outRoom(){}}async function yn(t){return await lt(Re.chatApiUrl+"/group/joinGroup?groupId="+t,{headers:{accessToken:q.chatToken()}},{})}async function zo(t){try{return(await lt(Re.chatApiUrl+"/message/group/historyPage",{headers:{accessToken:q.chatToken()}},t)).data.datas.map(o=>new we(o))}catch(r){return console.error(r),[]}}async function xn(t){return kr(Re.chatApiUrl+"/group/quit/"+t,{headers:{accessToken:q.chatToken()}})}class Wo extends Tt{async init(){this.joinGroup()}async __joinGroup(){return this.chatUserService.isVisistor?rn(this.room.id):yn(this.room.id)}async joinGroup(){const{code:r,message:o}=await this.__joinGroup();if(r==604){q.navigate(-1),q.showError(o);return}r!=200&&r!=601&&q.showError(o),r==200&&this.socket.send(JSON.stringify({cmd:8})),await this.loadMessagesFromApi(),this.messageHolder.notify()}async __getMessages(){return this.chatUserService.isVisistor?Mr({groupId:this.room.id,pageSize:20,lastId:this.lastId??null}):zo({groupId:this.room.id,pageSize:20,lastId:this.lastId??null})}async loadMessagesFromApi(){var o;const r=await this.__getMessages();this.messageHolder.addEnd(r),this.lastId=((o=this.messageHolder.messages[0])==null?void 0:o.id)??null}async loadPreviousMessages(){await this.loadMessagesFromApi(),this.messageHolder.notify(ye.LOAD_OLD)}async outRoom(){await xn(this.room.id),this.socket.send(JSON.stringify({cmd:8}))}}async function Go(t){return((await It(Re.chatApiUrl+"/message/group/newMessageByLiveRoom?groupId="+t,{headers:{accessToken:q.chatToken()}})).data??[]).map(o=>new we(o))}async function Ko({groupId:t,lastId:r}){const{data:o}=await lt(Re.chatApiUrl+"/message/group/historyByLiveRoom",{headers:{accessToken:q.chatToken()}},{groupId:t,lastId:r});return(o??[]).map(s=>new we(s))}async function Yo(t){await It(Re.chatApiUrl+"/group/groupHeart/"+t,{headers:{accessToken:q.chatToken()}})}class xt extends Tt{constructor(){super(...arguments);_e(this,"intervalHeartBeat");_e(this,"stopCallInterval",!1)}init(){this.joinGroup().then(()=>{this.sendHeartBeat()})}async __joinGroup(){return this.chatUserService.isVisistor?rn(this.room.id):yn(this.room.id)}async joinGroup(){const{code:o,message:s}=await this.__joinGroup();if(o==604){q.navigate(-1),q.showError(s);return}o!=200&&o!=601&&q.showError(s),o==200&&this.socket.send(JSON.stringify({cmd:8})),await this.loadMessagesFromApi(),this.messageHolder.notify()}async sendHeartBeat(){this.intervalHeartBeat=setInterval(()=>{this.stopCallInterval||Yo(this.room.id)},3e3)}async __getLatestMessages(){return this.chatUserService.isVisistor?Rr(this.room.id):Go(this.room.id)}async loadMessagesFromApi(){var s;const o=await this.__getLatestMessages();this.messageHolder.addEnd(o),this.lastId=((s=this.messageHolder.messages[0])==null?void 0:s.id)??null}async __getPreviousMessages(){return Ko({groupId:this.room.id,lastId:this.lastId})}async loadPreviousMessages(){var s;const o=await this.__getPreviousMessages();this.messageHolder.addHead(o),this.lastId=((s=this.messageHolder.messages[0])==null?void 0:s.id)??null,this.messageHolder.notify(ye.LOAD_OLD)}onKickedOut(){super.onKickedOut(),clearInterval(this.intervalHeartBeat)}async outRoom(){await xn(this.room.id),this.socket.send(JSON.stringify({cmd:8}))}dispose(){super.dispose(),clearInterval(this.intervalHeartBeat)}}const Jo=({message:t})=>{const[r,o]=x.useState(""),[s,d]=x.useState(""),[h,f]=x.useState(!1),y=()=>f(!0),w=()=>f(!1),E=()=>{if(t.imagePlaceholder){const C=new FileReader;C.onloadend=()=>{d(C.result),o(C.result)},C.readAsDataURL(t.imagePlaceholder);return}let D="",p="";try{D=JSON.parse(t.content).originUrl,p=JSON.parse(t.content).thumbUrl}catch{D=t.content,p=t.content}o(D),d(p)};return x.useEffect(()=>{E()},[t]),u.jsxs("div",{className:"relative",children:[u.jsx(Ar,{src:s,alt:"image",onClick:y,aspectRatio:16/9,rootLoadingClassName:"min-w-[220px]"},s+t.id),t.type==te.imagePlaceholder?u.jsx("div",{className:"absolute w-full h-full top-0 left-0 flex-center bg-[#88888850] opacity-50 rounded-lg",children:u.jsx("span",{className:"img-loader"})}):u.jsx(Qo,{"aria-labelledby":"unstyled-modal-title","aria-describedby":"unstyled-modal-description",open:h,onClose:w,slots:{backdrop:Xo},children:u.jsx(qo,{children:u.jsx("div",{style:{overflowY:"auto",maxHeight:window.innerHeight+"px",scrollbarWidth:"none"},children:u.jsx(on,{onClick:()=>w(),src:r,alt:"Full Screen Image"})})})})]})},bn=x.forwardRef((t,r)=>{const{open:o,className:s,...d}=t;return u.jsx("div",{className:st({"base-Backdrop-open":o},s),ref:r,...d})});bn.displayName="Backdrop";const nt={50:"#F3F6F9",100:"#E5EAF2",200:"#DAE2ED",300:"#C7D0DD",400:"#B0B8C4",500:"#9DA8B7",600:"#6B7A90",700:"#434D5B",800:"#303740",900:"#1C2025"},Qo=Oe(gn)`
  position: fixed;
  z-index: 1300;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
`,Xo=Oe(bn)`
  z-index: -1;
  position: fixed;
  inset: 0;
  background-color: rgb(0 0 0 / 0.5);
  -webkit-tap-highlight-color: transparent;
`,qo=Oe("div")(({theme:t})=>wt`
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 500;
    text-align: start;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow: hidden;
    background-color: ${nt[900]};
    border-radius: 8px;
    border: 1px solid ${nt[700]};
    box-shadow: 0 4px 12px ${"rgb(0 0 0 / 0.5)"};
    outline: none;
    border: none;
    color: ${nt[50]};

    & .modal-title {
      margin: 0;
      line-height: 1.5rem;
      margin-bottom: 8px;
    }

    & .modal-description {
      margin: 0;
      line-height: 1.5rem;
      font-weight: 400;
      color: ${nt[400]};
      margin-bottom: 4px;
    }
  `),Sn=Dr({key:"ChatMenuItemProps",default:{open:!1,y:-500,x:-500}});function Zo({onEdit:t,onDelete:r,onBan:o}){const[{open:s,y:d,x:h,msg:f},y]=sn(Sn),w=async()=>{y({open:!1,y:-500,x:-500})},E=()=>{f&&t(f),w()},D=()=>{f&&r(f),w()},p=()=>{f&&o(f),w()};return u.jsxs("div",{children:[u.jsx("div",{className:`${s?"fixed top-0 left-0 w-screen h-screen z-[10000] bg-transparent":"w-0 h-0"}`,onTouchStart:w,onMouseDown:q.isPC()?w:void 0}),u.jsxs("div",{className:"popover-custom-class chat-msg-menu fixed px-3 pr-12 !py-3",style:{zIndex:100001,left:h>window.innerWidth-200?void 0:h,right:h<=window.innerWidth-200?void 0:window.innerWidth-h,top:d>window.innerHeight-300?void 0:d,bottom:d<=window.innerHeight-300?void 0:window.innerHeight-d,display:s?"":"none"},children:[(f==null?void 0:f.type)!=te.image&&u.jsxs("div",{onClick:E,className:"flex items-center gap-4 mb-3 chat-msg-menu-item",children:[u.jsx(Je,{color:"var(--text-color)",name:"ic_edit",className:"w-4 h-4"}),u.jsx("span",{className:"pl-1",children:fe.edit()})]}),u.jsxs("div",{onClick:D,className:"flex items-center gap-4 mb-3 chat-msg-menu-item",children:[u.jsx(Je,{color:"var(--text-color)",name:"ic_delete2",className:"w-4 h-4"}),u.jsx("span",{className:"pl-1",children:fe.delete()})]}),(f==null?void 0:f.sendId)!=_t.getInstance().userId&&u.jsxs("div",{onClick:p,className:"flex items-center gap-4 chat-msg-menu-item",children:[u.jsx("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"var(--text-color)",children:u.jsx("path",{d:"M510.976182 208.775954c89.87596 0 162.748664 68.00279 162.748664 151.891386l81.374332 0c0-125.823684-109.296265-227.835032-244.122997-227.835032-134.830825 0-244.12402 102.011348-244.12402 227.835032l81.373309 0C348.224448 276.778744 421.095106 208.775954 510.976182 208.775954L510.976182 208.775954zM782.227026 411.314857 239.727385 411.314857c-29.964452 0-54.253648 22.672372-54.253648 50.621934l0 379.733581c0 27.973098 24.288173 50.646494 54.253648 50.646494l542.499641 0 0.004093 0c29.953196 0.004093 54.247508-22.673395 54.247508-50.646494L836.478627 461.935768C836.478627 433.987229 812.184315 411.314857 782.227026 411.314857L782.227026 411.314857zM791.107277 842.848197c0 5.759167-4.713348 10.471492-10.474562 10.471492L243.891218 853.319689c-5.762237 0-10.471492-4.712325-10.471492-10.471492L233.419725 468.452181c0-5.759167 4.709255-10.472516 10.471492-10.472516L780.632715 457.979666c5.761214 0 10.474562 4.713348 10.474562 10.472516L791.107277 842.848197 791.107277 842.848197zM510.978229 537.89067l-0.002047-0.004093c-44.954865 0-81.377402 33.991162-81.377402 75.947739 0 28.028357 16.48137 52.267411 40.691771 65.404616l0 72.262814c0 21.823028 18.222013 39.545668 40.688701 39.545668 22.458501 0 40.686654-17.721617 40.686654-39.545668l0-72.262814c24.209378-13.137205 40.687678-37.376259 40.687678-65.404616C592.349491 571.881832 555.929 537.89067 510.978229 537.89067L510.978229 537.89067zM510.978229 537.89067"})}),u.jsx("span",{children:fe.change_user_permission()})]})]})]})}function tn({message:t}){var r;return[te.image,te.imagePlaceholder].includes(t.type)?u.jsx(Jo,{message:t}):u.jsx("span",{className:`${(r=t.content)!=null&&r.includes(" ")?"break-words":"break-all"}`,children:t.content})}function es({message:t}){const r=jr(t.content??"").body.innerHTML;return u.jsx("div",{className:"text-white",style:{width:"100%",whiteSpace:"normal",wordBreak:"break-all",wordWrap:"break-word",textAlign:"left"},dangerouslySetInnerHTML:{__html:r}})}function ts({message:t,className:r="",myId:o,roomType:s}){const[d,h]=sn(Sn),f=y=>{if(y.preventDefault(),y.stopPropagation(),!_t.getInstance().isAdministrator||s==rt.customer||d.open)return;let w,E=-500;y.touches&&y.touches[0]?(w=y.touches[0].pageX,E=y.touches[0].pageY):(w=y.clientX,E=y.clientY),h({open:!0,y:E,x:w,msg:t})};return t.type==te.welcome?u.jsxs("div",{className:"flex "+r,id:t.id,children:[u.jsx(Ft,{src:t.userHead,fallback:"/assets/dummy/avatar1.png",alt:"",className:"w-10 h-10 mr-2",style:{borderRadius:"50%"}}),u.jsxs("div",{className:"max-w-[70%] flex flex-col",children:[u.jsxs("div",{className:"flex items-center text-2xs gap-1",children:[u.jsx("span",{className:"ml-1 text-[var(--text-label)]",children:"助手"}),u.jsx("span",{className:"bg-[var(--active)] text-black rounded-full px-2 pt-[3px] pb-[1px] leading-none flex items-center justify-center text-xs font-bold",children:t.sendNickName!=null&&t.sendNickName!=""?t.sendNickName:"美女Abby"})]}),u.jsxs("div",{className:"rounded-lg bg-[var(--box-bg)] px-3 py-2 mt-1",children:[u.jsx(es,{message:t}),u.jsx("div",{className:"text-[var(--text-label)] text-xs",children:new Date(t.sendTime??0).toLocaleString()})]})]})]}):t.sendId!=o?u.jsxs("div",{className:"flex "+r,id:t.id,children:[u.jsx(Ft,{src:t.userHead?t.userHead:"/assets/dummy/avatar1.png",fallback:"/assets/dummy/avatar1.png",alt:"",className:"w-10 h-10 mr-2",style:{borderRadius:"50%"},onContextMenu:f,onTouchStart:f}),u.jsxs("div",{className:"max-w-[70%] flex flex-col",onContextMenu:f,onTouchStart:f,children:[u.jsxs("div",{className:"flex items-center text-2xs gap-1",children:[u.jsx("span",{className:"ml-1 text-[var(--text-label)]",children:t.sendNickName}),u.jsx("span",{className:"bg-[var(--active)] text-black rounded-full px-2 pt-[3px] pb-[1px] leading-none flex items-center justify-center text-xs font-bold",children:t.type==te.instant?"美女Abby":`VIP ${t.userVipLv}`})]}),u.jsxs("div",{className:"rounded-lg bg-[var(--box-bg)] px-3 py-2 mt-1",children:[u.jsx(tn,{message:t}),u.jsx("div",{className:"text-[var(--text-label)] text-xs",children:new Date(t.sendTime??0).toLocaleString()})]})]})]}):u.jsxs("div",{className:"flex "+r,id:t.id,children:[u.jsx("div",{className:"grow"}),u.jsxs("div",{className:"max-w-[70%] flex flex-col",onContextMenu:f,onTouchStart:f,children:[u.jsxs("div",{className:"flex items-center justify-end text-2xs",children:[u.jsx("span",{className:"mr-1 text-[var(--text-label)]",children:t.sendNickName}),u.jsxs("span",{className:"bg-[var(--active)] text-black rounded-full px-2 pt-[3px] pb-[1px] leading-none flex items-center justify-center text-xs font-bold",children:["VIP ",t.userVipLv]})]}),u.jsxs("div",{className:"flex flex-col items-end rounded-lg bg-[var(--box-bg)] px-3 py-2 mt-1",children:[u.jsx(tn,{message:t}),u.jsx("div",{className:"text-[var(--text-label)] text-xs",children:new Date(t.sendTime??0).toLocaleString()})]})]}),u.jsx(on,{src:t.userHead?t.userHead:"/assets/dummy/avatar3.png",alt:"",className:"w-10 h-10 ml-2",style:{borderRadius:"50%"},onContextMenu:f,onTouchStart:f})]})}function ns({message:t,className:r="",myId:o,roomType:s}){switch(t.type){case te.tipText:return u.jsx("div",{className:"center-flex",id:t.id,children:u.jsx("span",{className:"ml-1 text-[var(--text-label)]",children:t.content})});default:return u.jsx(ts,{message:t,className:r,myId:o,roomType:s})}}const rs=x.memo(ns);function os({userId:t,onClose:r,open:o,imgRole:s,msgRole:d}){const[h,f]=x.useState(d==0),[y,w]=x.useState(s==0),[E,D]=x.useState(!1),p=x.useMemo(()=>h!=(d==0)||y!=(s==0),[h,y,s,d]),C=async()=>{if(!t||!p)return;D(!0),await Lr(t,h?1:0,y?1:0)&&q.showToast(fe.success_2()),D(!1),r()};return x.useEffect(()=>{f(d!=1),w(s!=1)},[t,s,d]),u.jsx(an,{title:fe.change_user_permission(),open:o,onClose:r,className:"w-[90%] max-w-[340px]",headerClassName:"!border-none",children:u.jsxs("div",{className:"px-3 pt-3",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx($t,{checked:h,onChange:M=>f(M.target.checked),size:"small",sx:{color:"var(--active)",padding:"0px !important","&.Mui-checked":{color:"var(--active)"},"& .MuiSvgIcon-root":{fontSize:24}},id:"checkbox-ban-send-text"}),u.jsx("label",{htmlFor:"checkbox-ban-send-text",children:fe.disable_text_msg()})]}),u.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[u.jsx($t,{checked:y,onChange:M=>w(M.target.checked),size:"small",sx:{color:"var(--active)",padding:"0px !important","&.Mui-checked":{color:"var(--active)"},"& .MuiSvgIcon-root":{fontSize:24}},id:"checkbox-ban-send-msg"}),u.jsx("label",{htmlFor:"checkbox-ban-send-msg",children:fe.disable_img_msg()})]}),u.jsxs("div",{className:"flex gap-9 px-2 pt-7",children:[u.jsx("button",{className:"rounded-md w-1/2 p-2 text-[var(--active)] border border-[var(--active)] text-center",onClick:r,children:fe.cancel()}),u.jsxs("button",{onClick:C,className:`rounded-md w-1/2 p-2 text-black capitalize font-bold text-center flex-center ${p?"bg-[var(--active)]":"bg-[var(--disable)]"}`,rel:"noreferrer",children:[fe.confirm(),E&&u.jsx("span",{className:"loader w-4 min-w-4 h-4 inline-block"})]})]})]})})}const ss=Or(()=>Pr(()=>import("./chat-menu-sSQ75ZY7.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)).ChatMenu,bt=ot.getInstance(),as={nickname:"",errors:{nickname:""}},is=(t,r)=>{switch(r.type){case"change":return t.errors[r.field]="",{...t,[r.field]:r.value};default:return t}};function gs({room:t,mode:r}){var Ce,Ee,Te;const{userInfo:o}=Br(Hr),s=x.useRef(ot.getInstance().getServiceByRoom(t)),d=x.useRef(null),[h,f]=x.useState(((Ce=s.current)==null?void 0:Ce.messageHolder.messages)??[]),[y,w]=x.useState(((Ee=s.current)==null?void 0:Ee.messageHolder.instantMessages)??[]),[E,D]=x.useState(!1),[p,C]=x.useState(!1),[M,j]=x.useReducer(is,as),[$,F]=x.useState(!1),[G,H]=x.useState(!1),[N,R]=x.useState(""),[g,A]=x.useState({height:0,offsetTop:0}),[T,O]=x.useState(ot.getInstance().getServiceByRoom(t)!=null),[Y,J]=x.useState(!1),[z,Q]=x.useState(),[ee,le]=x.useState(),[ie,U]=x.useState({userId:void 0,imgRole:void 0,msgRole:void 0}),P=x.useRef({old:0,new:0}),se=x.useRef(!1),xe=x.useRef(""),ne=x.useRef(null),re=x.useRef(!1),ce=async()=>{var _;se.current=!0,s.current&&(xe.current=(_=h[0])==null?void 0:_.id,await s.current.loadPreviousMessages()),setTimeout(()=>se.current=!1,200)},be=_=>{var L;return R(_+(((L=ne.current)==null?void 0:L.value)??""))},Ae=async({e:_,keepFocus:L=!1})=>{var me,V,X,Ie;if((me=s.current)!=null&&me.chatUserService.isVisistor){q.navigate(Vt.login);return}if(o&&(o.updatedNickname===0||!o.updatedNickname||o.nickname==""||!o.nickname)){(V=document.getElementById("nickname"))==null||V.focus(),D(!0);return}if(re.current)return;re.current=!0,_&&_.stopPropagation&&_.stopPropagation();const Z=N.trim();if(R(""),ne.current&&(L&&!G?ne.current.focus():ne.current.blur()),!Z.length){re.current=!1;return}try{if(z){if(z.content==N){R(z.content??""),re.current=!1;return}await((X=s.current)==null?void 0:X.editMsg(Z,z.id,z)),Q(void 0),R(""),re.current=!1;return}await((Ie=s.current)==null?void 0:Ie.sendTextMessage(Z))}catch(ke){console.log(ke),q.showInfoToast(ke.message),Q(void 0),R("")}finally{re.current=!1}},ze=async()=>{var _;if(ee)try{await((_=s.current)==null?void 0:_.deleteMsg(ee)),q.showToast(fe.success_2())}catch(L){console.log(L),q.showInfoToast(L.message)}finally{le(void 0)}},We=async _=>{const L=await Vr(_.sendId);L&&U({userId:_.sendId,imgRole:L.imgRole,msgRole:L.msgRole})},Pe=_=>{_.key==="Enter"&&Ae({keepFocus:!0})},Be=async _=>{var L;if(_.msgType==zt.link){window.open(_.msgContent,"_blank");return}if(_.msgType==zt.window)return at.emit(it.showInstantMessageDialog,_);H(!1);try{await((L=s.current)==null?void 0:L.sendInstantMessage(_))}catch(Z){q.showInfoToast(Z.message)}},He=async _=>{var L,Z,me;if(o&&(o.updatedNickname===0||!o.updatedNickname||o.nickname==""||!o.nickname)){(L=document.getElementById("nickname"))==null||L.focus(),D(!0);return}if(H(!1),(Z=s.current)!=null&&Z.chatUserService.isVisistor){q.navigate(Vt.login);return}try{if(!_[0])return;await((me=s.current)==null?void 0:me.sendImageMessage(_[0]))}catch(V){q.showInfoToast(V.message)}};function Se(_="instant"){var L;(L=s.current)!=null&&L.isActive&&(O(!0),d.current&&d.current.scrollTo({top:d.current.scrollHeight,behavior:_}),t&&bt.changeUnreadCount(t,0))}const Ge=_=>{d.current&&_>0&&d.current.scrollTo({top:_,behavior:"instant"})},De=(_,L)=>{var Z;f([..._]),L!=ye.LOAD_CACHE&&((Z=s.current)==null||Z.saveToCaches()),L==ye.LOAD_CACHE&&setTimeout(Se,200),L==ye.LOAD_NEW&&(Se(),setTimeout(()=>Se("smooth"),200)),(L==ye.LOAD_IMAGE_PLACEHOLDER||L==ye.LOAD_IMAGE)&&(Se(),setTimeout(()=>Se("smooth"),200)),L==ye.LOAD_OLD},Ne=_=>w(_),de=()=>{if(s.current){s.current.onMessagesChanged(De,Ne);return}t.type==rt.group&&(s.current=new Wo(t)),t.type==rt.customer&&(s.current=new Vo(t)),t.type==rt.chatRoom&&(s.current=new xt(t)),s.current&&(ot.getInstance().roomsService.set(t,s.current),s.current.onMessagesChanged(De,Ne),s.current.init())},ge=_=>{const L=_.currentTarget.scrollTop;P.current={old:P.current.new,new:L},P.current.new<P.current.old&&L<20&&!se.current&&ce()},Fe=()=>{A({height:(visualViewport==null?void 0:visualViewport.height)||0,offsetTop:(visualViewport==null?void 0:visualViewport.offsetTop)??0})};x.useEffect(()=>{var _,L,Z;return de(),(_=s.current)==null||_.setIsActive(!0),(L=s.current)==null||L.getWelcomeMessage(),s.current instanceof xt&&(s.current.stopCallInterval=!1),bt.onListRoomsChanged(de),Se(),setTimeout(()=>J(!0),200),(Z=window.visualViewport)==null||Z.addEventListener("resize",Fe),()=>{var me,V;(me=s.current)==null||me.setIsActive(!1),bt.off(de),s.current instanceof xt&&(s.current.stopCallInterval=!0),(V=window.visualViewport)==null||V.removeEventListener("resize",Fe)}},[]),x.useEffect(()=>{var L;const _=document.getElementById(xe.current);!d.current||!_||xe.current==((L=h[0])==null?void 0:L.id)||(Ge(_.offsetTop-d.current.offsetTop),xe.current="")},[h]);const he=_=>{const{name:L,value:Z}=_.target;F(!1),j({type:"change",field:L,value:Z})},pe=async()=>{try{if(M.nickname.length>0){const _={nickname:M==null?void 0:M.nickname};C(!0),await zr(_),at.emit(it.refreshUserInfo),q.showToast(fe.success())}}catch(_){q.showInfoToast(_.message)}finally{C(!1),D(!1)}},je=()=>{const _={height:"fit-content"};return _.top=g.offsetTop?g.offsetTop+52:"30%",_.transform="translate(-50%, 0)",q.isIosApp()&&(_.top=void 0,_.bottom=0,_.transform="translate(-50%, -50%)"),_};return u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{paddingTop:r=="mobile"?64:0},className:"max-w-[800px] w-full mx-auto bg-[var(--page-mob-bg)] pc:relative overflow-hidden overflow-y-auto hide-scrollbar hide-scrollbar-all grow chat-content-el",children:u.jsxs("div",{ref:d,style:{height:"100%"},className:"overflow-y-auto hide-scrollbar relative",id:"msgListRef",onScroll:ge,children:[u.jsxs("div",{className:"p-3 flex-col",style:{visibility:(T||h.length>0)&&Y?"visible":"hidden"},children:[u.jsx("div",{className:"grow"}),h.map((_,L)=>{var Z;return u.jsx(rs,{message:_,className:"mt-3",myId:((Z=s.current)==null?void 0:Z.chatUserService.userId)??-1,roomType:t.type},_.sendTime+"_"+_.sendId)})]}),T||h.length>0?u.jsx(u.Fragment,{}):u.jsx(cs,{})]})}),u.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-[var(--box-bg)] pt-1",children:[y.length>0?u.jsx("div",{className:"w-screen pl-3",children:u.jsx("div",{className:"flex items-center overflow-x-auto hide-scrollbar w-full",children:y.map((_,L)=>u.jsx("div",{onClick:()=>Be(_),className:"quick-chat-item text-sm rounded-full mr-3 px-5 py-2 text-nowrap whitespace-nowrap",children:_.msgHeader},"instant_msg_"+L))})}):null,!!z&&u.jsxs("div",{className:"flex-center w-full gap-3 px-3 pt-2",children:[u.jsx("div",{className:"w-8 flex-center",children:u.jsx(Je,{color:"var(--text-color)",name:"ic_edit",className:"w-5 h-5"})}),u.jsxs("div",{className:"grow text-sm pl-5",children:[u.jsx("div",{className:"edit-msg-title",children:fe.edit_message()}),u.jsx("div",{className:"text-[var(--text-color)]",children:z.content})]}),u.jsx("div",{onClick:()=>{Q(void 0),R("")},className:"w-11 min-w-11 flex-center",children:u.jsx(Je,{color:"var(--text-color)",name:"ic_close",className:"w-4 h-4"})})]}),u.jsxs("div",{className:"flex items-center chat-sender",children:[u.jsx("button",{onClick:()=>H(!G),className:"circle flex-center arrow",children:u.jsx(Je,{color:"var(--chat-menu-arrow-color)",name:"ic_chevon_right",className:`w-4 h-4 ${G?"rotate-90":"-rotate-90"}`})}),u.jsx("div",{className:"border border-white border-opacity-10 input-all rounded-full px-5 py-2.5 w-full ml-3 mr-4",children:u.jsx("input",{ref:ne,value:N,onChange:_=>R(_.target.value),onKeyDown:Pe,placeholder:fe.enter_the_question_to_ask(),className:"input-all w-full","data-test":"input-chat"})}),u.jsx("button",{onClick:_=>Ae({e:_,keepFocus:!0}),"data-test":"send-btn",className:"w-11 h-11 min-w-11 circle sender-btn flex-center send-btn-icon",children:u.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"send-btn-icon",width:28,height:28,viewBox:"0 0 32 32",children:u.jsx("path",{d:"M29.919 6.163l-4.225 19.925c-0.319 1.406-1.15 1.756-2.331 1.094l-6.438-4.744-3.106 2.988c-0.344 0.344-0.631 0.631-1.294 0.631l0.463-6.556 11.931-10.781c0.519-0.462-0.113-0.719-0.806-0.256l-14.75 9.288-6.35-1.988c-1.381-0.431-1.406-1.381 0.288-2.044l24.837-9.569c1.15-0.431 2.156 0.256 1.781 2.013z"})})})]}),u.jsx(Fr,{LazyComponent:ss,fallback:u.jsx("div",{}),lazyComponentProps:{open:G,onClose:()=>H(!1),onSelectEmoji:_=>be(_.emoji),onSelectFile:He}})]}),u.jsx(an,{open:E,onClose:()=>D(!1),showTitle:!0,title:fe.update_nickname(),className:"!m-w-[200px] max-w-[400px] !w-[80%] text-black flex flex-col justify-center",customStyles:je(),children:u.jsx(u.Fragment,{children:u.jsxs("div",{className:"relative p-5 pb-2 pt-5 flex flex-col items-center justify-center gap-1",children:[u.jsx("input",{disabled:p,type:"text",id:"nickname",name:"nickname",value:M.nickname,onChange:he,placeholder:fe.please_set_nickname_first(),autoComplete:"off",className:"auth input-all input-all__border mt-2 px-2 py-2 w-full"}),$&&M.errors.nickname&&u.jsx("p",{className:"error",children:M.errors.nickname}),u.jsx($r,{loading:p,disable:!(((Te=M==null?void 0:M.nickname)==null?void 0:Te.length)>0),title:fe.update(),onClick:()=>pe(),className:"uppercase mt-7"})]})})}),u.jsx(Oo,{}),u.jsx(Zo,{onEdit:_=>{Q(_),R(_.content??"")},onDelete:le,onBan:We}),u.jsx(Ur,{content:fe.ask_delete_msg(),onClose:()=>le(void 0),onConfirm:ze,open:!!ee}),u.jsx(os,{userId:(ie==null?void 0:ie.userId)??"",open:ie.userId!=null,imgRole:ie.imgRole,msgRole:ie.msgRole,onClose:()=>U({userId:void 0,imgRole:void 0,msgRole:void 0})})]})}function cs(){return u.jsx("div",{className:"p-3 flex-col absolute w-full h-full top-0 left-0 gap-3",children:[0,1,2,3,4,5,6,7].map((t,r)=>u.jsxs("div",{className:`flex gap-3 py-1 ${r%3==0?"items-start":"items-end flex-row-reverse"}`,children:[u.jsx(Ut,{sx:{bgcolor:"var(--box-bg)"},variant:"circular",width:40,height:40}),u.jsx(Ut,{variant:"rounded",sx:{bgcolor:"var(--box-bg)"},height:r%2?60:100,width:"60%"})]},r))})}export{gs as C};
