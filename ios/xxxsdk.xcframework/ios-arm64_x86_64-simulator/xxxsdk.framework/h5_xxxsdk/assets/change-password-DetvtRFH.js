import{u as G,j as e,N as q,f as h,T as o,R as $,v as z,r as l,H as p,M as u,ay as U,az as W,F as J,aA as K,aB as v,aC as Q,aD as X,aE as S,aF as E,aG as Y}from"./index-BRyeyo8a.js";import{S as Z}from"./sucess-view-Cd-dyNf2.js";import{u as I}from"./useSetupConfig-DrTvWtbQ.js";const ee={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:"",errors:{oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""}},se=(a,i)=>{switch(i.type){case"change":return a.errors[i.field]="",{...a,[i.field]:i.value};default:return a}};function te(){const a=G();return e.jsx(q,{title:a.pathname==h.changePassword?o.login_password():o.transaction_password(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt ",children:e.jsx(ae,{})})})}function ae(){const{userInfo:a}=$(z),{needBind:i,formConf:r,setFormConf:F}=I(),[O,j]=l.useState(!1),[P,C]=l.useState(!1),[s,T]=l.useReducer(se,ee),[R,k]=l.useState(!1),[V,A]=l.useState(!1),[x,y]=l.useState(0),b=l.useRef(null),[m,_]=l.useState({isPhone:!1,open:!1}),[c,M]=l.useState({oldPassword:!1,newPassword:!1,newPasswordConfirm:!1}),g=t=>{M(Object.assign({},{oldPassword:!1,newPassword:!1,newPasswordConfirm:!1},{[t]:!c[t]}))},f=t=>{const{name:d,value:n}=t.target;C(!1),T({type:"change",field:d,value:n})},N=()=>{s.errors={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""},r.verifyOldPass&&!s.oldPassword&&(s.errors.oldPassword=o.current_password_is_required()),v.test(s.newPassword)||(s.errors.newPassword=o.password_rule()),v.test(s.newPasswordConfirm)||(s.errors.newPasswordConfirm=o.password_rule()),s.newPasswordConfirm!=s.newPassword&&(s.errors.newPasswordConfirm=o.password_confirm_not_match()),(r.verifyPassPhone||r.verifyPassEmail)&&!s.otp&&(s.errors.otp=o.otp_is_required());const t=!Object.values(s.errors).some(d=>d!="");return k(t),t},B=async()=>{var t,d;if(!(x>0))try{const n=Q.CHANGE_PASSWORD;await X({authenType:r.usePhone?S.PHONE:S.EMAIL,authenValue:r.usePhone?a==null?void 0:a.phone:a==null?void 0:a.email,otpType:n});let w=60;y(w),b.current=setInterval(()=>{y(--w),w<=0&&clearInterval(b.current)},1e3)}catch(n){const w=((d=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:d.message)??"";p.showToast(w.replace((a==null?void 0:a.phone)??"","").replace((a==null?void 0:a.email)??"","").trim(),"ic_error")}},H=async()=>{var t,d;if(!N()){C(!0);return}if(s.oldPassword==s.newPassword){p.showToast(o.new_password_and_old_must_differ(),"ic_error");return}j(!0);try{const n={newPwd:E(s.newPassword),oldPwd:E(s.oldPassword)};r.verifyPassEmail&&!r.usePhone&&(n.email=(a==null?void 0:a.email)??"",n.otp=s.otp),r.verifyPassPhone&&r.usePhone&&(n.phone=(a==null?void 0:a.phone)??"",n.otp=s.otp),await Y(n),A(!0)}catch(n){const w=((d=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:d.message)??"";p.showToast(w.trim(),"ic_error")}finally{j(!1)}},L=()=>{p.navigate(m.isPhone?h.changePhone:h.changeEmail)},D=()=>{p.navigate(h.security),_({...m,open:!1})};return l.useEffect(()=>{if(i.phoneFundPassword||i.emailFundPassword){_({open:!0,isPhone:i.phoneFundPassword});return}_({open:!1,isPhone:i.phoneFundPassword})},[i]),l.useEffect(()=>{N()},[s.oldPassword,s.newPassword,s.newPasswordConfirm,s.otp]),V?e.jsx(Z,{msg:o.login_password_has_been_changed(),onClick:()=>p.navigate(h.home)}):e.jsxs(e.Fragment,{children:[r.verifyOldPass&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.old_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.oldPassword?"text":"password",id:"oldPassword",name:"oldPassword",value:s.oldPassword,onChange:f,autoComplete:"off",placeholder:o.enter_login_pass_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(u,{name:c.oldPassword?"ic_eye_open":"ic_eye_close",onClick:()=>g("oldPassword"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.oldPassword&&e.jsx("p",{className:"error",children:s.errors.oldPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.new_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.newPassword?"text":"password",id:"newPassword",name:"newPassword",value:s.newPassword,onChange:f,autoComplete:"off",placeholder:o.enter_new_passowrd_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(u,{name:c.newPassword?"ic_eye_open":"ic_eye_close",onClick:()=>g("newPassword"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.newPassword&&e.jsx("p",{className:"error",children:s.errors.newPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.confirm_password()]}),e.jsxs("div",{className:"input-all input-all__border mt-2 px-2 w-full flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.newPasswordConfirm?"text":"password",id:"newPasswordConfirm",name:"newPasswordConfirm",value:s.newPasswordConfirm,onChange:f,autoComplete:"off",placeholder:o.enter_new_passowrd_hint_again(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(u,{name:c.newPasswordConfirm?"ic_eye_open":"ic_eye_close",onClick:()=>g("newPasswordConfirm"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.newPasswordConfirm&&e.jsx("p",{className:"error",children:s.errors.newPasswordConfirm})]}),r.canUsePassOtp&&(r.verifyPassEmail||r.verifyPassPhone)&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",r.usePhone?o.sms_verification_code():o.email_verification_code()]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[#b1f600] pl-2",children:[" ",r.usePhone?U((a==null?void 0:a.phone)??""):W((a==null?void 0:a.email)??"")]}),r.showSwitch&&e.jsxs("span",{className:"flex items-center justify-center text-sm gap-2",onClick:()=>F({...r,usePhone:!r.usePhone}),children:[e.jsx(u,{color:"#bbbbbb",name:"ic_change",className:"w-4 h-3"}),e.jsx("span",{className:"text-label",children:r.usePhone?"E-mail":o.phone_number()})]})]}),e.jsxs("div",{className:"w-full rounded-md px-3 py-2.5 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",value:s.otp,name:"otp",id:"otp",autoComplete:"off",onChange:f,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:B,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:x>0?`${o.resend()}(${x})`:o.get_a_verification_code()})]})]}),e.jsx(J,{title:o.confirm(),onClick:H,className:"mt-9 uppercase",disable:O,useDisableStyle:!R}),e.jsx(K,{content:"",onClose:D,onConfirm:L,open:m.open,children:e.jsxs("div",{children:[e.jsx("p",{className:"text-center pt-3",children:m.isPhone?o.bind_phone_confirm_title():o.bind_email_confirm_title()}),e.jsx("p",{className:"text-center pt-2 text-[var(--text-content-color)] text-xs",children:m.isPhone?o.bind_phone_confirm_title_content():o.bind_email_confirm_title_content()})]})})]})}export{te as ChangePasswordView};
