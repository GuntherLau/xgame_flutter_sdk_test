import{u as D,j as e,N as B,f as h,T as o,R as $,v as q,r as l,H as m,M as f,ay as G,az as U,F as z,aA as W,aC as J,aD as K,aE as N,aH as Q}from"./index-BRyeyo8a.js";import{S as X}from"./sucess-view-Cd-dyNf2.js";import{u as Y}from"./useSetupConfig-DrTvWtbQ.js";const Z={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:"",errors:{oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""}},I=(a,i)=>{switch(i.type){case"change":return a.errors[i.field]="",{...a,[i.field]:i.value};default:return a}};function ne(){const a=D();return e.jsx(B,{title:a.pathname==h.changePassword?o.login_password():o.transaction_password(),className:"max-w-[800px] mx-auto ",children:e.jsx("div",{className:" p-5 pt  overflow-hidden overflow-y-auto hide-scrollbar h-full",children:e.jsx(ee,{})})})}function ee(){const{userInfo:a}=$(q),{needBind:i,formConf:n,setFormConf:F}=Y(),[S,j]=l.useState(!1),[P,y]=l.useState(!1),[s,E]=l.useReducer(I,Z),[T,O]=l.useState(!1),[M,R]=l.useState(!1),[x,C]=l.useState(0),_=l.useRef(null),[c,k]=l.useState({oldPassword:!1,newPassword:!1,newPasswordConfirm:!1}),[p,g]=l.useState({isPhone:!1,open:!1}),b=t=>{k(Object.assign({},{oldPassword:!1,newPassword:!1,newPasswordConfirm:!1},{[t]:!c[t]}))},u=t=>{const{name:d,value:r}=t.target;if(!/^\d{0,6}$/.test(r)){t.target.value=s[d];return}y(!1),E({type:"change",field:d,value:r})},v=()=>{s.errors={oldPassword:"",newPassword:"",newPasswordConfirm:"",otp:""},n.verifyOldFunPass&&!s.oldPassword&&(s.errors.oldPassword=o.current_password_is_required()),s.newPassword.length<6&&(s.errors.newPassword=o.trans_password_rule()),s.newPasswordConfirm.length<6&&(s.errors.newPasswordConfirm=o.trans_password_not_match()),s.newPasswordConfirm!=s.newPassword&&(s.errors.newPasswordConfirm=o.password_confirm_not_match()),(n.verifyFundPassPhone||n.verifyFundPassEmail)&&!s.otp&&(s.errors.otp=o.otp_is_required());const t=!Object.values(s.errors).some(d=>d!="");return O(t),t},L=async()=>{var t,d;if(!(x>0))try{const r=J.CHANGE_FUND_PWD;await K({authenType:n.usePhone?N.PHONE:N.EMAIL,authenValue:n.usePhone?a==null?void 0:a.phone:a==null?void 0:a.email,otpType:r});let w=60;C(w),_.current=setInterval(()=>{C(--w),w<=0&&clearInterval(_.current)},1e3)}catch(r){const w=((d=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:d.message)??"";m.showToast(w.replace((a==null?void 0:a.phone)??"","").replace((a==null?void 0:a.email)??"","").trim())}},V=async()=>{var t,d;if(!v()){y(!0);return}if(s.oldPassword==s.newPassword){m.showToast(o.new_password_and_old_must_differ());return}j(!0);try{const r={newFundPwd:s.newPassword,oldFundPwd:s.oldPassword};n.verifyFundPassEmail&&!n.usePhone&&(r.email=(a==null?void 0:a.email)??"",r.otp=s.otp),n.verifyFundPassPhone&&n.usePhone&&(r.phone=(a==null?void 0:a.phone)??"",r.otp=s.otp),await Q(r),R(!0)}catch(r){const w=((d=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:d.message)??"";m.showToast(w.trim())}finally{j(!1)}},A=()=>{m.navigate(p.isPhone?h.changePhone:h.changeEmail)},H=()=>{m.navigate(h.security),g({...p,open:!1})};return l.useEffect(()=>()=>{clearInterval(_.current)},[]),l.useEffect(()=>{v()},[s.oldPassword,s.newPassword,s.newPasswordConfirm,s.otp]),l.useEffect(()=>{if(console.log(i),i.phoneFundPassword||i.emailFundPassword){g({open:!0,isPhone:i.phoneFundPassword});return}g({open:!1,isPhone:i.phoneFundPassword})},[i]),M?e.jsx(X,{msg:o.trading_password_has_been_changed(),onClick:()=>m.navigate(h.home)}):e.jsxs(e.Fragment,{children:[n.verifyOldFunPass&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.old_password()]}),e.jsxs("div",{className:"bg-[#1b1b1e] mt-2 px-2 rounded-md w-full border-[#333239] border flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.oldPassword?"text":"password",inputMode:"numeric",maxLength:6,id:"oldPassword",name:"oldPassword",value:s.oldPassword,onChange:u,autoComplete:"off",placeholder:o.enter_original_trans_pass_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(f,{name:c.oldPassword?"ic_eye_open":"ic_eye_close",onClick:()=>b("oldPassword"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.oldPassword&&e.jsx("p",{className:"error",children:s.errors.oldPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.new_password()]}),e.jsxs("div",{className:"bg-[#1b1b1e] mt-2 px-2 rounded-md w-full border-[#333239] border flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.newPassword?"text":"password",inputMode:"numeric",maxLength:6,id:"newPassword",name:"newPassword",value:s.newPassword,onChange:u,autoComplete:"off",placeholder:o.enter_new_trans_passowrd_hint(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(f,{name:c.newPassword?"ic_eye_open":"ic_eye_close",onClick:()=>b("newPassword"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.newPassword&&e.jsx("p",{className:"error",children:s.errors.newPassword})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"password",className:"text-label ",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"* "}),o.confirm_password()]}),e.jsxs("div",{className:"bg-[#1b1b1e] mt-2 px-2 rounded-md w-full border-[#333239] border flex items-center justify-center gap-3 input-login-register",children:[e.jsx("input",{type:c.newPasswordConfirm?"text":"password",inputMode:"numeric",maxLength:6,id:"newPasswordConfirm",name:"newPasswordConfirm",value:s.newPasswordConfirm,onChange:u,autoComplete:"off",placeholder:o.enter_new_trans_passowrd_hint_again(),className:"security bg-transparent placeholder:text-[#57575c] placeholder:text-xs py-2 outline-none grow"}),e.jsx(f,{name:c.newPasswordConfirm?"ic_eye_open":"ic_eye_close",onClick:()=>b("newPasswordConfirm"),color:"#444449",className:"w-4 h-4"})]}),P&&s.errors.newPasswordConfirm&&e.jsx("p",{className:"error",children:s.errors.newPasswordConfirm})]}),n.canUseFundOtp&&(n.verifyFundPassPhone||n.verifyFundPassEmail)&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("label",{className:"text-label ",htmlFor:"confirmPassword",children:[e.jsx("span",{className:"text-[#ffbc00]",children:"*"})," ",n.usePhone?o.sms_verification_code():o.email_verification_code()]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[#b1f600] pl-2",children:[" ",n.usePhone?G((a==null?void 0:a.phone)??""):U((a==null?void 0:a.email)??"")]}),n.showSwitch&&e.jsxs("span",{className:"flex items-center justify-center text-sm gap-2",onClick:()=>F({...n,usePhone:!n.usePhone}),children:[e.jsx(f,{color:"#bbbbbb",name:"ic_change",className:"w-4 h-3"}),e.jsx("span",{className:"text-label",children:n.usePhone?"E-mail":o.phone_number()})]})]}),e.jsxs("div",{className:"w-full rounded-md px-3 py-2.5 mt-1 bg-[#1b1b1e] border border-[#333239] flex items-center justify-between",children:[e.jsx("input",{type:"text",value:s.otp,name:"otp",id:"otp",autoComplete:"off",onChange:u,className:"security border-none outline-none grow bg-transparent"}),e.jsx("span",{onClick:L,className:"text-[#fdcd00] underline text-nowrap whitespace-nowrap text-sm",children:x>0?`${o.resend()}(${x})`:o.get_a_verification_code()})]})]}),e.jsx(z,{title:o.confirm(),onClick:V,className:"mt-9 uppercase",disable:S,useDisableStyle:!T}),e.jsx(W,{content:"",onClose:H,onConfirm:A,open:p.open,children:e.jsxs("div",{children:[e.jsx("p",{className:"text-center pt-3",children:p.isPhone?o.bind_phone_confirm_title():o.bind_email_confirm_title()}),e.jsx("p",{className:"text-center pt-2 text-[var(--text-content-color)] text-xs",children:p.isPhone?o.bind_phone_confirm_title_content():o.bind_email_confirm_title_content()})]})})]})}export{ne as ChangeTransPasswordView};
